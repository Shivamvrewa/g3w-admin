(()=>{var e=window&&window.initConfig&&window.initConfig.group&&window.initConfig.group.plugins;e&&(e.qtimeseries=Object.assign(e.qtimeseries||{},{version:"3.9.0",hash:"ddb3678",branch:"v3.9.x"}))})(),function i(a,s,r){function o(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=s[t]={exports:{}},a[t][0].call(n.exports,function(e){return o(a[t][1][e]||e)},n,n.exports,i,a,s,r)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<r.length;e++)o(r[e]);return o}({1:[function(e,t,n){function a(e){return function(){var o=e.apply(this,arguments);return new Promise(function(s,r){return function t(e,n){try{var i=o[e](n),a=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});s(a)}("next")})}}Object.defineProperty(n,"__esModule",{value:!0}),c=e("../constant"),e=e("../service"),p=(e=e)&&e.__esModule?e:{default:e},n.default={name:"SidebarItem",data:function(){var e=p.default.state,t=e.layers,n=void 0===t?[]:t;return{layers:n,panel:e.panel,step:n[0].options.step,start_date:n[0].start_date,end_date:n[0].end_date,stepunitmultiplier:n[0].options.stepunitmultiplier,format:"YYYY-MM-DD HH:mm:ss",min_date:n[0].start_date,max_date:n[0].end_date,step_units:c.STEP_UNITS,current_step_unit:n[0].options.stepunit,change_step_unit:!1,current_step_unit_label:c.STEP_UNITS.find(function(e){return e.moment===n[0].options.stepunit}).label,range:{value:0,min:0,max:0},changed_layer:!1,current_layers_index:n.map(function(e,t){return t.toString()}),currentLayerDateTimeIndex:null,status:0}},computed:{formDisabled:function(){return 0!==this.status},select_layers:function(){var t=this;return this.changed_layer=!0,setTimeout(function(){return t.changed_layer=!1}),this.current_layers_index.map(function(e){return t.layers[e]})},disablerun:function(){return!(0!==this.status||this.start_date&&this.end_date)},validRangeDates:function(){var e=this.getMultiplierAndStepUnit(),t=e.multiplier,e=e.step_unit;return this.validateStartDateEndDate()&&moment(this.end_date).diff(moment(this.start_date),e)/t>=this.getStepValue()}},methods:{initLayerTimeseries:function(){this.status=0,this.setDates(),this.min_date=this.start_date,this.currentLayerDateTimeIndex=this.start_date,this.range.value=0,this.range.min=0,this.resetRangeInputData(),this.currentLayerDateTimeIndex&&this.getTimeLayer(),this.showCharts=!1},setDates:function(){var e,t;1<this.select_layers.length?(this.start_date=moment.min(this.select_layers.map(function(e){return e.start_date})),this.end_date=moment.max(this.select_layers.map(function(e){return e.end_date})),this.max_date=this.end_date):(e=(t=this.layers[this.current_layers_index[0]]).start_date,t=t.end_date,this.start_date=e,this.end_date=t)},resetRangeInputData:function(){this.range.value=0;var e=this.getMultiplierAndStepUnit(),t=e.multiplier,e=e.step_unit;this.range.max=this.validateStartDateEndDate()?Number.parseInt(moment(this.end_date).diff(moment(this.start_date),e)/t*this.stepunitmultiplier):0},changeRangeInputOnChangeStepUnit:function(){this.range.value=0;var e=this.getMultiplierAndStepUnit(),t=e.multiplier,e=e.step_unit;this.range.max=this.validateStartDateEndDate()?Number.parseInt(moment(this.end_date).diff(moment(this.start_date),e)/t*this.stepunitmultiplier):0},getMultiplierAndStepUnit:function(){return p.default.getMultiplierAndStepUnit(this.current_step_unit)},resetTimeLayer:(d=a(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.select_layers;this.pause(),yield p.default.resetTimeLayer(e),e.forEach(function(e){return e.timed=!1})}),function(){return d.apply(this,arguments)}),getTimeLayer:(u=a(function*(){yield this.$nextTick();try{yield p.default.getTimeLayer({layers:this.select_layers,step:this.step,date:this.currentLayerDateTimeIndex,end_date:this.end_date,stepunit:this.current_step_unit})}catch(e){}this.select_layers.forEach(function(e){return e.timed=!0})}),function(){return u.apply(this,arguments)}),changeRangeStep:(l=a(function*(e){var e=e.value,e=(this.range.value=+e,this.getMultiplierAndStepUnit()),t=e.mutltiplier,e=e.step_unit;this.currentLayerDateTimeIndex=moment(this.start_date).add(this.range.value*t,e),yield this.getTimeLayer()}),function(e){return l.apply(this,arguments)}),changeStartDateTime:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=moment(e).isValid()?e:null;this.start_date=e,this.currentLayerDateTimeIndex=e,this.resetRangeInputData(),moment(e).isValid()?this.getTimeLayer():this.resetTimeLayer()},changeEndDateTime:(o=a(function*(e){this.end_date=e,this.resetRangeInputData()}),function(e){return o.apply(this,arguments)}),validateStartDateEndDate:function(){return!(!this.start_date||!this.end_date)&&moment(this.start_date).isValid()&&moment(this.end_date).isValid()},setStatus:function(){this.status=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0},setCurrentDateTime:function(e){var t=+this.getStepValue(),n=this.getMultiplierAndStepUnit(),i=n.multiplier,n=n.step_unit;this.currentLayerDateTimeIndex=moment(this.currentLayerDateTimeIndex)[1===e?"add":"subtract"](t*i,n)},getStepValue:function(){return+this.step*this.stepunitmultiplier},run:function(t){var n,i=this;t!==this.status?(n=!1,clearInterval(this.intervalEventHandler),this.intervalEventHandler=setInterval(a(function*(){if(!n)try{var e=+i.step;if(i.range.value=1===t?i.range.value+e:i.range.value-e,i.range.value>i.range.max||i.range.value<0)i.resetRangeInputData(),i.pause(),i.fastBackwardForward(-1);else{i.setCurrentDateTime(t),n=!0;try{yield i.getTimeLayer()}catch(e){}n=!1}}catch(e){i.pause()}}),1e3),this.setStatus(t)):this.pause()},pause:function(){clearInterval(this.intervalEventHandler),this.intervalEventHandler=null,this.setStatus()},stepBackwardForward:function(e){var t=this.getStepValue();this.range.value=1===e?this.range.value+t:this.range.value-t,this.setCurrentDateTime(e),this.getTimeLayer()},fastBackwardForward:function(e){1===e?(this.range.value=this.range.max,this.currentLayerDateTimeIndex=this.end_date):(this.range.value=this.range.min,this.currentLayerDateTimeIndex=this.start_date),this.getTimeLayer()},hideSingleLayerSelectionClear:function(){$(this.$refs["select-layers"]).siblings(".select2-container").find(".select2-selection__choice__remove").hide()}},watch:{step:function(){this.getTimeLayer()},current_step_unit:{handler:(r=a(function*(t){this.change_step_unit=!0,this.select_layers.forEach(function(e){return e.options.stepunit=t}),this.current_step_unit_label=c.STEP_UNITS.find(function(e){return e.moment===t}).label,this.initLayerTimeseries(),yield this.$nextTick(),this.change_step_unit=!1}),function(e){return r.apply(this,arguments)}),immediate:!1},current_layers_index:{immediate:!1,handler:(s=a(function*(e,t){var n=this;yield this.$nextTick(),1===e.length&&this.hideSingleLayerSelectionClear(),yield this.resetTimeLayer(t.map(function(e){return n.layers[e]})),this.initLayerTimeseries()}),function(e,t){return s.apply(this,arguments)})},"panel.open":function(e){e?this.initLayerTimeseries():this.resetTimeLayer()},validRangeDates:function(e){e||this.changeStartDateTime(this.start_date)}},created:function(){this.intervalEventHandler=null},mounted:(i=a(function*(){var e=this;this.disabledSingleLayerClickUnSelect=function(){setTimeout(function(){1===e.select_layers.length?$('.select2-results__options li[aria-selected="true"]').addClass("g3w-disabled"):$(".select2-results__options li").removeClass("g3w-disabled")})},yield this.$nextTick(),p.default.onafter("open",function(){$("#timeserieslayer").on("select2:open",e.disabledSingleLayerClickUnSelect)}),p.default.onafter("close",function(){$("#timeserieslayer").off("select2:open",e.disabledSingleLayerClickUnSelect)})}),function(){return i.apply(this,arguments)}),beforeDestroy:function(){p.default.clear()}},t.exports.__esModule&&(t.exports=t.exports.default);var i,s,r,o,l,u,d,c,p,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var n=this,e=n.$createElement,i=n._self._c||e;return i("ul",{staticClass:"treeview-menu",staticStyle:{position:"relative",padding:"10px",color:"#FFFFFF"},attrs:{id:"g3w_raster_timeseries_content"}},[i("li",[i("form",{directives:[{name:"disabled",rawName:"v-disabled",value:n.formDisabled,expression:"formDisabled"}]},[i("label",{staticStyle:{display:"block"}},[n._v("Layer")]),n._v(" "),i("select",{directives:[{name:"select2",rawName:"v-select2",value:"current_layers_index",expression:"'current_layers_index'"}],ref:"select-layers",staticClass:"form-control",attrs:{id:"timeserieslayer",multiple:0<n.layers.length,search:!1}},n._l(n.layers,function(e,t){return i("option",{key:e.id,domProps:{value:t,selected:-1<n.current_layers_index.indexOf(t.toString())}},[n._v("\n              "+n._s(e.name))])}),0),n._v(" "),n.changed_layer?n._e():i("div",[i("datetime",{attrs:{label:"plugins.qtimeseries.startdate",format:n.format,minDate:n.min_date,maxDate:n.end_date,type:"datetime",value:n.start_date},on:{change:n.changeStartDateTime}}),n._v(" "),i("datetime",{attrs:{label:"plugins.qtimeseries.enddate",format:n.format,minDate:n.start_date,maxDate:n.max_date,type:"datetime",value:n.end_date},on:{change:n.changeEndDateTime}}),n._v(" "),n.change_step_unit?n._e():i("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin:pre",value:"qtimeseries.step",expression:"'qtimeseries.step'",arg:"pre"}]},[n._v("\n                ["),i("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"qtimeseries.stepsunit."+n.current_step_unit_label,expression:"`qtimeseries.stepsunit.${current_step_unit_label}`"}]}),n._v(" ]\n            ")]),n._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:n.step,expression:"step"}],staticClass:"form-control",attrs:{type:"number",min:n.range.min,max:n.range.max,step:n.stepunitmultiplier},domProps:{value:n.step},on:{input:function(e){e.target.composing||(n.step=e.target.value)}}}),n._v(" "),i("range",{directives:[{name:"disabled",rawName:"v-disabled",value:n.range.max===n.range.min,expression:"range.max === range.min "}],ref:"rangecomponent",attrs:{label:"plugins.qtimeseries.steps",max:n.range.max,value:n.range.value,min:n.range.min},on:{"change-range":n.changeRangeStep}}),n._v(" "),i("label",{staticStyle:{display:"block"}}),n._v(" "),i("select",{directives:[{name:"select2",rawName:"v-select2",value:"current_step_unit",expression:"'current_step_unit'"}],staticClass:"form-control",attrs:{id:"g3w-timeseries-select-unit",search:!1}},n._l(n.step_units,function(e){return i("option",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"qtimeseries.stepsunit."+e.label,expression:"`qtimeseries.stepsunit.${step_unit.label}`"}],key:e.moment,domProps:{value:e.moment,selected:n.current_step_unit==e.moment}})}),0)],1)]),n._v(" "),i("div",{staticStyle:{display:"flex","justify-content":"space-between","margin-top":"10px"}},[i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!n.validRangeDates||0===n.range.value,expression:"!validRangeDates || range.value === 0"}],staticClass:"sidebar-button skin-button btn btn-block",staticStyle:{margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.fastBackwardForward(-1)}}},[i("span",{class:n.g3wtemplate.getFontClass("fast-backward")})]),n._v(" "),i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!n.validRangeDates||n.range.value<=0,expression:"!validRangeDates || range.value <= 0"}],staticClass:"sidebar-button skin-button btn btn-block",staticStyle:{margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.stepBackwardForward(-1)}}},[i("span",{class:n.g3wtemplate.getFontClass("step-backward")})]),n._v(" "),i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!n.validRangeDates||n.range.value<=0,expression:"!validRangeDates || range.value <= 0"}],staticClass:"sidebar-button skin-button btn btn-block",class:{toggled:-1===n.status},staticStyle:{margin:"2px",transform:"rotate(180deg)"},on:{click:function(e){return e.stopPropagation(),n.run(-1)}}},[i("span",{class:n.g3wtemplate.getFontClass("run")})]),n._v(" "),i("button",{staticClass:"sidebar-button skin-button btn btn-block",class:{toggled:0===n.status},staticStyle:{margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.pause(e)}}},[i("span",{class:n.g3wtemplate.getFontClass("pause")})]),n._v(" "),i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!n.validRangeDates||n.range.value>=n.range.max,expression:"!validRangeDates || range.value >= range.max"}],staticClass:"sidebar-button skin-button btn btn-block",class:{toggled:1===n.status},staticStyle:{margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.run(1)}}},[i("span",{class:n.g3wtemplate.getFontClass("run")})]),n._v(" "),i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!n.validRangeDates||n.range.value>=n.range.max,expression:"!validRangeDates || range.value >= range.max"}],staticClass:"sidebar-button skin-button btn btn-block",staticStyle:{margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.stepBackwardForward(1)}}},[i("span",{class:n.g3wtemplate.getFontClass("step-forward")})]),n._v(" "),i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!n.validRangeDates||n.range.value===n.range.max,expression:"!validRangeDates || range.value === range.max"}],staticClass:"sidebar-button skin-button btn btn-block",staticStyle:{margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.fastBackwardForward(1)}}},[i("span",{class:n.g3wtemplate.getFontClass("fast-forward")})])])])])},e.staticRenderFns=[]},{"../constant":12,"../service":14}],2:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Zeitreihen",current_date:"Aktuelles Datum",steps:"Stufen",step:"Stufe",startdate:"Anfangsdatum",enddate:"Enddatum",stepsunit:{label:"Stufeneinheit",centuries:"Jahrhunderte",decades:"Jahrzehnte",years:"Jahre",months:"Monate",weeks:"Wochen",days:"Tage",hours:"Stunden",minutes:"Minuten",seconds:"Sekunden",milliseconds:"Millisekunden"},tooltips:{showcharts:"Diagramme zeigen"}}},{}],3:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}}},{}],4:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}}},{}],5:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}}},{}],6:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=d(e("./it")),a=d(e("./en")),s=d(e("./fi")),r=d(e("./se")),o=d(e("./fr")),l=d(e("./de")),u=d(e("./ro")),e=d(e("./pl"));function d(e){return e&&e.__esModule?e:{default:e}}n.default={it:i.default,en:a.default,fi:s.default,se:r.default,fr:o.default,de:l.default,ro:u.default,pl:e.default}},{"./de":2,"./en":3,"./fi":4,"./fr":5,"./it":7,"./pl":8,"./ro":9,"./se":10}],7:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Serie Temporali",current_date:"Data Corrente",steps:"Passi",step:"Passo",startdate:"Data Inizio",enddate:"Data Fine",stepsunit:{label:"Unità di passo",centuries:"Secoli",decades:"Decadi",years:"Anni",months:"Mesi",weeks:"Settimane",days:"Giorni",hours:"Ore",minutes:"Minuti",seconds:"Secondi",milliseconds:"Millisecondi"},tooltips:{showcharts:"Visualizza Grafici"}}},{}],8:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}}},{}],9:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Intervale de timp",current_date:"Data Curentă",steps:"Pași",step:"Pas",startdate:"Data Început",enddate:"Data Sfârșit",stepsunit:{label:"Unitatea de pas",centuries:"Secole",decades:"Decenii",years:"Ani",months:"Luni",weeks:"Săptămâni",days:"Zile",hours:"Ore",minutes:"Minute",seconds:"Secunde",milliseconds:"Milisecunde"},tooltips:{showcharts:"Arată Graficele"}}},{}],10:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default={title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}}},{}],11:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var e=e("./i18n"),e=(e=e)&&e.__esModule?e:{default:e};n.default={i18n:e.default,name:"qtimeseries"}},{"./i18n":6}],12:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});n.STEP_UNITS=[{moment:"100:years",label:"centuries",qgis:"c"},{moment:"10:years",label:"decades",qgis:"dec"},{moment:"years",label:"years",qgis:"y"},{moment:"months",label:"months",qgis:"mon"},{moment:"7:days",label:"weeks",qgis:"wk"},{moment:"days",label:"days",qgis:"d"},{moment:"hours",label:"hours",qgis:"h"},{moment:"minutes",label:"minutes",qgis:"min"},{moment:"seconds",label:"seconds",qgis:"s"},{moment:"milliseconds",label:"milliseconds",qgis:"ms"}]},{}],13:[function(e,t,n){var i=r(e("./config")),a=r(e("./service")),s=r(e("./components/SidebarItem.vue"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var o=e.apply(this,arguments);return new Promise(function(s,r){return function t(e,n){try{var i=o[e](n),a=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});s(a)}("next")})}}function l(){var t=this,n=(u(this,{name:i.default.name,i18n:i.default.i18n,service:a.default}),this.panel,this.setReady(!0),this.onAfterRegisterPluginKey,this.registerPlugin(this.config.gid));this.setupGui=function(){var t,n=this.getService();this.createSideBarComponent(s.default,{id:i.default.name,title:"plugins."+i.default.name+".title",open:!1,collapsible:!0,closewhenshowviewportcontent:!1,iconConfig:{color:"#25bce9",icon:"time"},mobile:!0,sidebarOptions:{position:"catalog"},events:{open:{when:"before",cb:(t=o(function*(e){e?n.open():n.close()}),function(e){return t.apply(this,arguments)})}}})},this.load=function(){this.init()},this.unload=function(){this.emit("unload"),this.service.clear()},this.service.loadPlugin()&&(this.setHookLoading({loading:!0}),this.service.once("ready",function(e){n&&e&&(c.isready?t.setupGui():c.on("ready",function(){return t.setupGui.bind(t)})),t.setHookLoading({loading:!1})}),this.service.init(this.config))}var e=g3wsdk.core.utils,u=e.base,e=e.inherit,d=g3wsdk.core.plugin.Plugin,c=g3wsdk.gui.GUI;e(l,d),new l},{"./components/SidebarItem.vue":1,"./config":11,"./service":14}],14:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var c=e("./constant");function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var e=g3wsdk.core.utils,i=e.base,a=e.inherit,p=e.toRawType,s=g3wsdk.gui.GUI,e=g3wsdk.core.plugin.PluginService,v={showSpinner:!1};function r(){this.setters={open:function(){this._open()},close:function(){this._close()}},i(this),this.init=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(this.project=this.getCurrentProject(),this.config=e,this.mapService=s.getService("map"),this.getChartConfig={interaction:null,keyListener:null,indexcolor:0,chart:null,layer:new ol.layer.Vector({source:new ol.source.Vector})},this.addProjectLayerFromConfigProject(),0<this.config.layers.length);e&&(this.state={loading:!1,layers:this.config.layers,panel:{open:!1}}),this.emit("ready",e)},this.addProjectLayerFromConfigProject=function(){var d=this;this.project.getConfigLayers().forEach(function(e){var t,n,i,a,s,r,o,l,u;"Object"===p(e.qtimeseries)&&(t=(s=e.qtimeseries).field,n=void 0===(n=s.step)?1:n,i=void 0===(a=s.units)?"d":a,a=void 0===(a=s.start_date)?null:a,s=void 0===(s=s.end_date)?null:s,o=new Date(a).getTimezoneOffset(),r=new Date(s).getTimezoneOffset(),a=moment(a).add(o,"minutes"),s=moment(s).add(r,"minutes"),r=1<(o=c.STEP_UNITS.find(function(e){return e.qgis===i}).moment.split(":")).length?o[1]:o[0],o=1<o.length?+o[0]:1,e=e.id,l=(u=d.project.getLayerById(e)).getName(),u=u.getWMSLayerName(),d.config.layers.push({id:e,name:l,wmsname:u,start_date:a,end_date:s,options:{range_max:moment(s).diff(moment(a),r)-1,step:n,stepunit:r,stepunitmultiplier:o,field:t}}))})},this.getTimeLayer=function(){var d=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=e.layers,p=e.date,m=e.step,h=e.end_date,f=e.stepunit;return new Promise(function(t,n){var i=void 0,e=c.map(function(e){return e.id}),e=(e.map(function(e){return d.project.getLayerById(e)}).forEach(function(e){return e.setChecked(!0)}),e.map(function(e){return d.mapService.getMapLayerByLayerId(e)})),a=d.getMultiplierAndStepUnit(f),s=a.multiplier,a=a.step_unit,r=new Date(p).getTimezoneOffset(),o=moment(p).add(Math.abs(r),"minutes").toISOString(),i=moment(o).add(m*s,a).toISOString(),s=moment(h).add(Math.abs(r),"minutes").toISOString(),a=moment(i).isAfter(s),l=o+"/"+(i=a?s:i),u=e.length;e.forEach(function(e){e.once("loadend",function(){var e=i?o+" - "+i:o;d.mapService.showMapInfo({info:e,style:{fontSize:"1.2em",color:"grey",border:"1px solid grey",padding:"10px"}}),0===--u&&t()}),e.once("loaderror",function(){var e=i?o+" - "+i:o;d.mapService.showMapInfo({info:e,style:{fontSize:"1.2em",color:"red",border:"1px solid red",padding:"10px"}}),0===--u&&n()}),d.mapService.updateMapLayer(e,g({force:!0},"TIME",l),v)})})},this.getMultiplierAndStepUnit=function(e){var t=e.split(":");return{multiplier:1<t.length?+t[0]:1,step_unit:1<t.length?t[1]:e}},this.resetTimeLayer=function(i){var a=this,s=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new Promise(function(t,e){var n=i.length;i.forEach(function(e){e.timed?(e=a.mapService.getMapLayerByLayerId(e.id),s&&e.once("loadend",function(){a.mapService.showMapInfo(),0===--n&&t()}),a.mapService.updateMapLayer(e,g({force:!0},"TIME",void 0))):t()})})},this._open=function(){this.state.panel.open=!0},this._close=function(){var e=this.state.layers.filter(function(e){return e.timed});e&&this.resetTimeLayer(e,!0),this.state.panel.open=!1},this.clear=function(){this.close()}}a(r,e),n.default=new r},{"./constant":12}]},{},[13]);
//# sourceMappingURL=plugin.js.map
