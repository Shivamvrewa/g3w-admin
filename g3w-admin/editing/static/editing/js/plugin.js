
(function() {
  const plugins = window?.initConfig?.group?.plugins;
  if (plugins) {
    plugins["editing"] = Object.assign(plugins["editing"] || {},
      {
        version : "4.0.1-HEAD",
        hash    : "undefined",
        branch  : "HEAD",
      });
  }
})();
(()=>{var kt=Object.defineProperty;var gi=Object.getOwnPropertyDescriptor;var hi=Object.getOwnPropertyNames;var fi=Object.prototype.hasOwnProperty;var C=(t,e)=>()=>(t&&(e=t(t=0)),e);var xe=(t,e)=>{for(var s in e)kt(t,s,{get:e[s],enumerable:!0})},pi=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of hi(e))!fi.call(t,a)&&a!==s&&kt(t,a,{get:()=>e[a],enumerable:!(i=gi(e,a))||i.enumerable});return t};var Ee=t=>pi(kt({},"__esModule",{value:!0}),t);function w(t){return t instanceof Promise?t:!t||!t.then?(console.trace(t),Promise.reject("not a promise")):new Promise((e,s)=>{t.then(e).fail(s)})}function v(t){return t===void 0?(console.trace(),$.Deferred(e=>e.reject("not a promise")).promise()):t.always?t:$.Deferred(async e=>{try{e.resolve(await(t instanceof Promise?t:t()))}catch(s){console.trace(s),e.reject(s)}}).promise()}var G=C(()=>{});var _i,mi,yi,Te,E,he=C(()=>{G();({G3WObject:_i}=g3wsdk.core),{isPointGeometryType:mi}=g3wsdk.core.geoutils.Geometry,{Layer:yi}=g3wsdk.core.layer,{GUI:Te}=g3wsdk.gui,E=class extends _i{constructor(e={}){super(),this._options=e,this._run=(e.run||this.run||(async()=>!0)).bind(this),this._stop=(e.stop||this.stop||(async()=>!0)).bind(this),this._inputs=e.inputs||null,this._context=e.context||null,this._outputs=e.outputs||null,this.state={id:e.id||null,name:e.name||null,help:e.help||null,running:!1,error:null,message:e.message||null,usermessagesteps:{}},this.registerEscKeyEvent(e.escKeyPressEventHandler),this.selectStyle=e.selectStyle,e.steps&&this.setSteps(e.steps),e.onRun&&this.on("run",e.onRun),e.onStop&&this.on("stop",e.onStop),e.tools&&(this._tools=e.tools)}setInputs(e){this._inputs=this.inputs=e}getInputs(){return this._inputs}setContext(e){return this._context=this.context=e}getContext(){return this.context}panic(){console.log("Panic to implement ..")}setRoot(e){this.state.root=e}getUserMessageSteps(){return this.state.usermessagesteps}setUserMessageSteps(e={}){this.state.usermessagesteps=e}setUserMessageStepDone(e){e&&(this.state.usermessagesteps[e].done=!0)}addInteraction(e,s={}){return Te.getService("map").addInteraction(e),Object.entries(s).forEach(([i,a])=>e.on(i,a)),this.on("stop",()=>this.removeInteraction(e)),e}removeInteraction(e){setTimeout(()=>Te.getService("map").removeInteraction(e))}getEditingType(){return null}registerPointerMoveCursor(){Te.getService("map").getMap().on("pointermove",this._pointerMoveCursor)}unregisterPointerMoveCursor(){Te.getService("map").getMap().un("pointermove",this._pointerMoveCursor)}_pointerMoveCursor(e){this.getTargetElement().style.cursor=this.forEachFeatureAtPixel(e.pixel,()=>!0)?"pointer":""}setSteps(e={}){this._steps=e,this.setUserMessageSteps(e)}getSteps(){return this._steps}getMap(){return Te.getService("map").getMap()}disableSidebar(e=!0){this._isContentChild||Te.disableSideBar(e)}fireEvent(e,s={}){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").fireEvent(e,s)}saveSingle(e,s){s.session.save().then(()=>g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").saveChange())}cancelSingle(e,s){s.session.rollback()}escKeyUpHandler(e){e.key==="Escape"&&e.data.callback({task:e.data.task})}unbindEscKeyUp(){$(document).unbind("keyup",this.escKeyUpHandler)}bindEscKeyUp(e=()=>{}){$(document).on("keyup",{callback:e,task:this},this.escKeyUpHandler)}registerEscKeyEvent(e){e&&(this.on("run",()=>this.bindEscKeyUp(e)),this.on("stop",()=>this.unbindEscKeyUp()))}__run(e,s){return v(async()=>{this.setInputs(e),this.setContext(s);let i=this,a={snap:{type:"snap",options:{checkedAll:!1,checked:!1,active:!0,run({layer:n}){this.active=!0,this.layerId=n.getId(),this.source=n.getEditingLayer().getSource()},stop(){this.active=this.checked=this.checkedAll=!1}}},measure:{type:"measure",options:{checked:!1,run(){setTimeout(()=>{this.onChange(this.checked)})},stop(){i.removeMeasureInteraction(),this.checked=!1,this.onChange(!1)},onChange(n){this.checked=n,i[n?"addMeasureInteraction":"removeMeasureInteraction"]()}}}};this._tools&&this._workflow._toolsoftool.length===0&&this._workflow._toolsoftool.push(...this._tools.filter(n=>n!=="measure"||yi.LayerTypes.VECTOR===e.layer.getType()&&!mi(e.layer.getGeometryType())).map(n=>a[n])),this._tools&&(this._workflow._toolsoftool.forEach(n=>n.options.run({layer:e.layer})),this._workflow.emit("settoolsoftool",this._workflow._toolsoftool)),this.emit("run",{inputs:e,context:s});try{return this.state.running=!0,await w(this._run(e,s))}catch(n){return console.warn(n),this.state.error=n,Promise.reject(n)}finally{this.state.running&&await this.__stop()}})}async __stop(){await this._stop(this._inputs,this._context),this.state.running=!1,this._workflow&&this._workflow._toolsoftool.forEach(e=>e.options.stop()),this.emit("stop")}getId(){return this.state.id}getName(){return this.state.name}getHelp(){return this.state.help}getError(){return this.state.error}getMessage(){return this.state.message}isRunning(){return this.state.running}getTask(){return this}setOutputs(e){this._outputs=e}getOutputs(){return this._outputs}setToolsOfTools(e,s=[]){this._workflow=e,this._tools=s}};E.MESSAGES={help:null}});var es={};xe(es,{default:()=>Ii});function Fi(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};o.__file="UserMessage.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let h;if(e&&(h=r?function(u){e.call(this,c(u,this.$root.$options.shadowRoot))}:function(u){e.call(this,l(u))}),h!==void 0)if(o.functional){let u=o.render;o.render=function(p,_){return h.call(_),u(p,_)}}else{let u=o.beforeCreate;o.beforeCreate=u?[].concat(u,h):[h]}}return o}function St(){let t=St.styles||(St.styles={}),e=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let n=e?a.media||"default":i,r=t[n]||(t[n]={ids:[],parts:[],element:void 0});if(!r.ids.includes(i)){let l=a.source,g=r.ids.length;if(r.ids.push(i),a.map&&(l+=`
/*# sourceURL=`+a.map.sources[0]+" */",l+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),e&&(r.element=r.element||document.querySelector("style[data-group="+n+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],o=r.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),e&&(o.setAttribute("data-group",n),o.setAttribute("data-next-index","0")),c.appendChild(o)}if(e&&(g=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",g+1)),r.element.styleSheet)r.parts.push(l),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(l),o=r.element.childNodes;o[g]&&r.element.removeChild(o[g]),o.length?r.element.insertBefore(c,o[g]):r.element.appendChild(c)}}}}var bi,vi,wi,ki,Si,xi,Ei,Ci,Ii,ts=C(()=>{bi={data:()=>({steps:{}}),methods:{completeStep(t){t.done=!0,t.buttonnext.done()}}},vi=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"steps-list"},t._l(t.steps,function(i,a){return s("li",{key:a,class:{done:i.done},style:{display:i.buttonnext&&"inline-flex"}},[i.buttonnext?s("span",{staticClass:"button-step"},[s("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:i.description,expression:"step.description"}],staticClass:"description"}),t._v(" "),i.dynamic?s("span",{staticClass:"dynamic-step"},[t._v(t._s(i.dynamic))]):t._e(),t._v(" "),s("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.workflow.next",expression:"'editing.workflow.next'"}],class:"btn btn-success"+(i.buttonnext.disabled?" g3w-disabled":""),staticStyle:{"margin-left":"10px"},on:{click:function(n){return t.completeStep(i)}}})]):[s("i",{class:t.g3wtemplate.getFontClass(i.done?"success":"empty-circle")}),t._v(" "),s("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:i.description,expression:"step.description"}]})]],2)}),0)},wi=[],ki=function(t){t&&t("data-v-fa9bb800_0",{source:".steps-list[data-v-fa9bb800]{align-self:flex-start;list-style:none;padding:10px;margin-bottom:0}li[data-v-fa9bb800]{margin-bottom:5px}li.done[data-v-fa9bb800]{font-weight:700;color:green}li.done>.description[data-v-fa9bb800]{font-weight:700}.dynamic-step[data-v-fa9bb800]{padding:10px;font-size:1.2em}.button-step[data-v-fa9bb800]{display:inline-flex;align-items:center}.button-step[data-v-fa9bb800],button.btn-success[data-v-fa9bb800]{font-weight:700;align-self:normal}",map:void 0,media:void 0})},Si="data-v-fa9bb800",xi=void 0,Ei=!1;Ci=Fi({render:vi,staticRenderFns:wi},ki,bi,Si,Ei,xi,!1,St,void 0,void 0),Ii=Ci});var ss,Ti,y,X,ee=C(()=>{he();G();({GUI:ss}=g3wsdk.gui),{G3WObject:Ti}=g3wsdk.core,y=class t extends Ti{constructor(e={}){super(),this._type=e.type!==void 0?e.type:null,this._options=e,this._promise=null,this._inputs=e.inputs!==void 0?e.inputs:null,this._context=e.context!==void 0?e.context:null,this._steps=e.steps||[],this._child=null,this._stackIndex=null,this.runOnce=e.runOnce||!1,this._messages=E.MESSAGES,this._userMessageSteps={},this._steps.length>0&&this.setUserMessagesSteps(this._steps),this.backbuttonlabel=e.backbuttonlabel!==void 0?e.backbuttonlabel:null,this.helpMessage=e.helpMessage?{help:e.helpMessage}:null,this._toolsoftool=[],e.registerEscKeyEvent===!0&&this.registerEscKeyEvent(),this._stepIndex=0}setUserMessagesSteps(e){this._userMessageSteps=e.reduce((s,i)=>({...s,...i.getUserMessageSteps()||{}}),{})}isType(e){return Array.isArray(e)?!!e.find(s=>s===this._type):e===this._type}getContextService(){return this.getContext().service}setContextService(e){this.getContext().service=e}getStackIndex(){return this._stackIndex}addChild(e){this._child?this._child.addChild(e):this._child=e}setInput({key:e,value:s}){this._inputs[e]=s}getInputs(){return this._inputs}setContext(e){this._context=e}getContext(){return this._context}addStep(e){this._steps.push(e)}setSteps(e=[]){this._steps=e,this.setUserMessagesSteps(e)}getSteps(){return this._steps}getStep(e){return this._steps[e]}setMessages(e){Object.assign(this._messages,e)}getMessages(){return this._messages}clearMessages(){this._messages.help=null,Object.keys(this._userMessageSteps).length>0&&this.clearUserMessagesSteps()}getLastStep(){return this._steps.length>0?this._steps[this._steps.length-1]:null}getRunningStep(){return this._steps.find(e=>e.isRunning())}reject(){this._promise&&this._promise.reject(),this.emit("reject")}resolve(){this._promise&&this._promise.resolve()}async runStep(e,s){try{this.setMessages({help:e.state.help}),this.emit("settoolsoftool",e.tools||[]);let i=await w(e.__run(s,this.getContext()));return this._stepIndex++,this._stepIndex===this.getSteps().length?(this._stepIndex=0,i):this.runStep(this.getSteps()[this._stepIndex],i)}catch(i){return this._stepIndex=0,Promise.reject(i)}}start(e={}){return v(new Promise(async(s,i)=>{this._promise={resolve:s,reject:i},this._inputs=e.inputs,this._context=e.context||{},!(this._context.isChild||!1)&&t.Stack.getLength()&&this!==t.Stack.getCurrent()&&t.Stack.getCurrent().addChild(this),this._stackIndex=t.Stack.push(this),this._steps=e.steps||this._steps,(this._steps||[]).forEach(r=>r._workflow=this);let n=Object.keys(this._userMessageSteps).length>0;n&&ss.showUserMessage({title:"plugins.editing.workflow.title.steps",type:"tool",position:"left",size:"small",closable:!1,hooks:{body:{...(ts(),Ee(es)).default,data:()=>({steps:this._userMessageSteps})}}}),this.emit("start");try{console.assert(this._stepIndex===0,`reset workflow before restarting: ${this._stepIndex}`);let r=await this.runStep(this.getSteps()[this._stepIndex],this.getInputs());n?setTimeout(()=>{this.clearUserMessagesSteps(),s(r)},500):s(r)}catch(r){console.warn(r),n&&this.clearUserMessagesSteps(),i(r)}}))}async stop(){return v(new Promise(async(e,s)=>{this._promise=null;try{this._child&&await w(this._child.stop())}catch(i){console.warn(i)}this._child=null;try{let i=this.getSteps()[this._stepIndex];if(i.isRunning()&&(this.clearMessages(),await i.__stop()),this._stepIndex>0)return this._stepIndex=0,s(),Promise.reject();e()}catch(i){console.warn(i),s(i)}finally{t.Stack.removeAt(this.getStackIndex()),this.emit("stop")}}))}clearUserMessagesSteps(){Object.keys(this._userMessageSteps).forEach(e=>{let s=this._userMessageSteps[e];s.done=!1,s.buttonnext&&(s.buttonnext.disabled=!0)}),ss.closeUserMessage()}setBackButtonLabel(e=null){this.backbuttonlabel=e}getBackButtonLabel(){return this.backbuttonlabel}addToolsOfTools({step:e,tools:s=[]}){e.setToolsOfTools(this,s)}setHelpMessage(e){this.helpMessage={help:e}}getHelpMessage(){return this.helpMessage}getFeatures(){return this.getInputs().features}startFromLastStep(e={}){return this.setSteps([this.getSteps().pop()]),this.start(e)}getCurrentFeature(){let e=this.getFeatures();return e[e.length-1]}getLayer(){return this.getInputs().layer}getSession(){return this.getContext().session}escKeyUpHandler(e){e.keyCode===27&&(e.data.workflow.reject(),e.data.callback())}unbindEscKeyUp(){$(document).unbind("keyup",this.escKeyUpHandler)}bindEscKeyUp(e=()=>{}){$(document).on("keyup",{workflow:this,callback:e},this.escKeyUpHandler)}registerEscKeyEvent(e){this.on("start",()=>this.bindEscKeyUp(e)),this.on("stop",()=>this.unbindEscKeyUp())}},X=[];y.Stack={_workflows:X,push(t){return X.includes(t)?X.indexOf(t):X.push(t)-1},getParent(){return X.slice(-2)[0]},getParents(){return X.slice(0,-1)},pop(){return X.pop()},getLength(){return X.length},getFirst(){return X[0]},getCurrent(){return y.Stack.getLast()},getLast(){return X.slice(-1)[0]},removeAt(t){X.splice(t,1)},insertAt(t,e){X[t]=e},getAt(t){return X[t]},async clear(){X.splice(0)}}});function st(t="all",e={}){let s;switch(t){case"all":s=void 0;break;case"bbox":s={bbox:Li.getService("map").getMapBBOX()};break;case"field":s={field:{field:e.field,type:"editing"}};break;case"fid":e.operator!=="not"&&(s={fid:{fid:e.feature.getId(),layer:{id:e.layerId},type:"editing",relation:e.relation.state,formatter:0}});break;case"1:1":s={field:e.relation.getChildField()[0]+"|eq|"+e.feature.get(e.relation.getFatherField()[0]),type:"editing"};break}return{registerEvents:!0,editing:!0,filter:s}}var Li,xt=C(()=>{({GUI:Li}=g3wsdk.gui)});async function Fe(t){let e=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing");return await new Promise((s,i)=>{let a=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayerById(t);if(Object.values(a.getEditingFields().filter(r=>!(r.pk&&r.editable===!1)&&(r.input.type==="unique"||r.validate.unique))).length===0){s();return}a.getWidgetData({type:"unique",fields:Object.values(a.getEditingFields().filter(r=>!(r.pk&&r.editable===!1)&&(r.input.type==="unique"||r.validate.unique))).map(r=>r.name).join()}).then(r=>{Object.entries(r.data||{}).forEach(([l,g])=>{e.state.uniqueFieldsValues[t][l]=new Set(g)}),s(e.state.uniqueFieldsValues[t][name])}).fail(r=>{console.warn(r),i(r)})}),e.state.uniqueFieldsValues[t]}var Et=C(()=>{});function te({layerId:t,relation:e}={}){let s=e.getFather?e.getFather():e.father,i=e.getChild?e.getChild():e.child;return t===s?i:s}var De=C(()=>{});function fe({layerId:t,relations:e=[]}){return e.filter(s=>g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById(te({layerId:t,relation:s})))}var it=C(()=>{De()});function Ri(t){return{originalStyle:t.getStyle(),selectedStyle:t.getGeometry()?g3wsdk.core.geoutils.createSelectedStyle({geometryType:t.getGeometry().getType()}):t.getStyle()}}function pe(t=[],e){if(t.length>0){let s=t.flat(),{originalStyle:i,selectedStyle:a}=Ri(s[0]);return s.forEach(n=>n.setStyle(e||a)),i}}var at=C(()=>{});function H({promise:t,inputs:e,style:s}={}){let{layer:i,features:a=[]}=e,n=()=>{let g=pe(a,s);w(t).finally(()=>{a.flat().forEach(c=>c.setStyle(g))})},r=Pi.LayerTypes.VECTOR===i.getType(),l=y.Stack.getLength();r&&l?setTimeout(()=>n()):r&&n()}var Pi,je=C(()=>{ee();G();at();({Layer:Pi}=g3wsdk.core.layer)});var as={};xe(as,{default:()=>$i});function Ni(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};o.__file="ChooseFeatureToEdit.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let h;if(e&&(h=r?function(u){e.call(this,c(u,this.$root.$options.shadowRoot))}:function(u){e.call(this,l(u))}),h!==void 0)if(o.functional){let u=o.render;o.render=function(p,_){return h.call(_),u(p,_)}}else{let u=o.beforeCreate;o.beforeCreate=u?[].concat(u,h):[h]}}return o}function Ft(){let t=Ft.styles||(Ft.styles={}),e=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let n=e?a.media||"default":i,r=t[n]||(t[n]={ids:[],parts:[],element:void 0});if(!r.ids.includes(i)){let l=a.source,g=r.ids.length;if(r.ids.push(i),a.map&&(l+=`
/*# sourceURL=`+a.map.sources[0]+" */",l+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),e&&(r.element=r.element||document.querySelector("style[data-group="+n+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],o=r.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),e&&(o.setAttribute("data-group",n),o.setAttribute("data-next-index","0")),c.appendChild(o)}if(e&&(g=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",g+1)),r.element.styleSheet)r.parts.push(l),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(l),o=r.element.childNodes;o[g]&&r.element.removeChild(o[g]),o.length?r.element.insertBefore(c,o[g]):r.element.appendChild(c)}}}}var is,Ai,Mi,Bi,Oi,Di,ji,Ui,Vi,$i,rs=C(()=>{({GUI:is}=g3wsdk.gui),Ai={name:"choosefeature",data(){return{feature:this.$options.feature}},methods:{selectFeature(t){this.feature.splice(0),this.feature.push(t)},getAttributesFeature(t){let e=t.getProperties();return this.$options.attributes.map(({label:s,name:i})=>({attribute:s,value:e[i]}))},zoomToFeature(t){is.getService("map").zoomToFeatures([t],{highlight:!0,duration:1e3})}},mounted(){is.closeContent()}},Mi=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"editing-layers-choose-feature"}},t._l(t.$options.features,function(i,a){return s("div",{staticClass:"editing-choose-feature-radio-input"},[s("section",{staticClass:"choose-and-zoom-to-feature"},[s("div",[s("input",{staticClass:"magic-radio",attrs:{id:"choose_feature_"+a,name:"radio",type:"radio"},on:{click:function(n){return n.stopPropagation(),t.selectFeature(i)}}}),t._v(" "),s("label",{attrs:{for:"choose_feature_"+a}},[t._v("id")])]),t._v(" "),s("div",{staticClass:"ztf skin-color",class:t.g3wtemplate.font.marker,on:{click:function(n){return n.stopPropagation(),t.zoomToFeature(i)}}})]),t._v(" "),s("section",{staticClass:"feature-attributes"},t._l(t.getAttributesFeature(i),function(n){var r=n.attribute,l=n.value;return s("div",[s("span",{staticClass:"f-attr"},[t._v(t._s(r))]),t._v(" "),s("span",{staticClass:"f-val"},[t._v(t._s(l))])])}),0)])}),0)},Bi=[],Oi=function(t){t&&t("data-v-a5a3297e_0",{source:".choose-and-zoom-to-feature[data-v-a5a3297e]{display:flex;flex-direction:column;justify-content:space-between}#editing-layers-choose-feature .editing-choose-feature-radio-input[data-v-a5a3297e]{align-items:center;padding:5px;position:relative;display:flex;justify-content:space-between;border-bottom:1px solid #eee}.ztf[data-v-a5a3297e]{padding-left:3px;font-size:1.3em;cursor:pointer;margin-top:10px}.magic-radio+label[data-v-a5a3297e]{color:transparent}.feature-attributes[data-v-a5a3297e]{overflow-x:auto;display:flex}.feature-attributes>div[data-v-a5a3297e]{display:flex;flex-direction:column;justify-content:space-between;padding:5px}.f-attr[data-v-a5a3297e]{font-weight:700;margin-bottom:10px}.f-val[data-v-a5a3297e]{align-self:start;white-space:nowrap}",map:void 0,media:void 0})},Di="data-v-a5a3297e",ji=void 0,Ui=!1;Vi=Ni({render:Mi,staticRenderFns:Bi},Oi,Ai,Di,Ui,ji,!1,Ft,void 0,void 0),$i=Vi});function oe({features:t=[],inputs:e}){return new Promise((s,i)=>{let a=[],n=new(Vue.extend((rs(),Ee(as)).default))({features:Array.isArray(t)?t:[],feature:a,attributes:e.layer.getEditingFields().map(({name:l,label:g})=>({name:l,label:g}))}),r=g3wsdk.gui.GUI.showModalDialog({title:zi("editing.modal.tools.copyfeaturefromprojectlayer.title"),className:"modal-left",closeButton:!1,message:n.$mount().$el,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback(){i()}},ok:{label:"Ok",className:"btn-success",callback(){s(a[0])}}}});r.find("button.btn-success").prop("disabled",!0),n.$watch("feature",l=>r.find("button.btn-success").prop("disabled",l===null))})}var zi,Ue=C(()=>{({tPlugin:zi}=g3wsdk.core.i18n)});function me(t,e){let s=t.cloneNew(),i=e&&e.getEditingFields().find(a=>a.pk);return i&&i.editable===!1&&s.set(i.name,null),s}var Ne=C(()=>{});function Ve(){if(!(y.Stack.getLength()>1))return;let{features:t,layer:e,fields:s=[]}=y.Stack.getParent().getInputs(),i=t[t.length-1].clone();return s.forEach(({name:a,value:n})=>{i.set(a,n)}),{feature:i,qgs_layer_id:e.getId()}}var Ct=C(()=>{ee()});async function Z({inputs:t,context:e,feature:s}={}){let i=[];return t.layer.getFieldsWithValues(s,{exclude:e.excludeFields,get_default_value:e.get_default_value!==void 0?e.get_default_value:!1}).forEach(a=>{a.input.options.default_expression&&(a.input.options.default_expression.apply_on_update||s.isNew())&&i.push(new Promise(async(n,r)=>{try{await g3wsdk.core.input.inputService.handleDefaultExpressionFormInput({field:a,feature:s,qgs_layer_id:t.layer.getId(),parentData:Ve()}),s.set(a.name,a.value),n(s)}catch(l){console.warn(l),r(l)}})),a.input.options.filter_expression&&i.push(new Promise(async(n,r)=>{try{await g3wsdk.core.input.inputService.handleFilterExpressionFormInput({field:a,feature:s,qgs_layer_id:t.layer.getId(),parentData:Ve()}),s.set(a.name,a.value),n(s)}catch(l){console.warn(l),r(l)}}))}),await Promise.allSettled(i),s}var $e=C(()=>{Ct()});function ae(t,e){return t.replace("Multi","")===e.replace("Multi","")}var ze=C(()=>{});function nt(t=[],e){return(t||[]).flatMap(s=>{let i=s.getGeometry()&&s.getGeometry().getType();if(i&&!os(e)?Hi({feature:s}):i&&os(e)&&qi({feature:s,geometryType:e}),e===i)return s;if(ae(i,e)&&(ls(e)||!ls(i))){let a=s.clone();return a.__layerId=s.__layerId,a.setGeometry(Gi(s.getGeometry(),e)),a}return[]})}var Gi,os,Hi,qi,ls,Tt=C(()=>{ze();({convertSingleMultiGeometry:Gi}=g3wsdk.core.geoutils),{is3DGeometry:os,removeZValueToOLFeatureGeometry:Hi,addZValueToOLFeatureGeometry:qi}=g3wsdk.core.geoutils.Geometry,{isMultiGeometry:ls}=g3wsdk.core.geoutils.Geometry});function ye(t,e){let s=t.features.length>0?t.features[t.features.length-1]:t.layer.createNewFeature();return s.setTemporaryId(),t.layer.getEditingLayer().getEditingSource().addFeature(s),e.session.pushAdd(t.layer.getId(),s,!1),t.features.push(s),e.get_default_value=!0,v(Promise.resolve(t,e))}var ot=C(()=>{G()});function q({layerId:t,relation:e}={}){let i=(e.getChild?e.getChild():e.child)!==t,a=e.getFatherField?e.getFatherField():e.fatherField,n=e.getChildField?e.getChildField():e.childField;return{ownField:i?a:n,relationField:i?n:a}}var Le=C(()=>{});async function le(t,e={}){let s=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),i=s.getLayerById(t),a=e.relations||i.getChildren().length&&i.getRelations()&&fe({layerId:t,relations:i.getRelations().getArray().filter(r=>r.getFather()===t)})||[],n;try{n=await Promise.all(a.map(async r=>{r.setLoading?r.setLoading(!0):r.loading=!0;let l=te({layerId:t,relation:r});e.relation=r,e.layerId=t,e.filterType=(r.getType?r.getType():r.type)==="ONE"?"1:1":e.filterType;let g=e.filterType||"fid",c=st(g,e),o=s.state.sessions[l],h=ds.online&&o,u=s.getToolBoxById(l);e.operator=e.operator!==void 0?e.operator:"eq";let{ownField:f,relationField:p}=q({layerId:l,relation:r}),_=s.getLayerById(t).readEditingFeatures(),m=p.map(k=>e.feature.get(k)),b=(!ds.online||!o||o.isStarted())&&e.operator==="eq"&&f.every((k,x)=>_.find(S=>m[x]==S.get(k)));u.startLoading();try{h&&!o.isStarted()?await w(o.start(c)):h&&!b&&await w(o.getFeatures(c))}catch(k){try{await w(k)}catch(x){console.warn(x,k)}}return u.stopLoading(),{[l]:s.getLayerById(l).readEditingFeatures().filter(k=>f.every((x,S)=>m[S]==k.get(x)))}}))}catch(r){console.warn(r)}return a.forEach(r=>{r.setLoading?r.setLoading(!1):r.loading=!1}),n}var ds,Ge=C(()=>{G();Le();De();it();xt();({ApplicationState:ds}=g3wsdk.core)});function J(t){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayerById(t)}var Re=C(()=>{});function lt({layerId:t,relations:e=[],feature:s}={}){let i=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),a=[],n;return e.forEach(r=>{let l=r.getChild?r.getChild():r.child,g=r.getFatherField?r.getFatherField():r.fatherField,c=l===t?g:l;if(i.getLayerById(c)){let o=i.getToolBoxById(c).getLayer(),h=i.getLayerById(r.getFather?r.getFather():r.father),{ownField:u,relationField:f}=q({layerId:c,relation:r}),p=f.map(_=>s.isNew()&&h.isPkField(_)?s.getId():s.get(_));n={relation:r.getState(),relations:i.getLayerById(c).readEditingFeatures().filter(_=>u.every((m,b)=>_.get(m)==p[b])).map(_=>({fields:o.getFieldsWithValues(_,{relation:!0}),id:_.getId(),select:!1}))},n.validate={valid:!0},a.push(n)}}),a}var Lt=C(()=>{Le()});function He(){y.Stack._workflows.filter(t=>t.getContextService()).forEach(t=>t.getContextService().setUpdate(!0,{force:!0}))}var Pt=C(()=>{ee()});function ct({layerId:t,relation:e,relations:s,index:i,dialog:a=!0}){return v(new Promise(n=>{let r=()=>{let l=t===e.child?e.father:e.child,g=J(l).getEditingSource().getFeatureById(s[i].id),c=g.clone();q({relation:e,layerId:l}).ownField.forEach(o=>g.set(o,null)),y.Stack.getCurrent().getSession().pushUpdate(l,g,c),s.splice(i,1),He(),n(!0)};a?Wi.dialog.confirm(Xi("editing.messages.unlink_relation"),l=>l?r():d.reject(!1)):r()}))}var Wi,Xi,At=C(()=>{ee();Le();Pt();Re();G();({GUI:Wi}=g3wsdk.gui),{tPlugin:Xi}=g3wsdk.core.i18n});var re,ut=C(()=>{re=class extends ol.interaction.Pointer{constructor(e={}){let s=[],i=({pixel:a,map:n}={})=>n.getFeaturesAtPixel(a,{layerFilter:r=>e.layer===r,hitTolerance:isMobile&&isMobile.any?10:0});super({handleDownEvent(a){return s=i(a),s},handleUpEvent(a){return s&&s.length>0&&this.dispatchEvent({type:"picked",features:s,coordinate:a.coordinate,layer:e.layer}),!0},handleMoveEvent(a){a.map.getTargetElement().style.cursor=i(a)?"pointer":""}})}}});function fs({inputs:t,context:e,feature:s,multi:i}={}){let a=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),n=t.layer.getId(),r=t.layer.getFieldsWithValues(s,{exclude:e.excludeFields,get_default_value:e.get_default_value===void 0?!1:e.get_default_value}),l=r.filter(c=>!(c.pk&&c.editable===!1)&&(c.input.type==="unique"||c.validate.unique)).map(c=>({field:c,_value:s.get(c.name)}));if(l.forEach(({_value:c,field:o})=>{let h=a.state.uniqueFieldsValues[n][o.name]||new Set([]),u=Array.from(h).filter(f=>f!==null);o.input.options.values=(["integer","float","bigint"].includes(o.type)?Yi:Ji)(u),h.has(null)&&o.input.options.values.unshift(null),h.forEach(f=>o.validate.exclude_values.add([null,void 0].includes(f)?f:`${f}`)),o.validate.exclude_values.delete(`${c}`)}),l.length===0)return hs(r,i);let g=()=>(l.forEach(({_value:c,field:o})=>{if(c!==o.value&&a.state.uniqueFieldsValues[n][o.name]){let h=a.state.uniqueFieldsValues[n][o.name];h.delete(c),h.add(o.value)}}),{once:!0});return a.subscribe(`savedfeature_${n}`,g),a.subscribe(`closeform_${n}`,()=>(a.unsubscribe(`savedfeature_${n}`,g),{once:!0})),hs(r,i)}function hs(t,e){return e&&(t=t.map(s=>{let i=JSON.parse(JSON.stringify(s));return i.value=null,i._value=null,i.forceNull=!0,i.validate.required=!1,i}).filter(s=>!s.pk)),t}var Ji,Yi,ps=C(()=>{Ji=t=>t.sort((e,s)=>e.localeCompare(s,void 0,{sensitivity:"base"})),Yi=(t,e=!0)=>t.sort((s,i)=>e?s-i:i-s)});async function Mt({layerId:t,features:e=[],fields:s=[],task:i}={}){if(e.length===0)return;let a=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),n=_s.getLayerById(t).getRelations().getArray().filter(r=>r.getType()==="ONE").map(r=>new Promise(async(l,g)=>{if(t!==r.getFather()){l();return}let c=r.getFatherField()[0],o=e[0].get(c);if(o===null){l();return}let h=r.getChild(),u=r.getChildField()[0];if(!a.getLayerById(h)){g();return}let f=a.getLayerById(h).getEditingSource(),p,_;p=f.readFeatures().find(k=>k.get(u)===o);let m=a.getLayerById(r.getFather()).getEditingFields().filter(k=>k.vectorjoin_id&&k.vectorjoin_id===r.getId()).find(({name:k})=>s.find(x=>k==x.name).update)!==void 0,b=p===void 0;m&&(b?(p=new g3wsdk.core.layer.features.Feature,p.setTemporaryId(),_s.getLayerById(h).getEditingFields().forEach(k=>p.set(k.name,null)),p.set(u,s.find(k=>c===k.name).value),f.addFeature(p),_=p):p&&(_=p.clone()),p&&(a.getLayerById(r.getFather()).getEditingFields().filter(x=>x.vectorjoin_id&&x.vectorjoin_id===r.getId()&&x.editable).forEach(x=>_.set(x.name.replace(r.getPrefix(),""),e[0].get(x.name))),b?(a.getLayerById(t).isPkField(c)&&p.set(u,e[0].getId()),i.getContext().session.pushAdd(h,_,!1)):(f.updateFeature(_),i.getContext().session.pushUpdate(h,_,p)))),l()}));await Promise.allSettled(n)}var _s,ms=C(()=>{({CatalogLayersStoresRegistry:_s}=g3wsdk.core.catalog)});var qe,Bt=C(()=>{qe=new Vue});async function Ot({relation:t,fatherFormRelationField:e}){let s=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),i=t.getFather(),a=t.getChild(),n=t.getChildField()[0],r=!1,l=s.getLayerById(a).getEditingSource().readFeatures().find(g=>e.value===g.get(n));if(l===void 0){let g=s.getLayerById(a).getFeaturesStore(),c=g.oncebefore("featuresLockedByOtherUser",o=>l=o[0]);await le(i,{feature:new ol.Feature({[e.name]:e.value}),relations:[t]}),g.un("featuresLockedByOtherUser",c),l===void 0&&(l=s.getLayerById(a).getEditingSource().readFeatures().find(o=>e.value===o.get(n)))}if(l===void 0)try{let g=Qi.getLayerById(a),{data:c}=await ea.getData("search:features",{inputs:{layer:g,formatter:0,filter:g3wsdk.core.utils.createFilterFormInputs({layer:g,search_endpoint:"api",inputs:[{attribute:n,value:e.value}]}),search_endpoint:"api"},outputs:!1});c&&c[0]&&c[0].features.length===1&&(r=!0,l=c[0].features[0])}catch(g){console.warn(g)}return{feature:l,locked:r}}var Qi,ea,ys=C(()=>{Ge();({CatalogLayersStoresRegistry:Qi}=g3wsdk.core.catalog),{DataRouterService:ea}=g3wsdk.core.data});async function bs({layerId:t,fields:e=[],formService:s}={}){let i=[],a=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),n=ta.getLayerById(t).getRelations().getArray().filter(r=>r.getType()==="ONE");for(let r of n){let l=r.getChild(),g=r.getFatherField(),c={},o=e.find(u=>g.includes(u.name));if(!(o&&a.getLayerById(l)))return i;let h=a.getLayerById(r.getFather()).getEditingFields().filter(u=>u.vectorjoin_id&&u.vectorjoin_id===r.getId()).reduce((u,f)=>{let p=e.find(_=>_.name===f.name);return u[p.name]=p.editable,u},{});o.input.options.loading.state="loading",c[o.value]=await Ot({relation:r,fatherFormRelationField:o}),o.input.options.loading.state=null,c[o.value].locked&&Object.keys(h).forEach(u=>e.find(f=>u===f.name).editable=!1),i.push(qe.$watch(()=>o.value,async u=>{if(!u){o.input.options.loading.state=null,o.editable=!0;return}if(o.editable=!1,o.input.options.loading.state="loading",c[o.value]===void 0)try{c[o.value]=await Ot({relation:r,fatherFormRelationField:o})}catch(_){console.warn(_)}let{feature:f,locked:p}=c[o.value];Object.keys(h).forEach(_=>{let m=e.find(b=>_===b.name);m.editable=p?!1:h[_],m.value=f?f.get(m.name.replace(r.getPrefix(),"")):null,s.changeInput(m)}),o.input.options.loading.state=null,o.editable=!0}))}return i}var ta,vs=C(()=>{Bt();ys();({CatalogLayersStoresRegistry:ta}=g3wsdk.core.catalog)});function de({layerId:t,feature:e,property:s}={}){let{fields:i}=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayerById(t).config.editing,a=e.get(s),n=a!==null&&(i.filter(l=>["select_autocomplete","select"].includes(l.input.type))||[]).reduce((l,g)=>(l[g.name]=g.input.options.values,l),{}),r=n&&n[s]&&n[s].find(l=>a==l.value);return r?r.key:a}var Ke=C(()=>{});function gt(t,e,s,i){(t||[]).forEach(r=>{let l=s.indexOf(r);l<0?(i._originalStyle=pe([r]),s.push(r)):(s.splice(l,1),r.setStyle(i._originalStyle)),e.features=s});let a=i.getSteps(),n=a.select.buttonnext;n.disabled=n.condition?n.condition({features:s}):s.length===0,a.select.dynamic!==void 0&&(a.select.dynamic=s.length)}var ws=C(()=>{at()});function ht({feature:t,vertexColor:e="red",lineColor:s="yellow",fillVertex:i=!1,strokeWidth:a=3,radius:n=4}={}){let r=t.getGeometry().getType();t.setStyle(()=>[new ol.style.Style({image:new ol.style.Circle({radius:n,...i?{fill:new ol.style.Fill({color:e})}:{stroke:new ol.style.Stroke({color:e,width:3})}}),geometry:l=>new ol.geom.MultiPoint(Dt.isPolygonGeometryType(r)&&Dt.isMultiGeometry(r)?l.getGeometry().getCoordinates()[0][0]:Dt.isLineGeometryType(r)?l.getGeometry().getCoordinates()[0]:[l.getGeometry().getCoordinates()])}),new ol.style.Style({stroke:new ol.style.Stroke({color:s,width:a})})])}var Dt,jt=C(()=>{({Geometry:Dt}=g3wsdk.core.geoutils)});function Ut(t,e){t instanceof ol.Map&&(t=t.getTargetElement()),!("ontouchstart"in window)&&t instanceof Element&&(t.style.cursor=e)}var ks,Ss,ft,xs=C(()=>{({GUI:ks}=g3wsdk.gui);Ss={default:"auto",select:"   pointer",rotate:"move"},ft=class extends ol.interaction.Pointer{constructor(e={}){super({handleDownEvent:s=>this.handleDownEvent_(s),handleDragEvent:s=>this.handleDragEvent_(s),handleUpEvent:s=>this.handleUpEvent_(s)}),this.selection_=new ol.Collection,this.ispt_=!1,this.handles_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Rotate overlay",displayInLayerSwitcher:!1,style:s=>this.style[(s.get("handle")||"default")+(s.get("constraint")||"")+(s.get("option")||"")],updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=new ol.Collection(e.features),this._change=!1,this._pointRotation=({rotation:s,feature:i})=>{this._change||this.dispatchEvent({type:"rotatestart",feature:i}),i.set("rotation",Number(s)),this._change&&this.dispatchEvent({type:"rotating",feature:i}),this._change=!0},this.set("rotate",!0),this.set("selection",!0),this.set("keepRectangle",!1),this.set("buffer",0),this.on("propertychange",()=>this.drawSketch_()),this.setDefaultStyle()}setMap(e){let s=this.getMap();s&&(s.removeLayer(this.overlayLayer_),this.previousCursor_&&Ut(s,this.previousCursor_),this.previousCursor_=void 0),super.setMap(e),this.overlayLayer_.setMap(e),e===null&&this.select(null),e!==null&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())}setActive(e){this.select(null),this.overlayLayer_&&this.overlayLayer_.setVisible(e),super.setActive(e)}setDefaultStyle(){let e=new ol.style.Stroke({color:[255,0,0,1],width:1}),s=new ol.style.Fill({color:[255,255,255,.8]});this.style={default:[new ol.style.Style({image:new ol.style.RegularShape({fill:s,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),stroke:new ol.style.Stroke({color:[255,0,0,1],width:1,lineDash:[4,4]}),fill:new ol.style.Fill({color:[255,0,0,.01]})})],rotate:[new ol.style.Style({image:new ol.style.RegularShape({fill:s,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),stroke:e,fill:s})],arrow:i=>new ol.style.Style({image:new ol.style.Icon({src:`${ks.getResourcesUrl()}images/Arrow.svg`,width:50,height:50,rotation:i.get("rotation")*Math.PI/180})})},this.drawSketch_()}setStyle(e,s){if(s){s instanceof Array?this.style[e]=s:this.style[e]=[s];for(let i=0;i<this.style[e].length;i++){let a=this.style[e][i].getImage();a&&e=="rotate"&&(a.getAnchor()[0]=-5),a&&this.isTouch&&a.setScale(1.8);let n=this.style[e][i].getText();n&&e=="rotate"&&n.setOffsetX(this.isTouch?14:7),n&&this.isTouch&&n.setScale(1.8)}this.drawSketch_()}}getFeatureAtPixel_(e){return this.getMap().forEachFeatureAtPixel(e,s=>{if(this.handles_.getArray().find(i=>s===i))return{feature:s,constraint:s.get("constraint"),option:s.get("option")}},{hitTolerance:isMobile&&isMobile.any?10:0})||{}}getGeometryRotateToZero_(e){let s=e.getGeometry().clone();return s.rotate(this.getMap().getView().getRotation()*-1,this.getMap().getView().getCenter()),s}_isRectangle(e){return this.get("keepRectangle")&&e.getType()==="Polygon"&&e.getCoordinates()[0].length===5}drawSketch_(e){let s,i,a=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),!this.selection_.getLength())return;let n=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent(),r;if(a&&(r=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4),r.unshift(r[3])),n=ol.extent.buffer(n,this.get("buffer")),this.selection_.forEach(l=>ol.extent.extend(n,this.getGeometryRotateToZero_(l).getExtent())),e===!0)this.ispt_||(this.overlayLayer_.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.center_)})),i=ol.geom.Polygon.fromExtent(n),s=new ol.Feature(i),this.overlayLayer_.getSource().addFeature(s));else{if(this.ispt_){let l=this.getMap().getPixelFromCoordinate(ol.extent.getCenter(n));l&&(n=ol.extent.boundingExtent([this.getMap().getCoordinateFromPixel([l[0]-30,l[1]-30]),this.getMap().getCoordinateFromPixel([l[0]+30,l[1]+30])]))}i=a?new ol.geom.Polygon([r]):ol.geom.Polygon.fromExtent(n),this.overlayLayer_.getSource().addFeatures([new ol.Feature(i)])}}select(e){if(!e&&this.selection_)return this.selection_.clear(),!1;!e||!e.getGeometry||!e.getGeometry()||(this.selection_.push(e),this.ispt_=e.getGeometry().getType()==="Point",this.ispt_&&(ks.showUserMessage({type:"tool",title:"Rotation",size:"small",autoclose:!1,closable:!1,iconClass:"refresh",hooks:{body:{template:`
              <div id = "rotation-feature-point-tool">
                <input class = "form-control" type="number" min = "0" max = "360" :value = "rotation" @input = "change"/>
              </div>
            `,data(){return{rotation:e.get("rotation")||0}},methods:{change:s=>this._pointRotation({feature:e,rotation:s.target.value})},created(){e.on("propertychange",s=>this.rotation=s.target.get("rotation"))},beforeDestroy:()=>{this.change&&this.dispatchEvent({type:"rotateend",feature:e}),this.change_=!1,this.pdegrees_=null}}}}),this.pdegrees_=null,this.drawSketch_(),setTimeout(()=>{this.oriStyle=e.getStyle(),e.setStyle(this.style.arrow)})),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:e,features:this.selection_}))}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach(e=>ol.Observable.unByKey(e)),this._featureListeners=this.selection_.getArray().map(e=>e.on("change",()=>{this.isUpdating_||this.drawSketch_()}))}handleDownEvent_(e){let s=this.getFeatureAtPixel_(e.pixel),i=s.feature;if(!i&&this.selection_.getLength())return this._rotateEndFnc(),this.selection_.clear(),this.overlayLayer_.getSource().clear(),!1;this.opt_=s.option,this.constraint_=s.constraint,this.oriStyle=i.getStyle(),this.coordinate_=i.get("handle")?i.getGeometry().getCoordinates():e.coordinate,this.pixel_=this.getMap().getCoordinateFromPixel(this.coordinate_),this.geoms_=[],this.rotatedGeoms_=[];let a=ol.extent.createEmpty();this.geoms_.push(this.selection_.item(0).getGeometry().clone()),a=ol.extent.extend(a,this.selection_.item(0).getGeometry().getExtent()),this.extent_=ol.geom.Polygon.fromExtent(a).getCoordinates()[0],this.center_=this.getCenter()||ol.extent.getCenter(a);let n=e.map.getTargetElement();return Ut(n,Ss.rotate),this.previousCursor_=n.style.cursor,this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:"rotatestart",feature:this.selection_.item(0)}),this._change=!0,!0}getCenter(){return this.get("center")}setCenter(e){return this.set("center",e)}handleDragEvent_(e){let s,i,a,n=this.selection_.item(0),r=[e.coordinate[0],e.coordinate[1]];this.isUpdating_=!0;let l=Math.atan2(this.center_[1]-r[1],this.center_[0]-r[0]);if(!this.ispt_)for(s=0,i;i=this.selection_.item(s);s++)a=this.geoms_[s].clone(),a.rotate(l-this.angle_,this.center_),i.setGeometry(a);if(this.ispt_){let g=l*(180/Math.PI);this.pdegrees_===null&&(this.pdegrees_=g);let c=this.pdegrees_>g||this.pdegrees_>g,o=Number(n.get("rotation"));o>360&&c&&(o=0),o<0&&!c&&(o=360),this._pointRotation({rotation:o+(c?1:-1),feature:n}),this.pdegrees_=g}this.drawSketch_(!0),this.isUpdating_=!1}_rotateEndFnc(){let e=this.selection_.item(0);return Ut(this.getMap().getTargetElement(),Ss.default),this.previousCursor_=void 0,this.dispatchEvent({type:"rotateend",feature:e}),!1}handleUpEvent_(){this.ispt_||this._rotateEndFnc(),this.drawSketch_()}getFeatures(){return this.selection_}}});var Cs={};xe(Cs,{default:()=>wa});function ba(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};o.__file="FormRelation.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let h;if(e&&(h=r?function(u){e.call(this,c(u,this.$root.$options.shadowRoot))}:function(u){e.call(this,l(u))}),h!==void 0)if(o.functional){let u=o.render;o.render=function(p,_){return h.call(_),u(p,_)}}else{let u=o.beforeCreate;o.beforeCreate=u?[].concat(u,h):[h]}}return o}function Vt(){let t=Vt.styles||(Vt.styles={}),e=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let n=e?a.media||"default":i,r=t[n]||(t[n]={ids:[],parts:[],element:void 0});if(!r.ids.includes(i)){let l=a.source,g=r.ids.length;if(r.ids.push(i),a.map&&(l+=`
/*# sourceURL=`+a.map.sources[0]+" */",l+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),e&&(r.element=r.element||document.querySelector("style[data-group="+n+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],o=r.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),e&&(o.setAttribute("data-group",n),o.setAttribute("data-next-index","0")),c.appendChild(o)}if(e&&(g=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",g+1)),r.element.styleSheet)r.parts.push(l),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(l),o=r.element.childNodes;o[g]&&r.element.removeChild(o[g]),o.length?r.element.insertBefore(c,o[g]):r.element.appendChild(c)}}}}var sa,Es,ia,Pe,Nt,ce,aa,ra,D,na,oa,la,da,ca,ua,be,Fs,ga,ha,fa,pa,_a,ma,ya,va,wa,Is=C(()=>{ee();he();Ne();je();G();Le();Ge();Re();Tt();ot();Pt();De();Ke();Ue();ze();At();ut();Bt();We();({ProjectsRegistry:sa}=g3wsdk.core.project),{CatalogLayersStoresRegistry:Es}=g3wsdk.core.catalog,{DataRouterService:ia}=g3wsdk.core.data,{Geometry:Pe}=g3wsdk.core.geoutils,{tPlugin:Nt}=g3wsdk.core.i18n,{Layer:ce}=g3wsdk.core.layer,{Feature:aa}=g3wsdk.core.layer.features,{toRawType:ra}=g3wsdk.core.utils,{GUI:D}=g3wsdk.gui,{FormService:na}=g3wsdk.gui.vue.services,{fieldsMixin:oa,resizeMixin:la,mediaMixin:da}=g3wsdk.gui.vue.Mixins,{PickFeatureInteraction:ca,PickCoordinatesInteraction:ua}=g3wsdk.ol.interactions;Object.entries({Workflow:y,Step:E,OpenFormStep:M,OpenTableStep:ke,AddFeatureStep:Q,ModifyGeometryVertexStep:ve,MoveFeatureStep:we}).forEach(([t,e])=>console.assert(e!==void 0,`${t} is undefined`));be="rgb(255,89,0)",Fs={Point:new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:be})})}),MultiPoint:new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:be})})}),Linestring:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:be})}),MultiLinestring:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:be})}),Polygon:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:be}),fill:new ol.style.Fill({color:be})}),MultiPolygon:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:be}),fill:new ol.style.Fill({color:be})})},ga={mixins:[da,oa,la],name:"g3w-relation",data(){return{loading:!1,show_vector_tools:!1,disabled:!1,copylayerid:null,copyFeatureLayers:[],active:!1,value:null,placeholdersearch:`${Nt("editing.search")} ...`,resourcesurl:D.getResourcesUrl()}},methods:{resize(){if(!(this.active&&this.$el.style.display!=="none"))return;let t=this.$refs.relation_body.querySelector("div.dataTables_scrollBody");t&&(t.style.height=((document.querySelector(".contents")||{}).offsetHeight||0)-((document.querySelector(".close-panel-block")||{}).offsetHeight||0)-((document.querySelector(".g3wform_footer")||{}).offsetHeight||0)-((this.$refs.relation_header_title||{}).offsetHeight||0)-((this.$refs.relation_header_tools||{}).offsetHeight||0)-((this.$el.querySelector(".dataTables_scrollHead")||{}).offsetHeight||0)-((this.$el.querySelector(".dataTables_paginate.paging_simple_numbers")||{}).offsetHeight||0)-((document.querySelector(".editing-save-all-form")||{}).offsetHeight||0)-((this.isVectorRelation&&this.show_vector_tools&&this.$refs.relation_vector_tools||{}).offsetHeight||0)-30+"px"),this.relationsTable&&this.relationsTable.columns.adjust()},copyFeatureFromOtherLayer(){let e=this.copyFeatureLayers.find(a=>this.copylayerid===a.id).external,s=e?D.getService("map").getLayerById(this.copylayerid):Es.getLayerById(this.copylayerid),i=e||s.isGeoLayer();this.runAddRelationWorkflow({workflow:i?this._add_link_workflow.selectandcopy({copyLayer:s,isVector:!0,help:"editing.steps.help.copy",external:e}):void 0,isVector:i})},async closeVectorTools(){this.show_vector_tools=!1,await this.$nextTick(),this.resize()},addVectorRelation(){this.runAddRelationWorkflow({workflow:this._add_link_workflow.add(),isVector:ce.LayerTypes.VECTOR===this._layerType}),this.show_vector_tools=!1},updateSelectRelations(){let t=!this.selectall||!this.relations.some(e=>e.select);this.relations.forEach(e=>e.select=t)},async editAttributesRelations(){let t=new y({type:"editmultiattributes",steps:[new M({multi:!0})]}),e=this._createWorkflowOptions({features:this.relations.filter(s=>s.select).map(({id:s})=>this.getLayer().getEditingSource().getFeatureById(s))});try{await w(t.start(e))}catch(s){console.warn(s)}t.stop()},async addRelationAndLink(){this.isVectorRelation?(this.show_vector_tools=!this.show_vector_tools,await this.$nextTick(),this.resize()):this.runAddRelationWorkflow({workflow:this._add_link_workflow.add(),isVector:ce.LayerTypes.VECTOR===this._layerType})},relationAttributesSubset(t){return t.fields.map(({label:e,name:s,value:i})=>({name:s,label:e,value:i})).flatMap(({name:e,label:s,value:i})=>Array.isArray(i)?[]:[{name:e,label:s,value:i}])},getValue(t){return t&&ra(t)==="Object"?t=t.value:typeof t=="string"&&t.indexOf("_new_")===0&&(t=null),this.value=t,t},_createDataTable(){this.relationsTable=$(this.$refs.relationTable).DataTable({autoWidth:!1,columnDefs:[{orderable:!1,targets:[0,1]}],destroy:!0,order:[2,"asc"],pageLength:10,responsive:!0,scrollCollapse:!0,scrollResize:!0,scrollX:!0}),$(".dataTables_filter, .dataTables_length").hide(),$("#filterRelation").on("keyup",t=>this.relationsTable.search(t.target.value).draw())},destroyTable(){this.relationsTable&&(this.relationsTable=this.relationsTable.destroy(),this.relationsTable=null,$("#filterRelation").off())},async updateTable(){this.destroyTable(),await this.$nextTick(),this._createDataTable(),setTimeout(()=>this.resize())},updateNewRelationId(){this._new_relations_ids.forEach(({clientid:t,id:e})=>{let s=this.relations.find(i=>t===i.id);s&&(s.id=e,(this.tools.find(i=>i.find(a=>a.state.id.split(`${t}_`).length>1))||[]).forEach(i=>i.state.id=i.state.id.replace(`${t}_`,`${e}_`)))})},onCommit({relations:t={}}){let e=J(this.relation.child);t[e.getId()]&&Array.isArray(t[e.getId()].new)&&(this._new_relations_ids=[...this._new_relations_ids||[],...t[e.getId()].new.map(({clientid:s,id:i})=>({clientid:s,id:i}))])},getRelationFeatureValue(t,e){return de({layerId:this._relationLayerId,feature:this.getLayer().getEditingSource().getFeatureById(t),property:e})},enableDOMElements(t=!0){document.querySelectorAll(".editing-save-all-form").forEach(e=>{t&&e.classList.contains("g3w-disabled")&&e.classList.remove("g3w-disabled"),!t&&!e.querySelector(".save-all-icon").classList.contains("g3w-disabled")&&e.classList.add("g3w-disabled")}),document.querySelectorAll(".g3w-editing-relations-add-link-tools, .g3wform_footer").forEach(e=>e.classList.toggle("g3w-disabled",!t))},addTools(t){let e=[this.capabilities.includes("change_attr_feature")&&{state:Vue.observable({icon:"editAttributes.png",id:`${t}_editattributes`,name:"editing.tools.update_feature",enabled:!0,active:!1}),type:"editfeatureattributes"},ce.LayerTypes.TABLE===this._layerType&&this.capabilities.includes("add_feature")&&{state:Vue.observable({icon:"pasteFeaturesFromOtherLayers.png",id:`${t}_copyfeature`,name:"editing.tools.copy",enabled:!0,active:!1}),type:"addfeature"},this.capabilities.includes("delete_feature")&&{state:Vue.observable({icon:"deleteTableRow.png",id:`${t}_deletefeature`,name:"editing.tools.delete_feature",enabled:!0,active:!1}),type:"deletefeature"},this.capabilities.includes("change_feature")&&ce.LayerTypes.VECTOR===this._layerType&&g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById(this._relationLayerId).getTools().filter(s=>Pe.isPointGeometryType(this.getLayer().getGeometryType())?s.getId()==="movefeature":["movefeature","movevertex"].includes(s.getId())).map(s=>({state:Vue.observable({...s,id:`${t}_${s.id}`}),type:s.getOperator().type}))].flat().filter(Boolean);return this.tools.push(e),e},async startTool(t,e){try{if(t.state.active=!t.state.active,!t.state.active)return Promise.resolve();this.tools.forEach(o=>{o.forEach(h=>{t.state.id!==h.state.id&&(h.state.active=!1)})}),await qe.$nextTick();let s={},i=new Promise((o,h)=>{Object.assign(s,{resolve:o,reject:h})}),a=ce.LayerTypes.VECTOR===this._layerType,n=this.relations[e],r=t.state.id.split(`${n.id}_`)[1],l=this.getLayer().getEditingSource().getFeatureById(n.id),g=a&&Fs[this.getLayer().getGeometryType()],c=this._createWorkflowOptions({features:[l]});if(r==="copyfeature"&&await new Promise(async(o,h)=>{c.inputs.features=[me(l,this.getLayer())];let u=new y({type:"addtablefeature",steps:[new E({help:"editing.steps.help.new",run:ye}),new M]});try{let f=await w(u.start(c)),p=f.features[f.features.length-1];this.relations.push({id:p.getId(),fields:this.getLayer().getFieldsWithValues(p,{relation:!0})}),o(p)}catch(f){console.warn(f),c.inputs&&c.inputs.relationFeatures&&this.relations.push(...(c.inputs.relationFeatures.newFeatures||[]).map(p=>({id:p.getId(),fields:this.getLayer().getFieldsWithValues(p,{relation:!0})}))),h(f)}finally{u.stop(),t.state.active=!1}}),r==="deletefeature"&&(H({promise:i,inputs:{features:[l],layer:this.getLayer()},style:g}),D.dialog.confirm(Nt("editing.messages.delete_feature"),o=>{if(o){y.Stack.getCurrent().getSession().pushDelete(this._relationLayerId,l),this.relations.splice(e,1),this.tools.splice(e,1);let h=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[this._relationLayerId];h!==void 0&&Object.keys(l.getProperties()).filter(u=>h[u]!==void 0).forEach(u=>{new Set(h[u]).delete(l.get(u))}),this.getLayer().getEditingSource().removeFeature(l),l.isNew()&&y.Stack._workflows.find(u=>u.getSession().state.changes.filter(({feature:f})=>l.getUid()!==f.getUid()).length>0)===void 0?y.Stack._workflows.filter(u=>u.getContextService()instanceof na).forEach(u=>setTimeout(()=>u.getContextService().state.update=!1)):He(),s.resolve(o)}o||s.reject()})),r==="editattributes"){let o=new y({type:"edittablefeature",steps:[new M({selectStyle:g})]});try{await w(o.start(c)),this.getLayer().getFieldsWithValues(l,{relation:!0}).forEach(h=>{n.fields.forEach(u=>{u.name===h.name&&(u.value=h.value)})}),s.resolve(!0)}catch(h){console.warn(h),s.reject(h)}o.stop()}if(["movevertex","movefeature"].includes(r)&&this.currentRelationFeatureId!==l.getId()&&(this.currentRelationFeatureId=l.getId(),D.getService("map").zoomToFeatures([l])),["movevertex","movefeature"].includes(r)){D.setModal(!1),this.enableDOMElements(!1);let o=new y({type:t.type,steps:[new{movevertex:ve,movefeature:we}[r]({selectStyle:g})]}),h=qe.$watch(()=>t.state.active,u=>{u||(this.enableDOMElements(!0),D.setModal(!0),o.unbindEscKeyUp(),o.stop(),h(),s.reject(!1))});o.bindEscKeyUp(()=>{D.setModal(!0),h(),s.reject(!1)});try{await w(o.start(c)),y.Stack.getParents().filter(u=>u.getContextService().setUpdate).forEach(u=>u.getContextService().setUpdate(!0,{force:!0})),s.resolve(!0),setTimeout(()=>this.startTool(t,e))}catch(u){console.warn(u),s.reject(u)}o.unbindEscKeyUp(),o.stop(),h()}try{await i}catch(o){console.trace("START TOOL FAILED",o)}finally{t.state.active=!1}}catch(s){console.warn(s)}},getLayer(){return J(this._relationLayerId)},async runAddRelationWorkflow({workflow:t,isVector:e=!1}={}){e&&(D.setModal(!1),D.hideContent(!0));let s=this._createWorkflowOptions(),{fatherField:i,fatherValue:a}=s.context,{relationField:n}=q({layerId:this._relationLayerId,relation:this.relation});try{let r=await w(t.start(s));e&&t.bindEscKeyUp();let{newFeatures:l,originalFeatures:g}=r.relationFeatures,c=({field:o,value:h})=>{l.forEach((u,f)=>{u.set(o,h),s.parentFeature.isNew()&&g[f].set(o,h),this.getLayer().getEditingSource().updateFeature(u),s.context.session.pushUpdate(this._relationLayerId,u,g[f])})};if(i.forEach((o,h)=>c({field:o,value:a[h]})),s.parentFeature.isNew()&&this.getParent().editable.length>0){let o=s.parentFeature.on("propertychange",h=>{s.parentFeature.isNew()?n.find(h.key)&&c({field:h.key,value:h.target.get(h.key)}):ol.Observable.unByKey(o)})}this.relations.push(...(l||[]).map(o=>({id:o.getId(),fields:this.getLayer().getFieldsWithValues(o,{relation:!0})})))}catch(r){console.warn(r),r&&r.relationFeatures&&this.relations.push(...(r.relationFeatures.newFeatures||[]).map(l=>({id:l.getId(),fields:this.getLayer().getFieldsWithValues(l,{relation:!0})}))),s.context.session.rollbackDependecies([this._relationLayerId])}t.stop(),e&&(t.unbindEscKeyUp(),D.hideContent(!1),D.setModal(!0),setTimeout(()=>this.resize()))},async linkRelation(){this.disabled=!0;let t=ce.LayerTypes.VECTOR===this._layerType,e=this._add_link_workflow.link(t?{selectStyle:Fs[this.getLayer().getGeometryType()]}:{}),s=this._createWorkflowOptions(),{ownField:i,relationField:a}=q({layerId:this._relationLayerId,relation:this.relation});s.context.excludeFeatures=a.reduce((c,o,h)=>(c[i[h]]=this.getParent().values[o],c),{}),t&&D.setModal(!1);let n=y.Stack.getCurrent().getCurrentFeature(),r=()=>le(this.layerId,{relations:[this.relation],feature:n,operator:"not",filterType:t?"bbox":"fid"}),l={promise:void 0,showContent:!1};t?(s.context.beforeRun=async()=>{await new Promise(c=>setTimeout(c)),await r()},e.bindEscKeyUp(),l={promise:e.start(s),showContent:!0},this.enableDOMElements(!1)):await r();let g=!1;try{((await w(l.promise||e.start(s))).features||[]).forEach(o=>{if(this.relations.find(h=>h.id===o.getId())===void 0){g=g||!0;let h=o.clone();Object.entries(this.getParent().values).forEach(([u,f])=>{o.set(i[a.findIndex(p=>u===p)],f)}),y.Stack.getCurrent().getSession().pushUpdate(this._relationLayerId,o,h),this.relations.push({fields:this.getLayer().getFieldsWithValues(o,{relation:!0}),id:o.getId()})}else D.notify.warning(Nt("editing.relation_already_added"))})}catch(c){console.warn(c),s.context.session.rollbackDependecies([this._relationLayerId])}t&&this.enableDOMElements(!0),l.showContent&&(D.closeUserMessage(),e.unbindEscKeyUp()),g&&He(),e.stop(),this.disabled=!1},unlinkRelation(t,e=!0){return ct({layerId:this.layerId,relation:this.relation,relations:this.relations,index:t,dialog:e})},getParent(){let t=this.parentWorkflow.getLayer(),{ownField:e}=q({layerId:this.layerId,relation:this.relation}),s=e.find(i=>t.isPkField(i));return{editable:e.filter(i=>t.isEditingFieldEditable(i)),pk:s,values:e.reduce((i,a)=>{let n=this.parentWorkflow.getCurrentFeature(),r=this.parentWorkflow.getInputs().fields;return Object.assign(i,{[a]:s===a&&n.isNew()?n.getId():r?r.find(l=>a===l.name).value:n.get(a)})},{})}},_createWorkflowOptions(t={}){let e=q({layerId:this._relationLayerId,relation:this.relation}),s=Object.entries(this.getParent().values);return{parentFeature:y.Stack.getCurrent().getCurrentFeature(),context:{session:y.Stack.getCurrent().getSession(),excludeFields:e.ownField,fatherValue:s.map(([i,a])=>a),fatherField:s.map(([i])=>e.ownField[e.relationField.findIndex(a=>i===a)])},inputs:{features:t.features||[],layer:this.getLayer()}}}},computed:{selectall(){return this.relations.every(t=>t.select)},relationsLength(){return this.relations.length},fieldrequired(){return q({layerId:this._relationLayerId,relation:this.relation}).ownField.some(t=>J(this._relationLayerId).isFieldRequired(t))},show_add_link(){return this.relations.length===0||this.relation.type!=="ONE"}},watch:{relations(t,e=[]){e.length===0?this.destroyTable():(this.updateNewRelationId(),this.updateTable())},show_vector_tools(t){this.enableDOMElements(!t),this.disabled=t}},beforeCreate(){this.delayType="debounce"},created(){let t=J(this.relation.child);if(this._new_relations_ids=[],this.onCommit=this.onCommit.bind(this),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").on("commit",this.onCommit),this.isVectorRelation=ce.LayerTypes.VECTOR===t.getType(),this.isVectorRelation){let s=t.getGeometryType();this.copyFeatureLayers=[...Es.getLayers({QUERYABLE:!0,GEOLAYER:!0}).filter(i=>i.getGeometryType&&i.getGeometryType()&&![this.relation.child,this.relation.father].includes(i.getId())&&(i.getGeometryType()===s||ae(i.getGeometryType(),s)&&Pe.isMultiGeometry(s))).map(i=>({id:i.getId(),name:i.getName(),external:!1})),...D.getService("map").getExternalLayers("vector").filter(i=>{let a=i.getSource().getFeatures()||[];if(!a[0]||!a[0].getGeometry())return!1;let n=a[0].getGeometry().getType();return s===n||ae(s,n)&&(Pe.isMultiGeometry(s)||!Pe.isMultiGeometry(n))}).map(i=>({id:i.get("id"),name:i.get("name"),external:!0}))].sort((i,a)=>i.name.toLowerCase().localeCompare(a.name.toLowerCase())),this.addExternalLayerKey=D.getService("catalog").onafter("addExternalLayer",({layer:i,type:a})=>{if(a==="vector"){let n=D.getService("map").getExternalLayers().find(r=>i.id===r.get("id"));if(n){let r=n.getSource().getFeatures()||[];if(!r[0]||!r[0].getGeometry())return;let l=r[0].getGeometry().getType();(s===l||ae(s,l)&&(Pe.isMultiGeometry(s)||!Pe.isMultiGeometry(l)))&&this.copyFeatureLayers.push({id:n.get("id"),name:n.get("name"),external:!0})}}})}this.copylayerid=this.copyFeatureLayers.length?this.copyFeatureLayers[0].id:null,this.loadEventuallyRelationValuesForInputs=!1,this.currentRelationFeatureId=null,this._relationLayerId=this.relation.child===this.layerId?this.relation.father:this.relation.child,this._layerType=this.getLayer().getType(),this.parentWorkflow=y.Stack.getCurrent(),this.capabilities=this.parentWorkflow.getLayer().getEditingCapabilities(),this.tools=[];let e=this;this._add_link_workflow={[ce.LayerTypes.TABLE]:{link(s={}){return new y({...s,type:"edittable",backbuttonlabel:"plugins.editing.form.buttons.save_and_back_table",steps:[new ke]})},add(s={}){return new y({...s,type:"addtablefeature",steps:[new E({help:"editing.steps.help.new",run:ye}),new M]})}},[ce.LayerTypes.VECTOR]:{link(s={}){return new y({type:"linkrelation",steps:[new E({...s,help:"editing.steps.help.select_feature_to_relation",run(i,a){return v(new Promise(async(n,r)=>{let l=new Promise(c=>this.resolve=c);D.setModal(!1);let g=i.layer.getEditingLayer();try{a.beforeRun&&typeof a.beforeRun=="function"&&await w(a.beforeRun());let c=g.getSource().getFeatures().filter(o=>Object.entries(a.excludeFeatures||{}).reduce((h,[u,f])=>h&&f!=o.get(u),!0));H({promise:v(l),inputs:{layer:i.layer,features:c},style:this.selectStyle}),this.addInteraction(new ca({layers:[g],features:c}),{picked:o=>{i.features.push(o.feature),D.setModal(!0),n(i)}})}catch(c){console.warn(c),r(c)}}))},stop(){return D.setModal(!0),this.resolve(!0),this.resolve=null,!0}})]})},add:(s={})=>{let i=new Q({...s,steps:{draw:{description:"editing.steps.help.draw_new_feature",done:!1}},tools:["snap","measure"]});return i.on("stop",()=>{i.setUserMessageStepDone("draw"),D.closeUserMessage()}),new y({...s,type:"addfeature",steps:[i,new M(s)],registerEscKeyEvent:!0})},selectandcopy(s={}){return new y({type:"selectandcopyfeaturesfromotherlayer",steps:[new E({...s,help:"editing.steps.help.pick_feature",steps:{select:{description:"editing.workflow.steps.selectPoint",done:!1}},run(i,a){return s.copyLayer?v(async()=>{let n=[],r=i.layer.getGeometryType();s.isVector&&await new Promise(async g=>{this.addInteraction(s.external?new re({layer:s.copyLayer}):new ua,{picked:async c=>{try{n=nt(s.external?c.features:((await ia.getData("query:coordinates",{inputs:{coordinates:c.coordinate,query_point_tolerance:sa.getCurrentProject().getQueryPointTolerance(),layerIds:[s.copyLayer.getId()],multilayers:!1},outputs:null})).data[0]||{features:[]}).features,r)}catch(o){console.warn(o)}finally{g()}}})});let l;try{l=n.length>1?await w(oe({features:n,inputs:i})):n[0]}catch(g){console.warn(g)}if(l){let g=new aa({feature:l,properties:i.layer.getEditingFields().filter(c=>!c.pk).map(c=>c.name)});return g.setTemporaryId(),i.features=[g],i.layer.getEditingLayer().getSource().addFeature(g),a.session.pushAdd(i.layer.getId(),g,!1),i}return D.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",closable:!1,autoclose:!0}),Promise.reject()}):v(Promise.resolve())},stop(){e.show_vector_tools=!1,this.setUserMessageStepDone("select"),D.closeUserMessage()}}),new M(s)],registerEscKeyEvent:!0})}}}[this._layerType],this.relations.forEach(s=>this.addTools(s.id))},async activated(){if(this.isVectorRelation&&(this.mapExtent=D.getService("map").getMapBBOX()),this.show_vector_tools=!1,!this.loadEventuallyRelationValuesForInputs){this.loading=!0;try{await g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"show-relation-editing",id:te({layerId:this.layerId,relation:this.relation}),component:this})}catch(t){console.warn(t)}this.loading=!1,this.loadEventuallyRelationValuesForInputs=!0}this.active=!0,await this.$nextTick(),!this.relationsTable&&this.relations.length>0&&this._createDataTable(),this.resize()},deactivated(){this.destroyTable(),this.active=!1,this.relations.forEach(t=>t.select=!1)},beforeDestroy(){this.loadEventuallyRelationValuesForInputs=!0,g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").off("commit",this.onCommit),this.isVectorRelation&&this.currentRelationFeatureId!==null&&(D.getService("map").zoomToExtent(this.mapExtent),this.mapExtent=null),this.addExternalLayerKey&&(D.getService("catalog").un("addExternalLayer",this.addExternalLayerKey),this.addExternalLayerKey=null)}},ha=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.loading,expression:"loading"}],staticStyle:{"margin-bottom":"5px"}},[s("bar-loader",{attrs:{loading:t.loading}}),t._v(" "),s("div",{ref:"relation_header_title",staticClass:"relation_header_title box-header with-border skin-color"},[s("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.edit_relation",expression:"'editing.edit_relation'"}]}),t._v(" "),s("span",{staticStyle:{"margin-left":"2px"}},[t._v(": "+t._s(t.relation.name.toUpperCase()))])]),t._v(" "),s("div",{ref:"relation_header_tools",staticClass:"relation_header_tools box-header with-border"},[s("div",{attrs:{id:"search-box"}},[t.relationsLength?s("input",{staticClass:"form-control",attrs:{type:"text",id:"filterRelation",placeholder:t.placeholdersearch}}):t._e()]),t._v(" "),s("div",{staticClass:"g3w-editing-relations-add-link-tools"},[t.relationsLength>0&&t.capabilities.includes("change_attr_feature")?s("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"plugins.editing.tools.update_multi_features_relations",expression:"'plugins.editing.tools.update_multi_features_relations'",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon"},[s("span",{directives:[{name:"disabled",rawName:"v-disabled",value:t.relations.every(function(i){return!i.select}),expression:"relations.every(r => !r.select)"}],on:{click:function(i){return i.stopPropagation(),t.editAttributesRelations()}}},[s("img",{attrs:{height:"25",width:"25",src:t.resourcesurl+"images/mActionMultiEdit.svg"}})])]):t._e(),t._v(" "),t.capabilities.includes("change_attr_feature")?s("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"plugins.editing.form.relations.tooltips.link_relation",expression:"'plugins.editing.form.relations.tooltips.link_relation'",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link",class:[{disabled:!t.show_add_link},t.g3wtemplate.font.link],attrs:{align:"center"},on:{click:function(i){i.stopPropagation(),t.show_add_link&&t.linkRelation()}}}):t._e(),t._v(" "),t.capabilities.includes("add_feature")?s("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"plugins.editing.form.relations.tooltips.add_relation",expression:"'plugins.editing.form.relations.tooltips.add_relation'",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link pull-right",class:[{disabled:!t.show_add_link},t.g3wtemplate.font.plus],on:{click:function(i){i.stopPropagation(),t.show_add_link&&t.addRelationAndLink()}}}):t._e()])]),t._v(" "),t.show_vector_tools?s("section",{ref:"relation_vector_tools",staticClass:"relation_vector_tools"},[s("span",{staticClass:"close_vector_relation_tool",on:{click:function(i){return i.stopPropagation(),t.closeVectorTools.apply(null,arguments)}}},[s("i",{staticClass:"g3w-icon skin-color",class:t.g3wtemplate.font.close})]),t._v(" "),s("div",[s("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_new_feature",expression:"'editing.relation.draw_new_feature'"}],staticClass:"g3w-editing-new-relation-vector-type"}),t._v(" "),s("button",{staticClass:"btn skin-button",staticStyle:{width:"100%"},on:{click:function(i){return i.stopPropagation(),t.addVectorRelation.apply(null,arguments)}}},[s("i",{class:t.g3wtemplate.font.pencil})])]),t._v(" "),s("section",[s("span",{staticClass:"divider"}),t._v(" "),s("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_or_copy",expression:"'editing.relation.draw_or_copy'"}],staticStyle:{"align-self":"center"}}),t._v(" "),s("span",{staticClass:"divider"}),t._v(" "),s("div",{attrs:{id:"g3w-select-editable-layers-content"}},[s("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.copy_feature_from_other_layer",expression:"'editing.relation.copy_feature_from_other_layer'"}],staticClass:"g3w-editing-new-relation-vector-type"}),t._v(" "),s("select",{directives:[{name:"select2",rawName:"v-select2",value:"copylayerid",expression:"'copylayerid'"}],attrs:{id:"g3w-select-editable-layers-to-copy"}},t._l(t.copyFeatureLayers,function(i){return s("option",{key:i.id,domProps:{value:i.id}},[t._v(t._s(i.name))])}),0),t._v(" "),s("button",{directives:[{name:"disabled",rawName:"v-disabled",value:t.copyFeatureLayers.length===0,expression:"0 === copyFeatureLayers.length"}],staticClass:"btn skin-button",on:{click:function(i){return i.stopPropagation(),t.copyFeatureFromOtherLayer.apply(null,arguments)}}},[s("i",{class:t.g3wtemplate.font.clipboard})])])])]):t._e(),t._v(" "),s("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.disabled,expression:"disabled"}],ref:"relation_body",staticClass:"relation_body box-body"},[t.relationsLength>0?s("table",{ref:"relationTable",staticClass:"table g3wform-relation-table table-striped nowrap"},[s("thead",[s("tr",[s("th",{staticStyle:{padding:"10px"}},[s("input",{staticClass:"magic-checkbox",attrs:{id:"select_all_relations",type:"checkbox"},domProps:{checked:t.selectall},on:{change:function(i){return t.updateSelectRelations()}}}),t._v(" "),s("label",{staticStyle:{margin:"0"},attrs:{for:"select_all_relations"}},[t._v("\xA0")])]),t._v(" "),s("th",{directives:[{name:"t",rawName:"v-t",value:"tools",expression:"'tools'"}]}),t._v(" "),s("th"),t._v(" "),t._l(t.relationAttributesSubset(t.relations[0]),function(i){return s("th",[t._v(t._s(i.label))])})],2)]),t._v(" "),s("tbody",t._l(t.relations,function(i,a){return s("tr",{key:i.id,staticClass:"featurebox-header"},[s("td",{staticStyle:{"padding-top":"0"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:i.select,expression:"relation.select"}],staticClass:"magic-checkbox",attrs:{id:"select_relation__"+a,type:"checkbox"},domProps:{checked:Array.isArray(i.select)?t._i(i.select,null)>-1:i.select},on:{change:function(n){var r=i.select,l=n.target,g=!!l.checked;if(Array.isArray(r)){var c=null,o=t._i(r,c);l.checked?o<0&&t.$set(i,"select",r.concat([c])):o>-1&&t.$set(i,"select",r.slice(0,o).concat(r.slice(o+1)))}else t.$set(i,"select",g)}}}),t._v(" "),s("label",{attrs:{for:"select_relation__"+a}})]),t._v(" "),s("td",[s("div",{staticStyle:{display:"flex"}},t._l(t.tools[a]||t.addTools(t.relations[a].id),function(n){var r;return s("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"plugins."+n.state.name,expression:"`plugins.${tool.state.name}`",arg:"top",modifiers:{create:!0}}],key:n.state.id,class:(r={enabled:!0,toggled:n.state.active},r["editbtn "+n.state.id]=!0,r),on:{click:function(l){return l.stopPropagation(),t.startTool(n,a)}}},[s("img",{attrs:{height:"20px",width:"20px",src:t.resourcesurl+"images/"+n.state.icon}})])}),0)]),t._v(" "),s("td",{staticClass:"action-cell"},[!t.fieldrequired&&t.capabilities.includes("change_attr_feature")?s("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.form.relations.tooltips.unlink_relation",expression:"'plugins.editing.form.relations.tooltips.unlink_relation'",arg:"right",modifiers:{create:!0}}],staticClass:"g3w-mini-relation-icon g3w-icon",class:t.g3wtemplate.font.unlink,attrs:{"aria-hidden":"true"},on:{click:function(n){return n.stopPropagation(),t.unlinkRelation(a)}}}):t._e()]),t._v(" "),t._l(t.relationAttributesSubset(i),function(n){return s("td",[t.isMedia(n.value)&&t.getValue(n.value)?s("div",{staticClass:"preview"},[s("a",{attrs:{href:t.getValue(n.value),target:"_blank"}},[s("div",{staticClass:"previewtype",class:t.getMediaType(n.value.mime_type).type},[s("i",{staticClass:"fa-2x",class:t.g3wtemplate.font[t.getMediaType(n.value.mime_type).type]})])]),t._v(" "),s("div",{staticClass:"filename"},[t._v(t._s(t.getValue(n.value).split("/").pop()))])]):["photo","link"].includes(t.getFieldType(n))?s("a",{attrs:{href:t.getValue(n.value),target:"_blank"}},[t._v(t._s(t.getValue(n.value))+`
              `)]):s("span",[t._v(t._s(t.getValue(t.getRelationFeatureValue(i.id,n.name))))])])})],2)}),0)]):t._e()])],1)},fa=[],pa=function(t){t&&t("data-v-8137f454_0",{source:".g3w-editing-new-relation-vector-type[data-v-8137f454]{margin-bottom:5px;font-weight:700}.relation_header_title[data-v-8137f454]{width:100%;display:flex;font-weight:700;font-size:1.3em;align-items:center;background-color:#fff}.relation_header_tools[data-v-8137f454]{width:100%;display:flex;background-color:#fff}.g3w-editing-relations-add-link-tools[data-v-8137f454]{display:flex;justify-content:flex-end}.relation_vector_tools[data-v-8137f454]{display:flex;flex-direction:column;border:2px solid #eee;background-color:#fff;padding:10px}#g3w-select-editable-layers-content[data-v-8137f454]{flex-grow:1;display:flex;flex-direction:column}#search-box[data-v-8137f454]{margin-right:auto}.relation_body[data-v-8137f454]{padding:0}.g3wform-relation-table[data-v-8137f454]{width:100%}.close_vector_relation_tool[data-v-8137f454]{align-self:self-end}.close_vector_relation_tool>.g3w-icon[data-v-8137f454]{font-weight:700;cursor:pointer}.divider[data-v-8137f454]{display:block;position:relative;padding:0;margin-bottom:5px;height:0;width:100%;max-height:0;font-size:1px;line-height:0;clear:both;border:none;border-bottom:2px solid #eee}",map:void 0,media:void 0})},_a="data-v-8137f454",ma=void 0,ya=!1;va=ba({render:ha,staticRenderFns:fa},pa,ga,_a,ya,ma,!1,Vt,void 0,void 0),wa=va});var Ls={};xe(Ls,{default:()=>Aa});function Ra(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};o.__file="Table.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let h;if(e&&(h=r?function(u){e.call(this,c(u,this.$root.$options.shadowRoot))}:function(u){e.call(this,l(u))}),h!==void 0)if(o.functional){let u=o.render;o.render=function(p,_){return h.call(_),u(p,_)}}else{let u=o.beforeCreate;o.beforeCreate=u?[].concat(u,h):[h]}}return o}function $t(){let t=$t.styles||($t.styles={}),e=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let n=e?a.media||"default":i,r=t[n]||(t[n]={ids:[],parts:[],element:void 0});if(!r.ids.includes(i)){let l=a.source,g=r.ids.length;if(r.ids.push(i),a.map&&(l+=`
/*# sourceURL=`+a.map.sources[0]+" */",l+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),e&&(r.element=r.element||document.querySelector("style[data-group="+n+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],o=r.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),e&&(o.setAttribute("data-group",n),o.setAttribute("data-next-index","0")),c.appendChild(o)}if(e&&(g=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",g+1)),r.element.styleSheet)r.parts.push(l),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(l),o=r.element.childNodes;o[g]&&r.element.removeChild(o[g]),o.length?r.element.insertBefore(c,o[g]):r.element.appendChild(c)}}}}var Ts,pt,ka,Sa,xa,Ea,Fa,Ca,Ia,Ta,La,Pa,Aa,Rs=C(()=>{he();ee();We();Ne();it();Ke();ot();G();({tPlugin:Ts}=g3wsdk.core.i18n),{GUI:pt}=g3wsdk.gui,{resizeMixin:ka}=g3wsdk.gui.vue.Mixins,Sa=g3wsdk.gui.vue.Fields.media_field;Object.entries({Workflow:y,OpenFormStep:M}).forEach(([t,e])=>console.assert(e!==void 0,`${t} is undefined`));xa={name:"Table",mixins:[ka],components:{"g3w-media":Sa},data(){return{dataTable:null,show:!0,state:this.$options.service.state}},methods:{showTool(t){return this.state.capabilities.find(e=>e===t)!==void 0},async resize(){this.$el.style.display!=="none"&&(await this.$nextTick(),$("#editing_table  div.dataTables_scrollBody").height($(".content").height()-$(".close-panel-block").outerHeight()-$("#editing_table  div.dataTables_scrollHeadInner").outerHeight()-$(".editing_table_title").outerHeight()-$(".editing_table_header").outerHeight()-$(".editing_table_relation_messagge").outerHeight()-$(".dataTables_length").outerHeight()-$(".dataTables_paginate.paging_simple_numbers").outerHeight()-$(".dataTables_info").outerHeight()-$(".dataTables_filter").outerHeight()-$(".table_editing_footer_buttons").outerHeight()-$("#editing_table .dataTables_paginate.paging_simple_numbers").outerHeight()),this.dataTable&&this.dataTable.columns.adjust())},showValue(t){return!!this.state.headers.find(e=>t===e.name)},isMediaField(t){let e=!1;for(let s=0;s<this.state.headers.length;s++){let i=this.state.headers[s];if(t===i.name&&i.input.type==="media"){e=!0;break}}return e},stop(){this.state.promise.reject()},save(){this.state.isrelation?this.state.promise.resolve({features:(this._linkFeatures||[]).map(t=>this.state.features[t])}):this.state.promise.resolve()},cancel(){this.state.promise.reject()},async deleteFeature(t){let e=$(`#editing_table table tr#${t}`),s=this.state.inputs.layer,i=s.getId(),n=s.getChildren().length&&fe({layerId:i,relations:s.getRelations().getArray()}).length>0;try{await new Promise((r,l)=>{pt.dialog.confirm(`<h4>${Ts("editing.messages.delete_feature")}</h4>
                <div style="font-size:1.2em;">${n?Ts("editing.messages.delete_feature_relations"):""}</div>`,g=>{if(g){let c=this.state.features.findIndex(f=>f.getUid()===t),o=this.state.features[c],h=this.state.context.session,u=this.state.inputs.layer.getId();this.state.inputs.layer.getEditingSource().removeFeature(o),h.pushDelete(u,o),this.state.rows.splice(c,1),r()}else l()})}),this.dataTable.row(e).remove().draw(),await this.$nextTick()}catch(r){console.warn(r)}},async copyFeature(t){await new Promise(async(e,s)=>{let i=me(this.state.features.find(a=>t===a.getUid()),this.state.inputs.layer.getEditingLayer());this.state.workflow=new y({type:"addtablefeature",steps:[new E({help:"editing.steps.help.new",run:ye}),new M]}),this.state.inputs.features.push(i);try{let a=await w(this.state.workflow.start({context:this.state.context,inputs:this.state.inputs})),n=a.features[a.features.length-1],r={};Object.entries(this.state.rows[0]).forEach(([l,g])=>{r[l]=de({layerId:this.state.layerId,feature:n,property:l})}),r.__gis3w_feature_uid=n.getUid(),this.state.rows.push(r),e(r)}catch(a){console.warn(a),s(a)}finally{this.state.workflow.stop(),console.log("here we are")}}),this.show=!1,this.dataTable.destroy(),await this.$nextTick(),this.show=!0,await this.$nextTick(),this.setDataTable()},async editFeature(t){let e=this.state.features.findIndex(a=>t===a.getUid()),s=this.state.features[e];this.state.workflow=new y({type:"edittablefeature",steps:[new M]});let i=this.state.inputs;i.features.push(s);try{let a=await w(this.state.workflow.start({context:this.state.context,inputs:i})),n=a.features[a.features.length-1];Object.entries(this.state.rows[e]).forEach(([r,l])=>{this.state.rows[e][r]=de({layerId:this.state.layerId,feature:n,property:r})})}catch(a){console.warn(a)}finally{this.state.workflow.stop()}},linkFeature(t,e){e.target.checked?this._linkFeatures.push(t):this._linkFeatures=this._linkFeatures.filter(s=>s!==t)},getValue(t){return t&&typeof t=="object"&&Object===t.constructor?t=t.value:typeof t=="string"&&t.indexOf("_new_")===0&&(t=null),t},setDataTable(){this.dataTable=$("#editing_table table").DataTable({columnDefs:[{orderable:!1,targets:0}],order:[1,"asc"],pageLength:10,scrollCollapse:!0,scrollResize:!0,scrollX:!0}),this.resize()}},beforeCreate(){this.delayType="debounce",pt.disableSideBar(!0),pt.showUserMessage({type:"loading",message:"plugins.editing.messages.loading_table_data",autoclose:!1,closable:!1})},async mounted(){await this.$nextTick(),this.state.isrelation&&(this._linkFeatures=[]),this.setDataTable(),this.resize(),setTimeout(()=>pt.closeUserMessage(),300)},beforeDestroy(){this.cancel(),this._linkFeatures=null,this.dataTable.destroy()}},Ea=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"g3w-editing-table",attrs:{id:"editing_table"}},[s("div",{ref:"editing_table_header",staticClass:"editing_table_header"},[s("div",{staticClass:"editing_table_header_content"},[s("h3",{staticClass:"editing_table_title"},[t._v(t._s(t.state.title))])]),t._v(" "),t.state.isrelation?s("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.table.info",expression:"'editing.relation.table.info'"}],staticClass:"editing_table_relation_messagge"}):t._e()]),t._v(" "),t.show?s("table",{staticClass:"display",staticStyle:{width:"100%"}},[s("thead",[s("tr",[t.state.isrelation?t._e():s("th",{staticStyle:{"max-width":"60px"}}),t._v(" "),t.state.isrelation?s("th"):t._e(),t._v(" "),t._l(t.state.headers,function(i){return s("th",[t._v(t._s(i.label))])})],2)]),t._v(" "),s("tbody",t._l(t.state.rows,function(i,a){return s("tr",{key:i.__gis3w_feature_uid,attrs:{id:i.__gis3w_feature_uid}},[t.state.isrelation?t._e():s("td",[s("div",{attrs:{id:"table-editing-tools"}},[s("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.table.edit",expression:"'plugins.editing.table.edit'",arg:"right",modifiers:{create:!0}}]},[t.showTool("change_attr_feature")?s("i",{staticClass:"g3w-icon",class:t.g3wtemplate.font.pencil,staticStyle:{color:"#30cce7"},attrs:{"aria-hidden":"true"},on:{click:function(n){return n.stopPropagation(),t.editFeature(i.__gis3w_feature_uid)}}}):t._e()]),t._v(" "),s("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.table.copy",expression:"'plugins.editing.table.copy'",arg:"right",modifiers:{create:!0}}]},[t.showTool("add_feature")?s("i",{staticClass:"g3w-icon",class:t.g3wtemplate.font["copy-paste"],staticStyle:{color:"#d98b14",padding:"5px 7px 5px 7px"},attrs:{"aria-hidden":"true"},on:{click:function(n){return n.stopPropagation(),t.copyFeature(i.__gis3w_feature_uid)}}}):t._e()]),t._v(" "),s("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.table.delete",expression:"'plugins.editing.table.delete'",arg:"right",modifiers:{create:!0}}]},[t.showTool("delete_feature")?s("i",{staticClass:"g3w-icon",class:t.g3wtemplate.font["trash-o"],staticStyle:{color:"red"},attrs:{"aria-hidden":"true"},on:{click:function(n){return n.stopPropagation(),t.deleteFeature(i.__gis3w_feature_uid)}}}):t._e()])])]),t._v(" "),t.state.isrelation?s("td",[s("input",{staticClass:"magic-checkbox",attrs:{id:"relation__"+a,type:"checkbox"},on:{change:function(n){return t.linkFeature(a,n)}}}),t._v(" "),s("label",{attrs:{for:"relation__"+a}})]):t._e(),t._v(" "),t._l(i,function(n,r){return t.showValue(r)?s("td",{key:r},[t.getValue(n)&&t.isMediaField(r)?s("g3w-media",{attrs:{state:n}}):s("p",[t._v(t._s(t.getValue(n)))])],1):t._e()})],2)}),0)]):t._e(),t._v(" "),s("div",{ref:"table_editing_footer_buttons",staticClass:"table_editing_footer_buttons",attrs:{id:"buttons"}},[s("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.state.isrelation?"editing.form.buttons.save_and_back":"editing.form.buttons.save",expression:"state.isrelation ? 'editing.form.buttons.save_and_back' : 'editing.form.buttons.save'"}],staticClass:"btn btn-success",staticStyle:{"margin-right":"10px"},on:{click:function(i){return i.stopPropagation(),t.save.apply(null,arguments)}}}),t._v(" "),s("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.form.buttons.cancel",expression:"'editing.form.buttons.cancel'"}],staticClass:"btn btn-danger",on:{click:function(i){return i.stopPropagation(),t.cancel.apply(null,arguments)}}})])])},Fa=[],Ca=function(t){t&&(t("data-v-9019478e_0",{source:".g3w-editing-table table.dataTable tbody td{padding:3px 5px}",map:void 0,media:void 0}),t("data-v-9019478e_1",{source:".editing_table_title[data-v-9019478e]{margin-top:0;margin-bottom:2px;font-size:1.5em;font-weight:700;color:var(--skin-color)}#table-editing-tools[data-v-9019478e]{display:flex;justify-content:space-between}#table-editing-tools i[data-v-9019478e]{margin:5px}#buttons button.btn[data-v-9019478e]{font-weight:700!important;min-width:80px}.table_editing_footer_buttons[data-v-9019478e]{position:absolute;bottom:10px;width:100%;display:flex;justify-content:center}.editing_table_header_content[data-v-9019478e]{display:flex;justify-content:space-between;align-items:baseline}.editing_table_relation_messagge[data-v-9019478e]{margin-bottom:10px;font-size:1.3em;background-color:#f5f5f5;padding:3px;border-radius:3px;font-weight:700}",map:void 0,media:void 0}))},Ia="data-v-9019478e",Ta=void 0,La=!1;Pa=Ra({render:Ea,staticRenderFns:Fa},Ca,xa,Ia,La,Ta,!1,$t,void 0,void 0),Aa=Pa});var Ma,Ps,Xe,Ba,Oa,Da,As,j,ja,Ua,Na,Va,$a,za,Q,ve,Ze,we,M,ke,se,ue,We=C(()=>{$e();Ct();at();je();ps();Ue();ms();vs();Ge();Re();Et();Lt();Ke();ws();G();ze();jt();ut();xs();ee();he();({G3WObject:Ma,ApplicationState:Ps}=g3wsdk.core),{Geometry:Xe}=g3wsdk.core.geoutils,{convertSingleMultiGeometry:Ba}=g3wsdk.core.geoutils,{removeZValueToOLFeatureGeometry:Oa}=g3wsdk.core.geoutils.Geometry,{Layer:Da}=g3wsdk.core.layer,{Feature:As}=g3wsdk.core.layer.features,{GUI:j}=g3wsdk.gui,{Component:ja}=g3wsdk.gui.vue,{FormService:Ua}=g3wsdk.gui.vue.services,{AreaInteraction:Na,LengthInteraction:Va}=g3wsdk.ol.interactions.measure,{createMeasureTooltip:$a,removeMeasureTooltip:za}=g3wsdk.ol.utils,Q=class extends E{constructor(e={}){e.help="editing.steps.help.draw_new_feature",super(e),this._add=e.add===void 0?!0:e.add,this.drawInteraction,this.measeureInteraction,this.drawingFeature,this._snap=e.snap!==!1,this._stopPromise,this._delKeyRemoveLastPoint=s=>s.keyCode===46&&this.removeLastPoint()}run(e,s){return v(new Promise((i,a)=>{let n=new Promise(o=>this.resolve=o),r=e.layer.getId();if(Da.LayerTypes.VECTOR!==e.layer.getType())return;H({promise:v(n),inputs:e,style:this.selectStyle});let l=e.layer.getEditingGeometryType();this.geometryType=Xe.getOLGeometry(l);let g=e.layer.getEditingLayer().getSource(),c=e.layer.getEditingFields();this.drawInteraction=this.addInteraction(new ol.interaction.Draw({type:this.geometryType,source:new ol.source.Vector,condition:this._options.condition||(()=>!0),freehandCondition:ol.events.condition.never,finishCondition:this._options.finishCondition||(()=>!0)}),{drawstart:({feature:o})=>{this.drawingFeature=o,document.addEventListener("keydown",this._delKeyRemoveLastPoint)},drawend:o=>{let h;this._add?(c.forEach(u=>o.feature.set(u.name,null)),h=new As({feature:o.feature}),h.setTemporaryId(),g.addFeature(h),s.session.pushAdd(r,h,!1)):h=o.feature,Xe.is3DGeometry(l)&&(h=Xe.addZValueToOLFeatureGeometry({feature:h,geometryType:l})),e.features.push(h),this.getContext().get_default_value=!0,this.fireEvent("addfeature",h),i(e)}}),this.drawInteraction.setActive(!0)}))}addMeasureInteraction(){let e=Xe.isLineGeometryType(this.geometryType),s=Xe.isPolygonGeometryType(this.geometryType);!e&&!s||(this.measureInteraction=this.addInteraction(new(e?Va:Na)({projection:j.getService("map").getProjection(),drawColor:"transparent",feature:this.drawingFeature})),this.measureInteraction.setActive(!0))}removeMeasureInteraction(){this.measureInteraction&&(this.measureInteraction.clear(),this.removeInteraction(this.measureInteraction),this.measureInteraction=null)}removeLastPoint(){try{this.drawInteraction&&this.drawInteraction.removeLastPoint()}catch(e){console.warn(e)}}stop(){return this.removeInteraction(this.drawInteraction),this.removeMeasureInteraction(),this.resolve(!0),this.drawInteraction=null,this.drawingFeature=null,this.resolve=null,document.removeEventListener("keydown",this._delKeyRemoveLastPoint),!0}},ve=class extends E{constructor(e={}){e.snap=e.snap===void 0||e.snap,e.help="editing.steps.help.edit_feature_vertex",super(e),this._originalStyle=null,this._feature=null,this.tooltip}run(e,s){let i;return v(new Promise((a,n)=>{let r=e.layer.getId(),l=this._feature=e.features[0],g=l.clone();this._originalStyle=e.layer.getEditingLayer().getStyle();let c={modified:!1};ht({feature:l}),j.showUserMessage({type:"tool",position:"left",size:"small",title:"plugins.editing.tools.update_vertex",closable:!1,hooks:{body:{template:`
              <div style = "display: flex; justify-content: space-between; padding: 10px;"> 
                <button v-disabled = "false === state.modified" @click.stop = "resolve" v-t = "'save'" class = "btn btn-success"></button>
                <button @click.stop = "reject"  v-t = "'cancel'" class = "btn btn-danger"></button>
              </div>
            `,data(){return{state:c}},methods:{resolve(){e.features.push(i),a(e)},reject(){n()}},beforeDestroy(){c.modified&&s.session.pushUpdate(r,i,g)}}}}),this._modifyInteraction=this.addInteraction(new ol.interaction.Modify({features:new ol.Collection([l]),deleteCondition:this._options.deleteCondition||ol.events.condition.altKeyOnly,condition:o=>{let h=o.map.getFeaturesAtPixel(o.pixel,{hitTolerance:10});return h.length>=2&&h.slice(1).find(u=>l._uid===u._uid)}}),{modifyend:o=>{i=o.features.getArray()[0].clone(),i.getGeometry().getExtent()!==g.getGeometry().getExtent()&&Z({inputs:e,context:s,feature:i}).finally(()=>{c.modified=!0})}})}))}addMeasureInteraction(){this._modifyInteraction.on("modifystart",e=>{this.tooltip=$a({map:this.getMap(),feature:e.features.getArray()[0]})})}removeMeasureInteraction(){this.tooltip&&za({map:this.getMap(),...this.tooltip}),this.tooltip=null}stop(){return j.closeUserMessage(),this._feature.setStyle(this._originalStyle),!0}},Ze=class extends E{constructor(e={}){e.help="editing.steps.help.rotate",super(e),this.isChange=!1,this._feature=null,this._originalFeature=null,this.drawInteraction=null,this.promise}run(e){return v(new Promise(s=>{let i=new Promise(a=>this.resolve=a);this.changeKey=null,H({promise:v(i),inputs:e,style:this.selectStyle}),this.addInteraction(new ft({features:e.features}),{rotatestart:a=>{this._feature=a.feature,this.isChange=!0,this._originalFeature=this._feature.clone()},rotateend:async a=>{this.isChange&&await this.updateFeature(a.feature),this.isChange=!1,s(e)}}).select(e.features.at(-1))}))}async updateFeature(){let e=this.getInputs(),s=this.getContext();try{await Z({inputs:e,context:s,feature:this._feature})}catch(i){console.warn(i)}s.session.pushUpdate(e.layer.getId(),this._feature.clone(),this._originalFeature)}async stop(e,s){this.isChange&&(await this.updateFeature(),s.session.save()),this.resolve(!0),this.resolve=null,this.isChange=!1,j.closeUserMessage()}},we=class extends E{constructor(e={}){e.help="editing.steps.help.move",super(e),this.drawInteraction=null,this.promise}run(e,s){return v(new Promise(i=>{let a=new Promise(g=>this.resolve=g),n=e.layer.getId(),r=null;this.changeKey=null;let l=!1;H({promise:v(a),inputs:e,style:this.selectStyle}),this.addInteraction(new ol.interaction.Translate({features:new ol.Collection(e.features),hitTolerance:isMobile&&isMobile.any?10:0}),{translatestart:g=>{let c=g.features.getArray()[0];this.changeKey=c.once("change",()=>l=!0),r=c.clone()},translateend:g=>{ol.Observable.unByKey(this.changeKey);let c=g.features.getArray()[0];l?Z({inputs:e,context:s,feature:c}).finally(()=>{s.session.pushUpdate(n,c.clone(),r),i(e)}):i(e)}})}))}stop(){this.resolve(!0),this.resolve=null,this.changeKey=null}},M=class extends E{constructor(e={}){e.help="editing.steps.help.insert_attributes_feature",super(e),this._saveAll=e.saveAll===!1?e.saveAll:async()=>{},this._saveAllError=!1,this._multi=e.multi||!1,this.layerId,this._isContentChild=!1,this._features,this._originalFeatures,this.promise,this._unwatchs=[]}updateMulti(e=!1){this._multi=e}run(e,s){return v(async()=>{this._isContentChild=s.isContentChild===void 0?y.Stack.getLength()>1:s.isContentChild,this.layerId=e.layer.getId(),this._features=this._multi?e.features:[e.features[e.features.length-1]],this._originalFeatures=this._features.map(a=>a.clone());let i=new Promise(a=>{g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").subscribe(`closeform_${this.layerId}`,()=>(a(),{once:!0}))});return H({promise:v(i),inputs:e,style:this.selectStyle}),new Promise(async(a,n)=>{if(j.setLoadingContent(!1),j.getService("map").disableClickMapControls(!0),!this._multi&&Array.isArray(e.features[e.features.length-1])){a();return}g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").setCurrentLayout();let r=e.layer.getName();this._isContentChild&&(s.fatherValue=s.fatherValue||[],(s.fatherField||[]).forEach((h,u)=>{this._features[0].set(h,s.fatherValue[u]),this._originalFeatures[0].set(h,s.fatherValue[u])}));let l=fs({inputs:e,context:s,feature:this._features[0],isChild:this._isContentChild,multi:this._multi});y.Stack.getCurrent().setInput({key:"fields",value:l});let g=!this._multi&&e.features&&e.features[e.features.length-1],c=!this._multi&&e.layer.getId();g&&!g.isNew()&&e.layer.getLayerEditingFormStructure()&&await le(e.layer.getId(),{relations:e.layer.getRelations().getArray().filter(h=>e.layer.getId()===h.getFather()&&J(h.getChild())&&h.getType()!=="ONE"),feature:g,filterType:"fid"});let o=j.showForm({feature:this._originalFeatures[0],title:"plugins.editing.editing_attributes",name:r,crumb:{title:r},id:`form_${r}`,dataid:r,layer:e.layer,isnew:this._originalFeatures.length>1?!1:this._originalFeatures[0].isNew(),parentData:Ve(),fields:l,context_inputs:this._multi?!1:{context:s,inputs:e},formStructure:e.layer.hasFormStructure()&&e.layer.getLayerEditingFormStructure()||void 0,modal:!0,push:this._options.push||this._isContentChild,showgoback:this._options.showgoback===void 0?!this._isContentChild:this._options.showgoback,headerComponent:this._saveAll&&{template:`
              <section class = "editing-save-all-form" style = "display: flex;">
                <div
                  class  = "editing-button"
                  :style = "{ cursor: disabled ? 'not-allowed' : 'pointer' }"
                  style  = "background-color: #fff; display: flex; justify-content: flex-end; width: 100%;"
                >
                  <span
                    class               = "save-all-icon"
                    v-disabled          = "disabled"
                    @click.stop.prevent = "saveAll"
                  >
                    <i
                      class  = "skin-color"
                      :class = "g3wtemplate.font['save']"
                      style  = "font-size: 1.8em; padding: 5px; border-radius: 5px; cursor: pointer; box-shadow: 0 3px 5px rgba(0,0,0,0.5); margin: 5px;"
                    ></i>
                  </span>
                </div>
                <!-- @since 3.9.0 -->
                <div
                  v-if       = "isChild"  
                  class      = "close-form-button"
                  :style     = "{ cursor: !disabled ? 'not-allowed' : 'pointer' }"
                  style      = "background-color: #fff; display: flex; justify-content: flex-end; width: 100%;"
                >
                  <span
                    class               = "save-all-icon skin-color-dark"
                    v-disabled          = "!disabled"
                    @click.stop.prevent = "closeForm"
                  >
                    <i
                      :class = "g3wtemplate.font['close']"
                      style  = "font-size: 1.8em; padding: 5px; border-radius: 5px; cursor: pointer; box-shadow: 0 3px 5px rgba(0,0,0,0.5); margin: 5px;"
                    ></i>
                  </span>
                </div> 
              </section>`,name:"Saveall",props:{update:{type:Boolean},valid:{type:Boolean}},data(){return{enabled:y.Stack._workflows.slice(0,y.Stack.getLength()-1).every(h=>{let u=(h.getContext().service instanceof Ua?h.getContext().service.getState():{}).valid;return u||u===void 0}),isChild:y.Stack.getLength()>1&&!(y.Stack.getLength()===2&&y.Stack.getFirst().isType("edittable"))}},computed:{disabled(){return!this.enabled||!(this.valid&&this.update)}},methods:{setError:(h=!1)=>this._saveAllError=h,async saveAll(){j.setLoadingContent(!0),j.disableContent(!0);try{await Promise.allSettled([...y.Stack._workflows].reverse().filter(h=>typeof h.getLastStep()._saveAll=="function").map(h=>new Promise(async u=>{let f=h.getLastStep(),p=h.getContext().service.state.fields.filter(m=>f._multi?m.value!==null:!0);await y.Stack.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),f._features.forEach(m=>f.getInputs().layer.setFieldsWithValues(m,p));let _=f._features.map(m=>m.clone());return f._isContentChild&&(f.getInputs().relationFeatures={newFeatures:_,originalFeatures:f._originalFeatures}),await f.fireEvent("saveform",{newFeatures:_,originalFeatures:f._originalFeatures}),_.forEach((m,b)=>f.getContext().session.pushUpdate(f.layerId,m,f._originalFeatures[b])),await Mt({layerId:f.layerId,features:_,fields:p,task:f}),f.fireEvent("savedfeature",_),f.fireEvent(`savedfeature_${f.layerId}`,_),f.getContext().session.save(),u()})))}catch(h){console.warn(h)}try{await w(g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").service.commit({modal:!1})),this.setError(!1),[...y.Stack._workflows].reverse().filter(h=>typeof h.getLastStep()._saveAll=="function").forEach(h=>{let u=h.getContext().service;u.setUpdate(!1,{force:!1});let f=u.feature;f.isNew()&&(f.state.new=!1,u.force.update=!1),Object.entries(h.getInputs().layer.getEditingSource().readFeatures().find(p=>p.getUid()===f.getUid()).getProperties()).forEach(([p,_])=>{let m=u.getFields().find(b=>p===b.name);m&&(m.value=m._value=_)})})}catch(h){this.setError(!0),console.warn(h)}j.setLoadingContent(!1),j.disableContent(!1)},async closeForm(){let h=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.toolboxselected.getActiveTool();await w(h.stop()),y.Stack.clear(),h.getOperator().runOnce||h.start()}}},buttons:[{id:"save",title:this._isContentChild?y.Stack.getParent().getBackButtonLabel()||"plugins.editing.form.buttons.save_and_back":"plugins.editing.form.buttons.save",type:"save",class:"btn-success",cbk:async(h=[])=>{if(h=this._multi?h.filter(f=>f.value!==null):h,h.length===0){a(e);return}let u=[];j.setLoadingContent(!0),j.disableContent(!0),await y.Stack.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),j.setLoadingContent(!1),j.disableContent(!1),this._features.forEach(f=>{e.layer.setFieldsWithValues(f,h),u.push(f.clone())}),this._isContentChild&&(e.relationFeatures={newFeatures:u,originalFeatures:this._originalFeatures}),await this.fireEvent("saveform",{newFeatures:u,originalFeatures:this._originalFeatures}),u.forEach((f,p)=>s.session.pushUpdate(this.layerId,f,this._originalFeatures[p])),await Mt({layerId:this.layerId,features:u,fields:h,task:this}),j.setModal(!1),this.fireEvent("savedfeature",u),this.fireEvent(`savedfeature_${this.layerId}`,u),this._isContentChild&&y.Stack.getParents().filter(f=>f.getContextService()&&f.getContextService().setUpdate).forEach(f=>f.getContextService().setUpdate(!0,{force:!0})),a(e)}},{id:"cancel",title:"plugins.editing.form.buttons.cancel",type:"cancel",class:"btn-danger",eventButtons:{update:{false:{id:"close",title:"close",type:"cancel",class:"btn-danger"}}},cbk:()=>{this._saveAllError&&[...y.Stack._workflows].reverse().filter(h=>typeof h.getLastStep()._saveAll=="function").map(h=>h.getLastStep().getContext().session.undo()),this.fireEvent("cancelform",e.features),n(e)}}]});o.handleRelation=async h=>{if(this._multi){j.showUserMessage({type:"info",message:"plugins.editing.errors.editing_multiple_relations",duration:3e3,autoclose:!0});return}j.setLoadingContent(!0),await Fe(e.layer.getRelationById(h.relation.name).getChild()),o.setCurrentComponentById(h.relation.name),j.setLoadingContent(!1)},o.addComponents([...g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.formComponents[c]||[],...lt({layerId:c,relations:this._multi?[]:e.layer.getRelations().getArray().filter(h=>h.getType()!=="ONE"&&h.getFather()===c),feature:this._multi?!1:e.features[e.features.length-1]}).map(({relation:h,relations:u})=>({title:"plugins.editing.edit_relation",name:h.name,id:h.id,header:!1,component:Vue.extend({mixins:[(Is(),Ee(Cs))],name:`relation_${Date.now()}`,data(){return{layerId:c,relation:h,relations:u}}})}))]),this.fireEvent("openform",{layerId:this.layerId,session:s.session,feature:this._originalFeature,formService:o}),y.Stack.getCurrent()&&y.Stack.getCurrent().setContextService(o),bs({layerId:this.layerId,fields:l,formService:o}).then(h=>this._unwatchs=h),this.disableSidebar(!0)})})}stop(){this.disableSidebar(!1);let e=this._isContentChild===!1||y.Stack.getLength()===2&&y.Stack.getParent().isType("edittable");e&&(j.getService("map").disableClickMapControls(!1),j.setModal(!1));let s=e&&y.Stack.getCurrent().getContextService();s&&s.setUpdate&&this._isContentChild===!1&&s.setUpdate(!1,{force:!1}),j.closeForm({pop:this.push||this._isContentChild&&j.getContentLength()>1}),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").resetCurrentLayout(),this.fireEvent("closeform"),this.fireEvent(`closeform_${this.layerId}`),this.layerId=null,this._unwatchs.forEach(i=>i()),this._unwatchs=[],this._saveAllError=!1}},ke=class extends E{constructor(e={}){e.help="editing.steps.help.edit_table",super(e)}run(e,s){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").setCurrentLayout(),v(new Promise((i,a)=>{this._isContentChild=y.Stack.getLength()>1;let n=e.layer.readEditingFeatures()||[],r=(e.layer.getEditingFields()||[]).filter(c=>n.length?Object.keys(n[0].getProperties()).includes(c.name):!0);this._isContentChild=y.Stack.getLength()>1;let l=this._isContentChild?s.excludeFields||[]:[],g=Object.assign(new Ma,{state:{inputs:e,context:s,promise:{resolve:i,reject:a},headers:r,features:n,rows:n.length>0?(l.length>0?n.filter(c=>!l.reduce((o,h,u)=>o&&s.fatherValue[u]===`${c.get(h)}`,!0)):n).map(c=>r.map(o=>o.name).reduce((o,h)=>Object.assign(o,{[h]:de({layerId:e.layer.getId(),feature:c,property:h}),__gis3w_feature_uid:c.getUid()}),{})):n,title:`${e.layer.getName()}`||"Link relation",isrelation:this._isContentChild,capabilities:e.layer.getEditingCapabilities(),layerId:e.layer.getId(),workflow:null}});j.showContent({content:new ja({title:`${e.layer.getName()}`,push:this._isContentChild,service:g,state:g.state,internalComponent:new(Vue.extend((Rs(),Ee(Ls)).default))({service:g})}),push:this._isContentChild,showgoback:!1,closable:!1})}))}stop(){this.disableSidebar(!1),j[this._isContentChild?"popContent":"closeContent"](),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").resetCurrentLayout()}},se=class extends E{constructor(e={}){e.help="editing.steps.help.pick_feature",e.highlight=e.highlight||!1,e.multi=e.multi||!1,super(e)}run(e){let s=new Promise(i=>{this.addInteraction(new re({layer:e.layer.getEditingLayer()}),{picked:a=>{e.features.length===0&&(e.features=a.features,e.coordinate=a.coordinate),this._steps&&this.setUserMessageStepDone("select"),i(e)}})});return v(async()=>(H({promise:v(s),inputs:e,style:this.selectStyle}),s))}},ue=class extends E{constructor(e={},s){e.help=e.help||"editing.steps.help.select_elements",super(e),this._selectInteractions=[],this.multipleselectfeatures=[],this._originalStyle,this._vectorLayer,s&&this.on("run",()=>{this.emit("next-step",g3wsdk.core.i18n.tPlugin("editing.steps.help.select_elements"))})}run(e,s){let i=e.layer,a=this._options.type||"bbox",n=a==="multiple"&&!!this._steps.select.buttonnext;return v(new Promise((r,l)=>{if(n){let{done:c}=this._steps.select.buttonnext;this._steps.select.buttonnext.done=()=>{c&&c instanceof Function&&c(),r(e)}}let g={};if(["single","multiple"].includes(a)&&(g.single=new re({layer:i.getEditingLayer()}),g.single.on("picked",async({features:c})=>{let o;if(c.length>1)try{o=await oe({features:c,inputs:this.getInputs()})}catch(h){console.warn(h)}else o=c[0];o&&(e.features=[o],n?gt([o],e,this.multipleselectfeatures,this):(this._originalStyle=pe(e.features),this._steps&&this.setUserMessageStepDone("select"),r(e)))})),["multiple","bbox"].includes(a)&&Ps.ismobile&&(this._vectorLayer=new ol.layer.Vector({source:new ol.source.Vector({})}),this.getMap().addLayer(this._vectorLayer),g.multi=new ol.interaction.Draw({type:"Circle",source:this._vectorLayer.getSource(),geometryFunction:ol.interaction.Draw.createBox()}),g.multi.on("drawend",c=>{let o=i.getEditingLayer().getSource().getFeaturesInExtent(c.feature.getGeometry().getExtent());n?gt(o,e,this.multipleselectfeatures,this):o.length>0?(e.features=o,this._originalStyle=pe(o),this._steps&&this.setUserMessageStepDone("select"),setTimeout(()=>r(e),500)):l()})),["multiple","bbox"].includes(a)&&!Ps.ismobile&&(g.dragbox=new ol.interaction.DragBox({condition:ol.events.condition.shiftKeyOnly}),g.dragbox.on("boxend",()=>{let c=[],o=g.dragbox.getGeometry().getExtent();i.getEditingLayer().getSource().forEachFeatureIntersectingExtent(o,h=>{c.push(h)}),n?gt(c,e,this.multipleselectfeatures,this):c.length>0?(e.features=c,this._originalStyle=pe(c),this._steps&&this.setUserMessageStepDone("select"),r(e)):l()})),a==="external"){let c=i.getGeometryType(),o=i.getId(),h=i.getEditingLayer().getSource(),{session:u}=this.getContext();g.external=new re({layers:j.getService("map").getExternalLayers().filter(f=>{let p=f.getType()=="VECTOR"&&f.getSource().getFeatures();return p.length>0?ae(p[0].getGeometry().getType(),c):!0})}),g.external.on("picked",f=>{if(!(f.features.length>0)){l();return}let p=i.getEditingFields(),_=f.features[0].getGeometry();c!==_.getType()&&f.feature.setGeometry(Ba(_,c));let m=new As({feature:f.feature,properties:p.map(b=>((b.pk||b.input.type==="media"||f.feature.get(b.name)===void 0)&&f.feature.set(b.name,null),b.name))});Z({inputs:e,context:s,feature:m}).finally(()=>{Oa({feature:m}),m.setTemporaryId(),h.addFeature(m),u.pushAdd(o,m,!1),e.features.push(m),r(e)})})}Object.values(g).forEach(c=>this.addInteraction(c)),this._selectInteractions.push(...Object.values(g))}))}stop(){Object.values(this.getSteps()||{}).forEach(e=>e.reset&&e.reset()),this._selectInteractions.forEach(e=>this.removeInteraction(e)),this._vectorLayer&&this.getMap().removeLayer(this._vectorLayer),this.getInputs().features.forEach(e=>e.setStyle(this._originalStyle)),this._originalStyle=null,this._vectorLayer=null,this._selectInteractions=[],this.multipleselectfeatures=[]}}});var Ms={};xe(Ms,{default:()=>Qa});function Ja(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};return o.__file="CopyFeaturesFromOtherLayers.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i,o}var Ga,Ha,qa,Ka,Wa,Xa,Za,Ya,Qa,Bs=C(()=>{Ga={name:"Copyfeaturesfromotherlayers",data(){return{id:this.$options.layers.find(t=>t.selected).id}},watch:{id(t){this.$options.layers.forEach(e=>e.selected=t===e.id)}}},Ha=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",[s("div",{attrs:{id:"g3w-select-editable-layers-content"}},[s("select",{directives:[{name:"select2",rawName:"v-select2",value:"id",expression:"'id'"}],attrs:{id:"g3w-select-editable-layers-to-copy"}},t._l(t.$options.layers,function(i){return s("option",{key:i.id,domProps:{value:i.id}},[t._v(t._s(i.name))])}),0)])])},qa=[],Ka=void 0,Wa=void 0,Xa=void 0,Za=!1;Ya=Ja({render:Ha,staticRenderFns:qa},Ka,Ga,Wa,Za,Xa,!1,void 0,void 0,void 0),Qa=Ya});function Ws({feature:t,coordinates:e}){let s=t.getGeometry(),i=s.getType(),a=(n,r)=>g3wsdk.core.geoutils.areCoordinatesEqual(n,r);switch(i){case"Polygon":case"MultiLineString":return e=e.flat(),s.getCoordinates().flat().every((n,r)=>a(n,e[r]));case"LineString":case"MultiPoint":return s.getCoordinates().every((n,r)=>a(n,e[r]));case"MultiPolygon":return e.length!==s.getPolygons().length?!1:s.getPolygons().some((n,r)=>{let l=e[r].flat();return n.getCoordinates().flat().every((g,c)=>a(g,l[c]))});case"Point":return a(e,s.getCoordinates());default:return!1}}var Xs=C(()=>{});var Zs={};xe(Zs,{default:()=>wr});function br(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};o.__file="Changes.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let h;if(e&&(h=r?function(u){e.call(this,c(u,this.$root.$options.shadowRoot))}:function(u){e.call(this,l(u))}),h!==void 0)if(o.functional){let u=o.render;o.render=function(p,_){return h.call(_),u(p,_)}}else{let u=o.beforeCreate;o.beforeCreate=u?[].concat(u,h):[h]}}return o}function qt(){let t=qt.styles||(qt.styles={}),e=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let n=e?a.media||"default":i,r=t[n]||(t[n]={ids:[],parts:[],element:void 0});if(!r.ids.includes(i)){let l=a.source,g=r.ids.length;if(r.ids.push(i),a.map&&(l+=`
/*# sourceURL=`+a.map.sources[0]+" */",l+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),e&&(r.element=r.element||document.querySelector("style[data-group="+n+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],o=r.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),e&&(o.setAttribute("data-group",n),o.setAttribute("data-next-index","0")),c.appendChild(o)}if(e&&(g=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",g+1)),r.element.styleSheet)r.parts.push(l),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(l),o=r.element.childNodes;o[g]&&r.element.removeChild(o[g]),o.length?r.element.insertBefore(c,o[g]):r.element.appendChild(c)}}}}var gr,hr,fr,pr,_r,mr,yr,vr,wr,Js=C(()=>{Xs();Ke();gr={name:"changes",props:{commits:{type:Object,required:!0},layer:{type:Object,required:!0},relation:{type:Boolean,default:!1}},data(){return{features:this.layer.readFeatures(),efeatures:this.layer.readEditingFeatures()}},methods:{getFormattedValue(t,e){if(t)return e==="geometry"&&t.get(e)?`(${t.get(e).getFlatCoordinates().length/2})`:de({layerId:this.layer.getId(),feature:t,property:e})},getValue(t,e){return this.getFormattedValue(this.getFeature(t),e)},getEditingValue(t,e){return this.getFormattedValue(this.getEditingFeature(t),e)},hasValue(t,e){let s=this.getFeature(t),i=this.getEditingFeature(t);return!(s&&i&&s.get(e)===null&&i.get(e)===null||s&&!i&&s.get(e)===null)},getId(t){return t.id||t},getEditingFeature(t){return this.efeatures.find(e=>this.getId(t)===e.getId())},getFeature(t){return this.features.find(e=>this.getId(t)===e.getId())},getType(t){let e=this.getEditingFeature(t)||this.getFeature(t);return e&&e.getGeometry&&e.getGeometry()?e.getGeometry().getType():""},isEdited(t,e){let s=this.getFeature(t),i=this.getEditingFeature(t);return[s,i].includes(void 0)?!1:this.getType(t)&&e==="geometry"?!Ws({feature:s,coordinates:i.get(e).getCoordinates()}):i.get(e)!==s.get(e)},getAttrs(t){let e=this.getEditingFeature(t)||this.getFeature(t);return Object.entries(e?e.getProperties():{}).sort((s,i)=>s[0]>i[0])},getLayerById(t){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").service.getLayerById(t)}},async mounted(){(this.$refs.value||[]).filter(t=>!t.textContent).forEach(t=>t.innerHTML="<i><code>&lt;empty&gt;</code></i>")}},hr=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.relation?s("h4",{directives:[{name:"t-plugin",rawName:"v-t-plugin:pre",value:"editing.messages.commit.header_relation",expression:"'editing.messages.commit.header_relation'",arg:"pre"}],staticClass:"skin-color g3w-long-text",staticStyle:{"font-weight":"bold",margin:"15px 0"}},[t._v(": "+t._s(t.layer.getName()))]):t._e(),t._v(" "),t._l(Object.keys(t.commits).filter(function(i){return t.commits[i].length}),function(i){return[s("h4",{directives:[{name:"t-plugin",rawName:"v-t-plugin:pre",value:"editing.messages.commit."+i,expression:"`editing.messages.commit.${c}`",arg:"pre"}]},[t._v(" ("+t._s(t.commits[i].length)+") ")]),t._v(" "),s("divider"),t._v(" "),s("ul",t._l(t.commits[i],function(a){return s("li",[s("details",[s("summary",[t._v(t._s(t.getType(a))+" #"+t._s(t.getId(a)))]),t._v(" "),t._l(t.getAttrs(a),function(n){var r=n[0],l=n[1];return[t.hasValue(a,r)?s("dl",[s("dt",[t._v(t._s(r)+":")]),t._v(" "),s("dd",[t.isEdited(a,r)?[s("del",{ref:"value",refInFor:!0},[t._v(t._s(t.getValue(a,r)))]),t._v(" \u2190 "),s("ins",{ref:"value",refInFor:!0},[t._v(t._s(t.getEditingValue(a,r)))])]:s("span",{ref:"value",refInFor:!0},[t._v(t._s(t.getEditingValue(a,r)||t.getValue(a,r)))]),t._v(" "),r==="geometry"?s("i",[s("code",[t._v("<coords>")])]):t._e()],2)]):t._e()]})],2)])}),0)]}),t._v(" "),t._l(Object.entries(t.commits.relations),function(i){var a=i[0],n=i[1];return s("changes",{attrs:{commits:{add:n.add,update:n.update,delete:n.delete,relations:n.relations},relation:!0,layer:t.getLayerById(a)}})})],2)},fr=[],pr=function(t){t&&t("data-v-d221b78a_0",{source:"summary[data-v-d221b78a]{display:list-item;font-weight:700;padding:.5em;cursor:pointer;background-color:rgb(255,255,0,.25);font-size:medium;user-select:none}ul[data-v-d221b78a]{list-style:none;padding-left:0}ul>li[data-v-d221b78a]{margin-bottom:8px}ins[data-v-d221b78a]{background-color:#0f0;text-decoration-line:none}del[data-v-d221b78a]{background-color:tomato}dl[data-v-d221b78a]{display:grid;grid-template:auto/.5fr 1fr;margin-bottom:0;word-break:break-all}dt[data-v-d221b78a]{background:#fee}dd[data-v-d221b78a]{background:#f0f1f3}dd[data-v-d221b78a],dt[data-v-d221b78a]{margin:0;padding:.3em .5em;border-top:1px solid #fff}",map:void 0,media:void 0})},_r="data-v-d221b78a",mr=void 0,yr=!1;vr=br({render:hr,staticRenderFns:fr},pr,gr,_r,yr,mr,!1,qt,void 0,void 0),wr=vr});function Rr(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};o.__file="Toolbox.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let h;if(e&&(h=r?function(u){e.call(this,c(u,this.$root.$options.shadowRoot))}:function(u){e.call(this,l(u))}),h!==void 0)if(o.functional){let u=o.render;o.render=function(p,_){return h.call(_),u(p,_)}}else{let u=o.beforeCreate;o.beforeCreate=u?[].concat(u,h):[h]}}return o}function Wt(){let t=Wt.styles||(Wt.styles={}),e=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let n=e?a.media||"default":i,r=t[n]||(t[n]={ids:[],parts:[],element:void 0});if(!r.ids.includes(i)){let l=a.source,g=r.ids.length;if(r.ids.push(i),a.map&&(l+=`
/*# sourceURL=`+a.map.sources[0]+" */",l+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),e&&(r.element=r.element||document.querySelector("style[data-group="+n+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],o=r.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),e&&(o.setAttribute("data-group",n),o.setAttribute("data-next-index","0")),c.appendChild(o)}if(e&&(g=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",g+1)),r.element.styleSheet)r.parts.push(l),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(l),o=r.element.childNodes;o[g]&&r.element.removeChild(o[g]),o.length?r.element.insertBefore(c,o[g]):r.element.appendChild(c)}}}}var Kt,Ys,Cd,kr,Sr,Qe,et,xr,Er,Fr,Cr,Ir,Tr,Lr,Pr,Qs,ei=C(()=>{jt();({GUI:Kt}=g3wsdk.gui),{Layer:Ys}=g3wsdk.core.layer,{CatalogLayersStoresRegistry:Cd}=g3wsdk.core.catalog,{getResolutionFromScale:kr}=g3wsdk.ol.utils,{tPlugin:Sr}=g3wsdk.core.i18n,et=new ol.Collection([]),xr={name:"Toolbox",props:{state:{type:Object,required:!0},resourcesurl:{type:String}},data(){return{active:!1,helpmessage:null,toggled:{relation:!1,layer:!1},snapAll:!1}},computed:{editDisabled(){return this.state.loading&&!this.state.startstopediting||this.state.editing.on&&!!this.state.activetool?.disableEdit},hasRelations(){return this.state.editing.dependencies.length>0},loading(){return this.state.loading||this.state.changingtools},canEdit(){return this.state.editing.canEdit},father(){return this.state.editing.father&&this.hasRelations},showtoolsoftool(){return this.state.toolsoftool.length>0},isLayerReady(){return this.state.layer.state.editing.ready},toolboxCursor(){return!this.isLayerReady||!this.canEdit?`url(${this.resourcesurl}cursors/mZoomIn.svg), zoom-in`:void 0},get_tool_title(){return t=>g3wsdk.core.ApplicationState.language&&Sr(t)}},methods:{select(){this.isLayerReady&&!this.state.selected&&this.$emit("setselectedtoolbox",this.state.id)},fitZoomToScale(t){if(this.state.selected&&!this.canEdit){let e=Kt.getService("map");e.goToRes(e.getCenter(),kr(this.state._constraints.scale,e.getMapUnits()))}},async toggleEditing(){this.toggled.layer=!(this.state.editing.on||this.toggled.layer),this.toggled.layer&&this.state.layer.state.editing.ready&&!this.state.loading&&this.$emit(this.state.editing.on?"stoptoolbox":"starttoolbox",this.state.id),this.toggled.layer||this.$emit("stoptoolbox",this.state.id),this.select()},toggleTool(t){t===void 0?this.$emit("stopactivetool",this.state.id):this.$emit("setactivetool",t,this.state.id),this.select()},toggleFilterByRelation(){this.toggled.relation=!this.toggled.relation,this.$emit("update-filter-layers",this.toggled.relation?[this.state.id,...this.state.editing.dependencies]:[])},_initSnap(t){this.uids=this.state.activetool.getOperator().getInputs().features.map(e=>e._uid),this.snapEvents=[],this.snapToolboxes=[],this.snapUnwatches=[],this.checkbox={bs:!1,ba:!1},g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayers().filter(e=>Ys.LayerTypes.VECTOR===e.getType()).filter(e=>t.options.layerId!==e.getId()).forEach(e=>{let s=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById(e.getId()).getState().editing;this.snapUnwatches.push(this.$watch(()=>s.on,this.setShowSnapAll)),this.snapToolboxes.push(s)}),this.snapUnwatches.push(this.$watch(()=>[t.options.checked,t.options.checkedAll],([e,s])=>{(e&&this.checkbox.ba||s&&this.checkbox.bs)&&(t.options[e&&this.checkbox.ba?"checkedAll":"checked"]=!1),this.checkbox.bs=e,this.checkbox.ba=s,!(e&&s)&&this.handleSnapInteractionFeatures({tool:t,active:e||s,all:s})})),this.setShowSnapAll(t)},_unloadSnap(){try{this.snapEvents.forEach(t=>{Object.keys(t.settersAndKeys).forEach(e=>t.source.un(e,t.settersAndKeys[e])),ol.Observable.unByKey(t.olKey)}),this.snapUnwatches.forEach(t=>t()),this.snapUnwatches=[],this.snapToolboxes=[],this.snapEvents=[],this.clearSnapFeatures()}catch(t){console.warn(t)}},clearSnapFeatures(){et.getArray().forEach(t=>t.setStyle(null)),et.clear()},addSnapFeatures(t=[]){t.filter(e=>!this.uids.includes(e._uid)).forEach(e=>{ht({feature:e,vertexColor:"black",fillVertex:!0,lineColor:"black"}),et.push(e)})},setShowSnapAll(t){this.snapAll=!!this.snapToolboxes.find(e=>e.on),t.options.checkedAll=t.options.showSnapAll?t.options.checkedAll:!1},clearSnap(){let t=Kt.getService("map");this.clearSnapFeatures(),Qe&&(t.removeInteraction(Qe),Qe=null)},handleSnapInteractionFeatures({tool:t,active:e,all:s}={}){let i=Kt.getService("map");e?(this.clearSnap(),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayers().filter(a=>a.isInEditing()&&Ys.LayerTypes.VECTOR===a.getType()).filter(a=>s||t.options.layerId===a.getId()).forEach(a=>{let n=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById(a.getId()).getLayer().getEditingSource();this.addSnapFeatures(n.readFeatures()),this.snapEvents.push({source:n,olKey:n.getFeaturesCollection().on("add",r=>this.addSnapFeatures([r.element])),settersAndKeys:{addFeature:n.onbefore("addFeature",this.addSnapFeatures),clear:n.onbefore("clear",()=>n.readFeatures().forEach(r=>et.remove(r)))}})}),Qe=new ol.interaction.Snap({features:et}),i.addInteraction(Qe)):this.clearSnap()}},watch:{async"state.activetool"(t){await this.$nextTick(),this.helpmessage=t&&(t.messages.help||t.name)},"state.editing.on"(t){this.$emit("on-editing",t)},"state.toolsoftool"(t=[],e=[]){if(t.length!==e.length&&(t.length===0&&e.find(s=>s.type==="snap")&&(this.clearSnap(),this._unloadSnap()),e.length===0)){let s=t.find(i=>i.type==="snap");s&&this._initSnap(s)}}},created(){this.$emit("canEdit",{id:this.state.id})},async mounted(){await this.$nextTick()}},Er=function(){var t,e=this,s=e.$createElement,i=e._self._c||s;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.state.show,expression:"state.show"}],staticClass:"toolbox",attrs:{id:"id_toolbox_"+e.state.id}},[i("div",{staticClass:"panel",class:{mobile:e.isMobile(),toolboxselected:e.state.selected,toolboxactive:e.state.editing.on&&e.canEdit,geolayer:e.state.layer.isGeoLayer()},on:{click:function(a){return a.stopPropagation(),e.select.apply(null,arguments)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLayerReady,expression:"!isLayerReady"}],staticClass:"bar-loader"}),e._v(" "),e.state.toolboxheader?i("div",{staticClass:"panel-heading container",staticStyle:{display:"flex","align-items":"center",gap:"10px"},style:{background:e.state.color}},[e.father?i("i",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.tooltip.filter_by_relation",expression:"'plugins.editing.tooltip.filter_by_relation'",arg:"right",modifiers:{create:!0}}],class:"filter-by-relation "+e.g3wtemplate.font.relation,on:{click:e.toggleFilterByRelation}}):e._e(),e._v(" "),i("span",{staticClass:"panel-title"},[e._v(e._s(e.state.title))]),e._v(" "),i("span",{staticStyle:{"margin-left":"auto"},attrs:{"data-i18n-title":e.editDisabled?"plugins.editing.disabled_editing.message":"plugins.editing.tooltip.edit_layer"}},[i("i",{directives:[{name:"disabled",rawName:"v-disabled",value:e.editDisabled,expression:"editDisabled"}],staticClass:"start-editing editbtn skin-tooltip-left",class:(t={"pull-right":!e.isMobile(),enabled:e.isLayerReady,"g3w-icon-toggled":e.state.editing.on},t[e.g3wtemplate.font[e.state.editing.on||e.toggled.layer?"checkmark":"pencil"]]=!0,t),on:{click:function(a){return a.stopPropagation(),e.toggleEditing.apply(null,arguments)}}})])]):e._e(),e._v(" "),i("bar-loader",{attrs:{loading:e.loading}}),e._v(" "),!e.state.changingtools&&(e.state.editing.on||e.toggled.layer)?i("div",{class:{"panel-body":!0,disabled:!e.isLayerReady||!e.canEdit},style:{cursor:e.toolboxCursor,padding:"15px"},on:{click:e.fitZoomToScale}},[e.state.layer.isGeoLayer()?e._e():i("div",{staticClass:"info"},[i("i",{class:e.g3wtemplate.font.info}),e._v(" "),i("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.toolbox_has_no_geometry",expression:"'editing.messages.toolbox_has_no_geometry'"}]}),e._v(" "),i("divider")],1),e._v(" "),e.hasRelations?i("div",{staticClass:"info"},[i("i",{class:e.g3wtemplate.font.info}),e._v(" "),i("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.toolbox_has_relation",expression:"'editing.messages.toolbox_has_relation'"}]}),e._v(" "),i("divider")],1):e._e(),e._v(" "),e.state.message?i("div",{staticStyle:{color:"#000"}},[i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:e.state.message,expression:"state.message"}],staticClass:"text-justify"}),e._v(" "),i("divider")],1):e._e(),e._v(" "),i("div",{staticClass:"tools-content"},e._l(e.state.tools,function(a){var n;return a.visible?i("div",{key:a.id,class:(n={enabled:a.enabled,toggled:a.active},n["editbtn "+a.id]=!0,n),on:{click:function(r){r.preventDefault(),r.stopPropagation(),a.enabled&&e.toggleTool(a.active?void 0:a.id)}}},[i("img",{attrs:{height:"25",width:"25",src:e.resourcesurl+"images/"+a.icon,title:e.get_tool_title(""+a.name)}})]):e._e()}),0),e._v(" "),i("div",{staticClass:"message",attrs:{id:"id_toolbox_messages_"+e.state.id}},[i("transition",{attrs:{name:"fade"}},[e.showtoolsoftool?i("div",{attrs:{id:"toolsoftoolcontainer"}},[e._l(e.state.toolsoftool,function(a){return[a.type==="measure"?i("div",{staticClass:"snap-tool"},[i("input",{directives:[{name:"model",rawName:"v-model",value:a.options.checked,expression:"tool.options.checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{id:"g3w_editing_show_measure_tool",type:"checkbox"},domProps:{checked:Array.isArray(a.options.checked)?e._i(a.options.checked,null)>-1:a.options.checked},on:{change:[function(n){var r=a.options.checked,l=n.target,g=!!l.checked;if(Array.isArray(r)){var c=null,o=e._i(r,c);l.checked?o<0&&e.$set(a.options,"checked",r.concat([c])):o>-1&&e.$set(a.options,"checked",r.slice(0,o).concat(r.slice(o+1)))}else e.$set(a.options,"checked",g)},function(){return a.options.onChange(a.options.checked)}]}}),e._v(" "),i("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.measure",expression:"'plugins.editing.toolsoftool.measure'",arg:"right",modifiers:{create:!0}}],attrs:{for:"g3w_editing_show_measure_tool"}},[i("b",{class:e.g3wtemplate.font.measure})])]):a.type==="snap"?i("div",{staticClass:"tools-of-tool-snap"},[i("div",{staticClass:"item"},[i("input",{directives:[{name:"model",rawName:"v-model",value:a.options.checked,expression:"tool.options.checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:"snap_"+e.state.id},domProps:{checked:Array.isArray(a.options.checked)?e._i(a.options.checked,null)>-1:a.options.checked},on:{change:function(n){var r=a.options.checked,l=n.target,g=!!l.checked;if(Array.isArray(r)){var c=null,o=e._i(r,c);l.checked?o<0&&e.$set(a.options,"checked",r.concat([c])):o>-1&&e.$set(a.options,"checked",r.slice(0,o).concat(r.slice(o+1)))}else e.$set(a.options,"checked",g)}}}),e._v(" "),i("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.snap",expression:" 'plugins.editing.toolsoftool.snap'",arg:"right",modifiers:{create:!0}}],attrs:{for:"snap_"+e.state.id}},[i("span",{class:e.g3wtemplate.font.magnete})])]),e._v(" "),i("div",{staticClass:"item"},[e.snapAll?i("input",{directives:[{name:"model",rawName:"v-model",value:a.options.checkedAll,expression:"tool.options.checkedAll"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:"snap_all_"+e.state.id+"_all"},domProps:{checked:Array.isArray(a.options.checkedAll)?e._i(a.options.checkedAll,null)>-1:a.options.checkedAll},on:{change:function(n){var r=a.options.checkedAll,l=n.target,g=!!l.checked;if(Array.isArray(r)){var c=null,o=e._i(r,c);l.checked?o<0&&e.$set(a.options,"checkedAll",r.concat([c])):o>-1&&e.$set(a.options,"checkedAll",r.slice(0,o).concat(r.slice(o+1)))}else e.$set(a.options,"checkedAll",g)}}}):e._e(),e._v(" "),e.snapAll?i("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"plugins.editing.toolsoftool.snapall",expression:"'plugins.editing.toolsoftool.snapall'",arg:"left",modifiers:{create:!0}}],attrs:{for:"snap_all_"+e.state.id+"_all"}},[i("span",{class:e.g3wtemplate.font.magnete}),e._v(" "),i("b",{class:e.g3wtemplate.font.layers,staticStyle:{"margin-left":"3px"}})]):e._e()])]):e._e(),e._v(" "),i("divider")]})],2):e._e()]),e._v(" "),e.helpmessage?i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:e.helpmessage,expression:"helpmessage"}],staticClass:"toolbox_help_message"}):e._e()],1)]):e._e()],1)])},Fr=[],Cr=function(t){t&&t("data-v-90e2c2bc_0",{source:".panel.mobile[data-v-90e2c2bc]{margin-bottom:5px}.panel.mobile .panel-heading[data-v-90e2c2bc]{display:flex;justify-content:space-between}.panel.mobile .panel-heading .panel-title[data-v-90e2c2bc]{margin-top:auto;margin-bottom:auto}.panel.mobile .panel-heading .start-editing[data-v-90e2c2bc]{margin:auto;margin-right:0;padding:6px}.panel.mobile .tools-content .editbtn[data-v-90e2c2bc]{padding:9px}.panel.mobile .toolbox .panel-body[data-v-90e2c2bc]{padding:5px!important}.toolbox_help_message[data-v-90e2c2bc]{font-weight:lighter}.toolbox[data-v-90e2c2bc]{padding-bottom:5px}.panel[data-v-90e2c2bc]{border:0!important;margin-bottom:8px}.panel-heading[data-v-90e2c2bc]{border-bottom:1px solid transparent;border-top-left-radius:3px;border-top-right-radius:3px;padding:5px 10px 5px 10px;width:100%}.toolboxselected[data-v-90e2c2bc]{box-shadow:0 0 0 3px var(--skin-color)}.panel:not(.toolboxselected) .info[data-v-90e2c2bc]{opacity:.4}.panel:not(.toolboxactive) .panel-heading[data-v-90e2c2bc]{border-radius:3px;filter:grayscale(.8)}.panel:not(.geolayer) .panel-body[data-v-90e2c2bc]{padding-top:0}.panel.toolboxactive:not(.geolayer) .editbtn.start-editing[data-v-90e2c2bc]{color:#fff!important}.panel:not(.geolayer) .panel-heading[data-v-90e2c2bc]{color:#3a4448}.editbtn.start-editing[data-v-90e2c2bc]{padding:10px;color:currentColor!important;font-size:1.1em;margin:0}.panel-title[data-v-90e2c2bc]{font-weight:700;word-break:break-word;padding:8px 0;display:inline-block}#toolsoftoolcontainer[data-v-90e2c2bc]{display:flex;flex-direction:column;margin:5px;padding:5px;border-radius:5px}.info[data-v-90e2c2bc]{color:#000}.info>i[data-v-90e2c2bc]{color:#007bff;padding-right:2px}.info+.tools-content[data-v-90e2c2bc]{margin-top:1em}.filter-by-relation[data-v-90e2c2bc]{margin-right:5px;cursor:pointer;color:currentColor!important}.tools-content[data-v-90e2c2bc]{display:flex;flex-wrap:wrap;gap:10px}.message[data-v-90e2c2bc]{margin-top:5px;margin-bottom:5px;font-size:1.1em;color:#000}.snap-tool[data-v-90e2c2bc]{display:flex}.snap-tool label>b[data-v-90e2c2bc]{color:#222d32!important}.tools-of-tool-snap[data-v-90e2c2bc]{display:flex;width:100%;justify-content:space-between}.tools-of-tool-snap .item[data-v-90e2c2bc]{display:flex;align-items:center}.tools-of-tool-snap .item label span[data-v-90e2c2bc]{color:#222d32!important}.panel-body[data-v-90e2c2bc]{padding:15px}.panel-body.disabled[data-v-90e2c2bc]{opacity:.7}.panel-body.disabled>*[data-v-90e2c2bc]{pointer-events:none}#toolsoftoolcontainer label[data-v-90e2c2bc]{margin-top:10px;margin-left:5px}",map:void 0,media:void 0})},Ir="data-v-90e2c2bc",Tr=void 0,Lr=!1;Pr=Rr({render:Er,staticRenderFns:Fr},Cr,xr,Ir,Lr,Tr,!1,Wt,void 0,void 0),Qs=Pr});var si={};xe(si,{default:()=>zr});function Vr(t,e,s,i,a,n,r,l,g,c){let o=(typeof s=="function"?s.options:s)||{};o.__file="Editing.vue",o.render||(o.render=t.render,o.staticRenderFns=t.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let h;if(e&&(h=r?function(u){e.call(this,c(u,this.$root.$options.shadowRoot))}:function(u){e.call(this,l(u))}),h!==void 0)if(o.functional){let u=o.render;o.render=function(p,_){return h.call(_),u(p,_)}}else{let u=o.beforeCreate;o.beforeCreate=u?[].concat(u,h):[h]}}return o}function Zt(){let t=Zt.styles||(Zt.styles={}),e=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let n=e?a.media||"default":i,r=t[n]||(t[n]={ids:[],parts:[],element:void 0});if(!r.ids.includes(i)){let l=a.source,g=r.ids.length;if(r.ids.push(i),a.map&&(l+=`
/*# sourceURL=`+a.map.sources[0]+" */",l+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),e&&(r.element=r.element||document.querySelector("style[data-group="+n+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],o=r.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),e&&(o.setAttribute("data-group",n),o.setAttribute("data-next-index","0")),c.appendChild(o)}if(e&&(g=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",g+1)),r.element.styleSheet)r.parts.push(l),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(l),o=r.element.childNodes;o[g]&&r.element.removeChild(o[g]),o.length?r.element.insertBefore(c,o[g]):r.element.appendChild(c)}}}}var ne,tt,ti,Xt,Ar,Mr,Br,Or,Dr,jr,Ur,Nr,$r,zr,ii=C(()=>{ei();G();({GUI:ne}=g3wsdk.gui),{ApplicationState:tt,ApplicationService:ti}=g3wsdk.core,{CatalogLayersStoresRegistry:Xt}=g3wsdk.core.catalog,{DataRouterService:Ar}=g3wsdk.core.data,Mr={name:"Editing",data(){return{state:this.$options.service.state,service:this.$options.service,resourcesurl:this.$options.resourcesurl,showcommitbar:this.$options.showcommitbar,saving:!1,layersInEditing:0,editingButtonsEnabled:!0,selectedlayers:[],editinglayers:Object.entries(g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getEditableLayers()).filter(([t,e])=>e.config.editing.visible).map(([t,e])=>({id:t,name:e.getName(),title:e.getTitle()})),activetool:null}},components:{toolbox:Qs},transitions:{addremovetransition:"showhide"},methods:{updateFilterLayers(t=[]){t.length>0?(this._selectedlayers=this.selectedlayers,this.selectedlayers=t):(this.selectedlayers=this._selectedlayers,this._selectedlayers=t),$(this.$refs.selectlayers).val(this.selectedlayers).trigger("change")},updateLayersInEditing(t){this.layersInEditing+=t?1:-1},undo(){this.canUndo&&this.service.undo()},redo(){this.canRedo&&this.service.redo()},commit(t){this.canCommit&&(this.saving=!0,this.service.commit({toolbox:this.service.getToolBoxById(t),modal:!1}).always(()=>this.saving=!1))},async startToolBox(t){let e=this.service.getToolBoxById(t),s=tt.online&&e.getDependencies().find(i=>this.service.getToolBoxById(i).isDirty());s&&await this.commit_dirty(s),e.start()},async stopToolBox(t){let e=this.service.getToolBoxById(t);try{e.state.editing.history.commit&&await w(this.service.commit())}catch(i){console.warn(i)}try{await e.stop()}catch(i){console.warn(i)}let s=this.service.getToolBoxes().find(i=>i.state.editing.on)===void 0&&ne.getService("map").getMapControlByType({type:"query"});s&&!s.isToggled()&&s.toggle()},async startTool(t,e){let s=this.service.getToolBoxById(e),i=this.activetool&&e===this.activetool;!i&&this.service.getToolBoxById(s.getDependencies().find(a=>a===this.activetool))&&await this.commit_dirty(this.activetool),i||this.stopTool(this.activetool),this.activetool=e,s.setActiveTool(s.getToolById(t))},stopTool(t){t&&(this.service.getToolBoxById(t).stopActiveTool(),this.activetool=null)},async selectToolBox(t){let e=this.service.getToolBoxById(t),i=this.service.getToolBoxes().find(a=>a.isSelected());i&&(i.setSelected(!1),i.clearMessage()),e.setSelected(!0),this.state.toolboxselected=e},async commit_dirty(t){let e=this.service.getToolBoxById(t);try{e.isDirty()&&e.hasDependencies()&&(await w(this.service.commit({toolbox:e})),console.info("[EDITING] committed dirty"))}catch{try{[layerId].concat(e.getDependencies()).forEach(i=>{let a=this.service.getToolBoxById(i),n=a.getEditor();n.getEditingSource().setFeatures((n.readFeatures()||[]).map(r=>r.clone())),a.getSession().getHistory().clear(),a.stopActiveTool()}),console.info("[EDITING] reverted dirty")}catch(i){console.warn(i)}}},_enableEditingButtons(t){this.editingButtonsEnabled=!t},checkOfflineChanges({modal:t=!0,unlock:e=!1}={}){return new Promise((s,i)=>{let a=JSON.parse(window.localStorage.getItem("EDITING_CHANGES")||null);if(!a)return;let n=[],r=[];setTimeout(async()=>{for(let l in a){r.push(l);let g=this.service.getToolBoxById(l),c=a[l];n.push(this.service.commit({toolbox:g,commitItems:c,modal:t}))}try{await w($.when.apply(this.service,n)),s()}catch(l){console.warn(l),i(l)}finally{e&&r.forEach(l=>this.service.getLayerById(l).unlock());try{window.localStorage.setItem("EDITING_CHANGES","{}")}catch(l){console.warn(l)}}},1e3)})}},computed:{canCommit(){return this.state.saveConfig.mode==="default"&&this.state.toolboxselected&&!this.state.toolboxselected.state.activetool&&this.state.toolboxselected.state.editing.history.commit&&this.editingButtonsEnabled},canUndo(){let t=this.state.toolboxselected&&!this.state.toolboxselected.state.activetool&&this.state.toolboxselected.state.editing.history.undo&&this.editingButtonsEnabled;return this.service.fireEvent("canUndo",t),t},canRedo(){let t=this.state.toolboxselected&&!this.state.toolboxselected.state.activetool&&this.state.toolboxselected.state.editing.history.redo&&this.editingButtonsEnabled;return this.service.fireEvent("canRedo",t),t},django_admin_url(){return window.initConfig.user.is_superuser?new URL("/django-admin/editing/g3weditingfeaturelock/",window.initConfig.baseurl):!1},filemanager_url(){return window.initConfig.user.is_superuser?new URL("/filemanager/",window.initConfig.baseurl):!1}},watch:{canCommit(t){window.onbeforeunload=()=>t||void 0},layersInEditing(t){tt.sidebar.btn_close=!t,tt.sidebar.tooltip_close=t?"plugins.editing.close_editing_panel.message":""},selectedlayers(t=[]){let e=t.length>0,s=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing");this.editinglayers.forEach(({id:i})=>{let a=s.getToolBoxById(i),n=e&&a.state.editing.history.commit,r=t.includes(i);a.setShow(e?r:!0),e&&!r&&n&&s.commit({toolbox:a}).always(()=>a.stop()),e&&!r&&!n&&a.stop()})}},created(){this._selectedlayers=[],this.appState=tt,this.unByKeys=this.unByKeys||[],tt.online&&this.checkOfflineChanges({unlock:!0}),this.unByKeys.push({owner:ti,setter:"online",key:ti.onafter("online",()=>this.checkOfflineChanges({modal:!1}).catch(t=>ne.notify.error(t)))}),ne.closeContent(),this.state.open=!1,Xt.getLayers({EDITABLE:!0}).forEach(t=>t.setInEditing(!0)),ne.on("opencontent",this._enableEditingButtons),ne.on("closeform",this._enableEditingButtons),ne.on("closecontent",this._enableEditingButtons)},async mounted(){await this.$nextTick(),this.service.fireEvent("openeditingpanel")},async beforeDestroy(){this.service.stop(),this.state.open=!1,Xt.getLayers({EDITABLE:!0}).forEach(s=>s.setInEditing(!1)),ne.off("opencontent",this._enableEditingButtons),ne.off("closeform",this._enableEditingButtons),ne.off("closecontent",this._enableEditingButtons),this.unByKeys.forEach(({owner:s,setter:i,key:a})=>s.un(i,a)),this.service.fireEvent("closeeditingpanel");let t=Object.keys(this.state.featuresOnClose);if(t.length){let s={layers:[],fids:[],formatter:1};t.forEach(a=>{let n=[...this.state.featuresOnClose[a]];if(n.length>0){let r=Xt.getLayerById(a);s.layers.push(r),s.fids.push(n)}});let i=s.layers.length?Ar.getData("search:layersfids",{inputs:s,outputs:{title:"plugins.editing.editing_changes",show:{loading:!1}}}):Promise.resolve();try{await i}catch(a){console.warn(a)}}this.state.featuresOnClose={},this.service.getToolBoxes().forEach(s=>s.resetDefault());let e=ne.getService("map").getMapControlByType({type:"query"});e&&!e.isToggled()&&e.toggle()}},Br=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"g3w-editing-panel"},[s("bar-loader",{attrs:{loading:t.saving}}),t._v(" "),t.appState.online?t._e():s("div",{attrs:{id:"onlineofflinemessage"}},[s("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.offline",expression:"'editing.messages.offline'"}]})]),t._v(" "),t.showcommitbar?s("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.saving,expression:"saving"}],staticClass:"commitbar"},[s("div",{class:["editing-button",t.canCommit?"enabled":""],on:{click:function(i){return i.stopPropagation(),t.commit.apply(null,arguments)}}},[s("span",{class:["editing-icon",t.g3wtemplate.font.save]})]),t._v(" "),s("div",{class:["editing-button",t.canUndo?"enabled":""],on:{click:function(i){return i.stopPropagation(),t.undo.apply(null,arguments)}}},[s("span",{class:["editing-icon",t.g3wtemplate.font["arrow-left"]]})]),t._v(" "),s("div",{class:["editing-button",t.canRedo?"enabled":""],on:{click:function(i){return i.stopPropagation(),t.redo.apply(null,arguments)}}},[s("span",{class:["editing-icon",t.g3wtemplate.font["arrow-right"]]})])]):s("div",{staticStyle:{height:"10px"}}),t._v(" "),t.state.showselectlayers&&t.editinglayers.length>1?s("div",{staticClass:"skin-color",attrs:{id:"g3w-select-editable-layers-content"}},[s("label",{directives:[{name:"t",rawName:"v-t",value:"Layers",expression:"'Layers'"}],attrs:{for:"g3w-select-editable-layers-to-show"}}),t._v(" "),s("select",{directives:[{name:"select2",rawName:"v-select2",value:"selectedlayers",expression:"'selectedlayers'"}],ref:"selectlayers",attrs:{id:"g3w-select-editable-layers-to-show",multiple:!0,clear:!0}},t._l(t.editinglayers,function(i){return s("option",{key:i.id,domProps:{value:i.id}},[t._v(t._s(i.name))])}),0)]):t._e(),t._v(" "),s("div",{attrs:{id:"toolboxes"}},t._l(t.state.toolboxes,function(i){return s("toolbox",{key:i.id,attrs:{state:i,resourcesurl:t.resourcesurl},on:{setselectedtoolbox:t.selectToolBox,starttoolbox:t.startToolBox,stoptoolbox:t.stopToolBox,setactivetool:t.startTool,stopactivetool:t.stopTool,"on-editing":t.updateLayersInEditing,"update-filter-layers":t.updateFilterLayers}})}),1),t._v(" "),t.django_admin_url?s("p",[s("a",{attrs:{href:t.django_admin_url,target:"_blank"}},[t._v("\u{1F512} Locked features")])]):t._e(),t._v(" "),t.filemanager_url?s("p",[s("a",{attrs:{href:t.filemanager_url,target:"_blank"}},[t._v("\u{1F4C2} File manager")])]):t._e()],1)},Or=[],Dr=function(t){t&&(t("data-v-73ef0b71_0",{source:".g3w-editing-panel .editing-button .editing-icon{background-color:#3a4448;color:#222d32;font-size:1.8em;padding:10px;margin:5px;width:45px;height:45px;border-radius:30%;text-align:center}.g3w-editing-panel .editing-button.enabled .editing-icon{background-color:#fff;box-shadow:0 0 5px rgba(0,0,0,.7)}.g3w-editing-panel .editing-button{cursor:not-allowed}.g3w-editing-panel .editing-button.enabled{cursor:pointer}.g3w-editing-panel .editbtn{border-radius:30%;padding:10px;display:inline-block;opacity:.4;box-shadow:0 1px 1px 0 rgba(0,0,0,.1),0 1px 4px 0 rgba(0,0,0,.3)}.g3w-editing-panel .editbtn.enabled{opacity:1;cursor:pointer}.g3w-editing-panel .editbtn.enabled.toggled{box-shadow:0 0;background-color:#ddd}",map:void 0,media:void 0}),t("data-v-73ef0b71_1",{source:".g3w-editing-panel[data-v-73ef0b71]{margin-bottom:50px}#onlineofflinemessage[data-v-73ef0b71]{margin-bottom:5px;padding:5px;border-radius:3px;background-color:orange;color:#fff;font-weight:700}.commitbar[data-v-73ef0b71]{display:flex;justify-content:flex-end;margin-bottom:5px}.commitbar>div[data-v-73ef0b71]:first-of-type{margin-right:auto}#g3w-select-editable-layers-content[data-v-73ef0b71]{margin-bottom:10px;font-weight:700}#g3w-select-editable-layers-content label[data-v-73ef0b71]{color:#fff!important}#g3w-select-editable-layers-to-show[data-v-73ef0b71]{cursor:pointer}",map:void 0,media:void 0}))},jr="data-v-73ef0b71",Ur=void 0,Nr=!1;$r=Vr({render:Br,staticRenderFns:Or},Dr,Mr,jr,Nr,Ur,!1,Zt,void 0,void 0),zr=$r});ee();he();xt();Et();it();De();je();Ue();G();function _e(t){return v(async()=>{try{if(t.features.length!==1){let e=await oe({features:t.features,inputs:t});t.features=[e]}return t}catch(e){return console.warn(e),Promise.reject(e)}})}Ne();$e();function rt({layer:t,feature:e}){return t.getEditingNotEditableFields().reduce((s,i)=>(s[i]=t.isPkField(i)?null:e.get(i),s),{})}function It({x:t,y:e,coordinates:s}={}){let i=ns(s);return{x:t-i.x,y:e-i.y}}function ns(t){return Array.isArray(t[0])?ns(t[0]):{x:t[0],y:t[1]}}Ue();Tt();ot();Le();Ge();Re();Lt();function cs({feature:t,coordinates:e}){let s=t.getGeometry(),i=s.getType(),a=n=>g3wsdk.core.geoutils.areCoordinatesEqual(e,n);switch(i){case"Polygon":case"MultiLineString":return s.getCoordinates().flat().some(a);case"LineString":case"MultiPoint":return s.getCoordinates().some(a);case"MultiPolygon":return s.getPolygons().some(n=>n.getCoordinates().flat().some(a));case"Point":return g3wsdk.core.geoutils.areCoordinatesEqual(e,s.getCoordinates());default:return!1}}Ne();$e();var{Feature:Ki}=g3wsdk.core.layer.features;async function us({feature:t,inputs:e,context:s,splittedGeometries:i=[]}={}){let a=[],{layer:n}=e,r=s.session,l=n.getEditingLayer().getSource(),g=n.getId(),c=t.clone();e.features=i.length?[]:e.features;let o=i.length;for(let h=0;h<o;h++){let u=i[h];if(h===0){t.setGeometry(u);try{await Z({inputs:e,context:s,feature:t})}catch(f){console.warn(f)}r.pushUpdate(g,t,c)}else{let f=me(c,n);f.setGeometry(u),t=new Ki({feature:f}),t.setTemporaryId();try{await Z({inputs:e,context:s,feature:t})}catch(_){console.warn(_)}let p=rt({layer:n,feature:t});if(Object.entries(p).length){let _=r.pushAdd(g,t);Object.entries(p).forEach(([m,b])=>_.set(m,b)),a.push(_),l.addFeature(_)}else a.push(r.pushAdd(g,t)),l.addFeature(t)}e.features.push(t)}return a}$e();G();function dt(t,e){return v(async()=>{let s,i;if(t.features.length>1){s=t.features[0];let a=s.getGeometry();i=s.clone(),a.setCoordinates([...a.getCoordinates(),...t.features[1].getGeometry().getCoordinates()])}else s=t.layer.getEditingLayer().getSource().getFeatures()[0],i=s.clone(),s.setGeometry(t.features[0].getGeometry());try{await Z({inputs:t,context:e,feature:s})}catch(a){console.warn(a)}return e.session.pushUpdate(t.layer.getId(),s,i),t.features=[s],t})}function Rt(t,e,s){let i={own:[],dependencies:{}};return e.forEach(a=>{Array.isArray(a)&&(a=a[s]),t===a.layerId?i.own.push(a):(i.dependencies[a.layerId]=i.dependencies[a.layerId]||{own:[],dependencies:{}},i.dependencies[a.layerId].own.push(a))}),i}G();At();var{splitFeature:Zi}=g3wsdk.core.geoutils;function gs(t,e){return(t||[]).reduce((s,i)=>{let a=Zi({splitfeature:e,feature:i});return a.length>1&&s.push({uid:i.getUid(),geometries:a}),s},[])}ze();ut();We();Object.entries({Workflow:y,OpenFormStep:M,SelectElementsStep:ue,PickFeatureStep:se,MoveFeatureStep:we,RotateFeatureStep:Ze,ModifyGeometryVertexStep:ve,OpenTableStep:ke,AddFeatureStep:Q}).forEach(([t,e])=>console.assert(e!==void 0,`${t} is undefined`));var{GEOMETRY_TYPES:_t}=g3wsdk.constant,{ApplicationState:ie,G3WObject:zt}=g3wsdk.core,{ProjectsRegistry:er}=g3wsdk.core.project,{DataRouterService:tr}=g3wsdk.core.data,{CatalogLayersStoresRegistry:Je}=g3wsdk.core.catalog,{Geometry:Ae,dissolve:sr}=g3wsdk.core.geoutils,{removeZValueToOLFeatureGeometry:ir}=g3wsdk.core.geoutils.Geometry,{tPlugin:Me}=g3wsdk.core.i18n,{Layer:Se}=g3wsdk.core.layer,{Feature:ar}=g3wsdk.core.layer.features,{debounce:rr,toRawType:nr}=g3wsdk.core.utils,{GUI:I}=g3wsdk.gui,{getScaleFromResolution:or,getResolutionFromScale:lr}=g3wsdk.ol.utils,Y=class t extends zt{constructor(e,s=[]){super();let i=[void 0,Se.LayerTypes.VECTOR].includes(e.getType()),a=i&&e.getGeometryType(),n=i&&Ae.isPointGeometryType(a),r=i&&Ae.isLineGeometryType(a),l=i&&Ae.isPolygonGeometryType(a),g=Se.LayerTypes.TABLE===e.getType(),c=a&&Ae.isMultiGeometry(a),o=i&&(n?"Point":r?"Line":"Polygon"),h=e.getRelations().getArray().filter(f=>{let p=Je.getLayerById(te({layerId:e.getId(),relation:f}));return p&&p.isEditable()});this._start=!1,this._current_style=null,this.constraints={filter:null,show:null,tools:[]},this._constrains={commit:!1,undo:!1,redo:!1},this._states=[],this._history={id:e.getId(),state:new Proxy({},{get:(f,p)=>this._constrains[p]}),add:this.__add.bind(this),undo:this.__undo.bind(this),clear:this.__clearHistory.bind(this),redo:this.__redo.bind(this),getState:this.__getState.bind(this),getLastState:this.__getLastHistoryState.bind(this),commit:this.__commit.bind(this)},this._session=Object.assign(new zt({setters:{start:(f={})=>v(this.__startSession(f)),stop:()=>v(this.__stopSession()),getFeatures:(f={})=>v(this.__getFeatures(f)),saveChangesOnServer:f=>this.__saveChangesOnServer(f)}}),{_history:this._history,state:new Proxy({},{get:(f,p)=>this.state.editing.session[p]}),getId:()=>e.getId(),getLastHistoryState:this.__getLastHistoryState.bind(this),isStarted:this.__isStarted.bind(this),getHistory:this.__getHistory.bind(this),getEditor:this.__getEditor.bind(this),push:this.__push.bind(this),pushDelete:this.__pushDelete.bind(this),save:this.__save.bind(this),pushAdd:this.__pushAdd.bind(this),pushUpdate:this.__pushUpdate.bind(this),rollback:this.__rollback.bind(this),rollbackDependecies:this.__rollbackDependecies.bind(this),undo:this.__undoSession.bind(this),redo:this.__redoSession.bind(this),getCommitItems:this.__getCommitItems.bind(this),commit:this.save.bind(this),clear:this.__clearSession.bind(this),clearHistory:this.__clearHistory.bind(this)}),t._sessions[e.getId()]=this;let u=e.getEditingCapabilities()||[];this.state={layer:e,id:e.getId(),changingtools:!1,show:e.config.editing.visible,color:e.getColor()||"blue",title:` ${e.getTitle()}`||"Edit Layer",customTitle:!1,loading:!1,enabled:!1,toolboxheader:!0,startstopediting:!0,message:null,toolmessages:{help:null},toolsoftool:[],selected:!1,activetool:null,editing:{session:{id:new Proxy({},{get:()=>this.state.id}),started:!1,getfeatures:!1,current:null,changes:[]},history:this._history.state,on:!1,dependencies:s,relations:Object.values(e.isFather()&&s.length?e.getRelations().getRelations():{}),father:e.isFather(),canEdit:!0},_unregisterStartSettersEventsKey:[],_getFeaturesOption:{},_layerType:e.getType()||Se.LayerTypes.VECTOR,_enabledtools:void 0,_disabledtools:void 0,_constraints:e.getEditingConstrains()||{},_tools:[i&&u.includes("add_feature")&&{id:"addfeature",type:["add_feature"],name:"editing.tools.add_feature",icon:`mActionCapture${o}.svg`,op:new y({layer:e,type:"addfeature",steps:[new Q({layer:e,tools:["snap","measure"]}),new M({layer:e})]})},i&&u.includes("change_attr_feature")&&{id:"editattributes",type:["change_attr_feature"],name:"editing.tools.update_feature",icon:"mActionEditTable.svg",op:new y({layer:e,helpMessage:"editing.tools.update_feature",type:"editfeatureattributes",steps:[new se,new E({run:_e}),new M]})},i&&u.includes("delete_feature")&&{id:"deletefeature",type:["delete_feature"],name:"editing.tools.delete_feature",icon:`delete${o}.png`,op:new y({layer:e,type:"deletefeature",steps:[new se,new E({run:_e}),new E({run(f,p){return v(async()=>{let _=f.layer.getEditingLayer(),m=f.features[0],b=f.layer.getId(),k=new Promise((x,S)=>{I.dialog.confirm(`<h4>${Me("editing.messages.delete_feature")}</h4><div style="font-size:1.2em;">`+(f.layer.getChildren().length&&fe({layerId:b,relations:f.layer.getRelations().getArray()}).length?Me("editing.messages.delete_feature_relations"):"")+"</div>",async R=>{if(!R){S(f);return}let U=fe({layerId:b,relations:f.layer.getRelations()?f.layer.getRelations().getArray():[]}).filter(O=>J(te({layerId:b,relation:O})).getEditingFields().filter(N=>q({relation:O,layerId:te({layerId:b,relation:O})}).ownField.includes(N.name)).every(N=>!N.validate.required));U.length>0&&await le(b,{feature:m,relations:U}),lt({layerId:b,relations:U,feature:m}).forEach(({relation:O,relations:N})=>{N.forEach(()=>ct({layerId:b,relation:O,relations:N,index:0,dialog:!1}))}),_.getSource().removeFeature(m),p.session.pushDelete(b,m);let F=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[b];F&&Object.keys(m.getProperties()).filter(O=>F[O]!==void 0).forEach(O=>F[O].delete(m.get(O))),x(f)})});return f.features&&H({promise:v(async()=>{try{return await k}catch(x){return console.warn(x),Promise.reject(x)}}),inputs:f,style:this.selectStyle}),k})}})]})},(r||l)&&u.includes("change_feature")&&{id:"movevertex",type:["change_feature"],name:"editing.tools.update_vertex",icon:"mActionVertexTool.svg",op:new y({layer:e,type:"modifygeometryvertex",helpMessage:"editing.tools.update_vertex",steps:[new se({layer:e}),new E({run:_e}),new ve({tools:["snap","measure"]})]})},i&&u.includes("change_attr_feature")&&{id:"editmultiattributes",type:["change_attr_feature"],name:"editing.tools.update_multi_features",icon:"mActionMultiEdit.svg",op:new y({layer:e,type:"editmultiattributes",helpMessage:"editing.tools.update_multi_features",registerEscKeyEvent:!0,runOnce:!0,steps:[new ue({type:"multiple",steps:{select:{description:`editing.workflow.steps.${ie.ismobile?"selectDrawBoxAtLeast2Feature":"selectMultiPointSHIFTAtLeast2Feature"}`,buttonnext:{disabled:!0,condition:({features:f=[]})=>f.length<2,done:()=>{y.Stack.getCurrent().clearUserMessagesSteps()}},dynamic:0,done:!1,reset(){this.dynamic=0}}}}),new M({multi:!0})]})},i&&u.includes("change_attr_feature")&&h.filter(f=>f.getType()!=="ONE").length>0&&{id:"editmultiattributesrelationfeatures",type:["change_attr_feature"],name:"editing.tools.update_multi_features_relations_from_parents",icon:"relation.svg",op:new y({layer:e,type:"editmultiattributesrelationfeatures",helpMessage:"editing.tools.update_multi_features_relations_from_parents",registerEscKeyEvent:!0,runOnce:!0,steps:[new ue({type:"multiple",steps:{select:{description:`editing.workflow.steps.${ie.ismobile?"selectDrawBox":"selectMultiPointSHIFT"}`,buttonnext:{disabled:!0,condition:({features:f=[]})=>f.length<1,done:()=>{y.Stack.getCurrent().clearUserMessagesSteps()}},dynamic:0,done:!1,reset(){this.dynamic=0}}}}),new E({run:async(f,p)=>{I.setModal(!0);let _=h.filter(T=>T.getType()!=="ONE"),m=(await Promise.allSettled(f.features.map(T=>le(f.layer.getId(),{relations:_,feature:T,filterType:"fid"})))).filter(({status:T})=>T==="fulfilled").reduce((T,{value:L})=>(L.forEach(A=>Object.entries(A).forEach(([P,V])=>{T[P]===void 0&&(T[P]=[]),T[P]=T[P].concat(V)})),T),{}),b=_[0].getChild(),k=_[0].state.id,x,S;if(_.length>1){try{await new Promise((L,A)=>{let P=new(Vue.extend({name:"multi-relations-fetures",template:`<div>
                            <select v-select2 = "'relationId'">
                              <option v-for = "relation in relations" 
                                :key   = "relation.state.id" 
                                :value = "relation.state.id">
                                  {{ relation.state.name }}
                              </option>
                            </select>
                          </div>
                        `,data(){return{relations:this.$options.relations,relationId:this.$options.relationId}}}))({relations:_,relationId:k});I.showModalDialog({title:Me("editing.relations"),className:"modal-left",closeButton:!1,message:P.$mount().$el,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback(){A()}},ok:{label:"Ok",className:"btn-success",callback:async()=>{b=_.find(V=>P.relationId===V.state.id).getChild(),k=P.relationId,L()}}}}).on("hide.bs.modal",()=>P.$destroy())})}catch(L){return console.warn(L),I.setModal(!1),v(Promise.reject(L))}S=J(b);let T=[].concat([void 0,Se.LayerTypes.VECTOR].includes(S.getType())?[]:["add"]).concat(m[b].length>0?["update"]:[]);if(T.length===0)return I.setModal(!1),I.showUserMessage({type:"warning",message:"plugins.editing.no_relations_found",autoclose:!0}),v(Promise.reject());try{await new Promise((L,A)=>{let P=new(Vue.extend({name:"multi-relations-fetures",template:`<div>
                            <select v-select2 = "'action'">
                              <option v-for = "a in actions" 
                                :key   = "a" 
                                :value = "a">
                                  {{ a }}
                              </option>
                            </select>
                          </div>
                        `,data(){return{actions:T,action:T[0]}},watch:{action:V=>x=V}}));I.showModalDialog({title:Me("editing.tools.update_multi_features_relations_from_parents"),className:"modal-left",closeButton:!1,message:P.$mount().$el,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback(){A()}},ok:{label:"Ok",className:"btn-success",callback:async()=>{x=P.action,L()}}}}).on("hide.bs.modal",()=>P.$destroy())})}catch(L){return console.warn(L),I.setModal(!1),v(Promise.reject(L))}}let R=_.find(T=>k===T.getId()),U=q({layerId:R.getChild(),relation:R}),F;if(x==="add"){F=[];for(let T of f.features){let L=(await w(ye({features:[],layer:S},{session:y.Stack.getCurrent().getSession()}))).features[0];U.relationField.forEach((A,P)=>L.set(U.ownField[P],T.get(A))),F.push(L)}}x==="update"&&(F=m[b]);let O=new y({type:"editmultiattributes",steps:[new M({multi:!0})]}),N=y.Stack.getCurrent().getSession();try{await Fe(b),await w(O.start({context:{session:N,excludeFields:U.ownField,isContentChild:!1},inputs:{layer:S,features:F}}))}catch(T){console.warn(T),N.rollback()}return O.stop(),I.setModal(!1),v(Promise.resolve(f,p))}})]})},i&&u.includes("change_feature")&&{id:"movefeature",type:["change_feature"],name:"editing.tools.move_feature",icon:`mActionMoveFeature${o}.svg`,op:new y({layer:e,type:"movefeature",helpMessage:"editing.tools.move_feature",steps:[new se,new E({run:_e}),new we]})},(r||l||n&&e.getEditingFields().find(f=>f.name==="rotation"))&&u.includes("change_feature")&&{id:"rotatefeature",type:["change_feature"],name:"editing.tools.rotate_feature",icon:"mActionRotateFeature.svg",disableEdit:n,op:new y({layer:e,type:"rotatefeature",helpMessage:"editing.tools.rotate_feature",steps:[new se,new E({run:_e}),new Ze]})},(()=>{let f=[];return i&&u.includes("add_feature")&&{id:"copyfeaturesfromotherlayer",type:["add_feature"],name:"editing.tools.pastefeaturesfromotherlayers",icon:"mActionEditPaste.svg",enable:function(){let p=I.getService("catalog"),_=e.getId(),m=e.getGeometryType(),b={bool:!0,tool:void 0};Je.getLayers({GEOLAYER:!0,BASELAYER:!1});let k=()=>{let x=S=>S&&ae(m,S)&&(m===S||Ae.isMultiGeometry(m)||!Ae.isMultiGeometry(S));return f=[...Je.getLayers({GEOLAYER:!0,BASELAYER:!1}).filter(S=>_!==S.getId()&&x(S.getGeometryType())),...p.getExternalLayers({type:"vector"}).filter(S=>x(S.geometryType))].map((S,R)=>({id:(S.state||{id:S.id}).id,name:(S.state||{name:S.name}).name,external:S.external||!1,selected:R===0})),b.tool.enabled=f.length>0};return({bool:x,tool:S={}})=>(b.tool=S,b.bool=x,p.onafter("addExternalLayer",k),p.onafter("removeExternalLayer",k),k())}(),op:(()=>{let p=new M({layer:e,help:"editing.steps.help.copy"});return new y({layer:e,type:"copyfeaturesfromotherlayer",runOnce:!0,steps:[new E({layer:e,steps:{chooselayer:{description:"editing.modal.tools.copyfeaturefromotherlayer.title",done:!1},selectgeometry:{description:"editing.workflow.steps.selectPoint",done:!1}},run(_,m){return v(new Promise((b,k)=>{let x=_.layer,S=x.getGeometryType(),R=x.getId(),U=x.getEditingFields().filter(A=>!A.pk),F=m.session,N=x.getEditingLayer().getSource(),T=new(Vue.extend((Bs(),Ee(Ms)).default))({layers:f}),L=T.$mount().$el;I.showModalDialog({title:Me("editing.relation.copy_feature_from_other_layer"),className:"modal-left",closeButton:!1,message:L,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback(){k()}},ok:{label:"Ok",className:"btn-success",callback:async()=>{this.setUserMessageStepDone("chooselayer");try{let A=await v(async()=>{let P=f.find(z=>z.selected),V=await new Promise(async z=>{this.addInteraction(P.external?new re({layer:I.getService("map").getLayerById(P.id)}):new g3wsdk.ol.interactions.PickCoordinatesInteraction,{picked:async W=>{try{z(nt(P.external?W.features:((await tr.getData("query:coordinates",{inputs:{coordinates:W.coordinate,query_point_tolerance:er.getCurrentProject().getQueryPointTolerance(),layerIds:[P.id],multilayers:!1},outputs:null})).data[0]||{features:[]}).features,S))}catch(ge){console.warn(ge)}}})}),K;try{K=V.length>1?await w(oe({features:V,inputs:_})):V[0]}catch(z){console.warn(z)}if(K){let z=new ar({feature:K,properties:U.map(W=>W.name)});return z.setTemporaryId(),z}return I.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",closable:!1,autoclose:!0}),Promise.reject()});U.forEach(({name:P})=>{A.get(P)===void 0&&A.set(P,null)}),x.getEditingNotEditableFields().find(P=>{x.isPkField(P)&&A.set(P,null)}),ir({feature:A}),A.setTemporaryId(),N.addFeature(A),F.pushAdd(R,A,!1),_.features.push(A),this.fireEvent("addfeature",A),b(_)}catch(A){console.warn(A),k(A)}}}}}).on("hide.bs.modal",()=>T.$destroy())}))}}),p],registerEscKeyEvent:!0})})()}})(),i&&u.includes("add_feature")&&{id:"copyfeatures",type:["add_feature"],name:"editing.tools.copy",icon:`mActionMoveFeatureCopy${o}.svg`,op:new y({layer:e,type:"copyfeatures",runOnce:!0,steps:[new ue({layer:e,help:"editing.steps.help.copy",type:ie.ismobile?"single":"multiple",steps:{select:{description:`editing.workflow.steps.${ie.ismobile?"selectPoint":"selectPointSHIFT"}`,done:!1}}},!0),e.getGeometryType().includes("Point")?void 0:new E({layer:e,help:"editing.steps.help.select",steps:{from:{description:"editing.workflow.steps.selectStartVertex",done:!1}},run(f){return v(async()=>{let p=new Promise((_,m)=>{if(this.reject=m,f.features.length===0)return m("no feature");this.addInteraction(new ol.interaction.Draw({type:"Point",condition:b=>f.features.some(k=>cs({feature:k,coordinates:b.coordinate}))}),{drawend:b=>{f.coordinates=b.feature.getGeometry().getCoordinates(),this.setUserMessageStepDone("from"),_(f)}}),this.addInteraction(new ol.interaction.Snap({edge:!1,features:new ol.Collection(f.features)}))});return H({promise:v(async()=>{try{return await p}catch(_){return console.warn(_),Promise.reject(_)}}),inputs:f,style:this.selectStyle}),p})},stop(){this.reject(),this.reject=null}}),new E({layer:e,help:"editing.steps.help.select_vertex_to_paste",steps:{to:{description:"editing.workflow.steps.selectToPaste",done:!1}},run(f,p){return v(async()=>{let{layer:_,features:m,coordinates:b}=f,k=_.getEditingLayer().getSource(),x=_.getId(),S=p.session,R=new Promise((U,F)=>{this.reject=F,this.addInteraction(new ol.interaction.Draw({type:"Point",features:new ol.Collection}),{drawend:O=>{let[N,T]=O.feature.getGeometry().getCoordinates(),L=b?It({x:N,y:T,coordinates:b}):null,A=m.length,P=[];for(let V=0;V<A;V++){let K=me(m[V],_);if(L)K.getGeometry().translate(L.x,L.y);else{let z=K.getGeometry().getCoordinates(),W=It({x:N,y:T,coordinates:z});K.getGeometry().translate(W.x,W.y)}P.push(Z({inputs:f,context:p,feature:K}))}Promise.allSettled(P).then(V=>V.forEach(({status:K,value:z})=>{let W=rt({layer:_,feature:z}),ge=S.pushAdd(x,z);Object.entries(W).length&&Object.entries(W).forEach(([Oe,ui])=>ge.set(Oe,ui)),k.addFeature(ge),f.features.push(ge)})).finally(()=>{this.setUserMessageStepDone("to"),U(f)})}}),this.addInteraction(new ol.interaction.Snap({source:k,edge:!1}))});return H({promise:v(async()=>{try{return await R}catch(U){return console.warn(U),Promise.reject(U)}}),inputs:f,style:this.selectStyle}),R})},stop(){this.reject(),this.reject=null}})].filter(Boolean),registerEscKeyEvent:!0})},i&&u.includes("add_feature")&&u.includes("change_feature")&&{id:"addPart",type:["add_feature","change_feature"],name:"editing.tools.addpart",icon:"mActionAddPart.svg",visible:c,op:new y({layer:e,type:"addparttomultigeometries",helpMessage:"editing.tools.addpart",runOnce:!0,steps:[new se({steps:{select:{description:"editing.workflow.steps.select",done:!1}}}),new E({run:_e,help:"editing.steps.help.select_element"}),new Q({layer:e,help:"editing.steps.help.select_element",add:!1,steps:{addfeature:{description:"editing.workflow.steps.draw_part",done:!1}},tools:["snap","measure"]}),new E({layer:e,help:"editing.steps.help.select_element",run:dt})],registerEscKeyEvent:!0})},i&&u.includes("change_feature")&&{id:"deletePart",type:["change_feature"],name:"editing.tools.deletepart",icon:"mActionDeletePart.svg",visible:c,op:new y({layer:e,type:"deletepartfrommultigeometries",steps:[new se,new E({run:_e}),new E({layer:e,run(f,p){return v(new Promise((_,m)=>{let b=f.layer,k=f.layer.getEditingLayer(),x=b.getId(),S=p.session,{features:R,coordinate:U}=f,F=R[0],O=F.clone(),N=F.getGeometry(),T=[];switch(N.getType()){case _t.MULTIPOLYGON:T=N.getPolygons();break;case _t.MULTILINE:T=N.getLineStrings();break;case _t.MULTILINESTRING:T=N.getLineStrings();break;case _t.MULTIPOINT:T=N.getPoints();break;default:console.warn("invalid geometry type",N.getType());break}let L=new ol.source.Vector({features:T.map(K=>new ol.Feature(K))}),A=this.getMap(),P=A.getPixelFromCoordinate(U),V=new ol.layer.Vector({source:L,style:k.getStyle()});A.addLayer(V),A.once("postrender",()=>{let K=!1;A.forEachFeatureAtPixel(P,z=>{if(!K){if(L.removeFeature(z),L.getFeatures().length){let W=L.getFeatures().map(Oe=>Oe.getGeometry()),ge=W[0]&&W[0].getType();F.setGeometry(ge&&new ol.geom[`Multi${ge}`](W.map(Oe=>Oe.getCoordinates()))),Z({inputs:f,context:p,feature:F}).finally(()=>{S.pushUpdate(x,F,O),_(f)})}else k.getSource().removeFeature(F),S.pushDelete(x,F),_(f);K=!0}},{layerFilter(z){return z===V},hitTolerance:1}),A.removeLayer(V),V=null})}))}})],helpMessage:"editing.tools.deletepart"})},(r||l)&&u.includes("change_feature")&&{id:"splitfeature",type:["change_feature"],name:"editing.tools.split",icon:"mActionSplitFeatures.svg",op:new y({layer:e,type:"splitfeature",runOnce:!0,steps:[new ue({layer:e,help:"editing.steps.help.split",type:ie.ismobile?"single":"multiple",steps:{select:{description:`editing.workflow.steps.${ie.ismobile?"selectPoint":"selectPointSHIFT"}`,done:!1}}},!0),new E({layer:e,help:"",steps:{draw_line:{description:"editing.workflow.steps.draw_split_line",done:!1}},run(f,p){return v(async()=>{let _=f.layer.getEditingLayer().getSource(),m=new Promise((b,k)=>{this.reject=k,this.addInteraction(new ol.interaction.Draw({type:"LineString",features:new ol.Collection,freehandCondition:ol.events.condition.never}),{drawend:async x=>{let S=!1,R=gs(f.features,x.feature),U=R.length;for(let F=0;F<U;F++)R[F].geometries.length>1&&(S=!0,await us({context:p,inputs:f,feature:f.features.find(O=>O.getUid()===R[F].uid),splittedGeometries:R[F].geometries,session:p.session}));(S?b:k)(f),await new Promise(F=>setTimeout(F,600)),I.showUserMessage({type:S?"success":"warning",message:S?"plugins.editing.messages.splitted":"plugins.editing.messages.nosplittedfeature",autoclose:!0})}}),this.addInteraction(new ol.interaction.Snap({source:_,edge:!0}))});return H({promise:v(async()=>{try{return await m}catch(b){return console.warn(b),Promise.reject(b)}}),inputs:f,style:this.selectStyle}),m})},stop(){this.reject(),this.reject=null}})],registerEscKeyEvent:!0})},(r||l)&&u.includes("change_feature")&&{id:"mergefeatures",type:["change_feature"],name:"editing.tools.merge",icon:"mActionMergeFeatures.svg",op:new y({layer:e,type:"mergefeatures",runOnce:!0,steps:[new ue({layer:e,type:"bbox",help:"editing.steps.help.merge",steps:{select:{description:`editing.workflow.steps.${ie.ismobile?"selectDrawBox":"selectSHIFT"}`,done:!1}}},!0),new E({layer:e,help:"editing.steps.help.merge",steps:{choose:{description:"editing.workflow.steps.merge",done:!1}},run(f,p){return v(new Promise((_,m)=>{let{layer:b,features:k}=f,S=b.getEditingLayer().getSource(),R=b.getId(),U=p.session;k.length<2?(I.showUserMessage({type:"warning",message:"plugins.editing.messages.select_min_2_features",autoclose:!0}),m()):oe({features:k,inputs:f}).then(async F=>{let O=k.findIndex(L=>F===L),N=F.clone(),T=sr({features:k,index:O});if(T){try{await Z({inputs:f,context:p,feature:T})}catch(L){console.warn(L)}U.pushUpdate(R,T,N),k.filter(L=>L!==F).forEach(L=>{U.pushDelete(R,L),S.removeFeature(L)}),f.features=[F],_(f)}else I.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",autoclose:!0}),m()}).catch(F=>{console.warn(F),m()})}))}})],registerEscKeyEvent:!0})},g&&u.includes("add_feature")&&{id:"addfeature",type:["add_feature"],name:"editing.tools.add_feature",icon:"mActionCreateTable.svg",op:new y({layer:e,type:"addtablefeature",steps:[new E({help:"editing.steps.help.new",run:ye}),new M]})},g&&u.includes("delete_feature")&&u.includes("change_attr_feature")&&{id:"edittable",type:["delete_feature","change_attr_feature"],name:"editing.tools.update_feature",icon:"mActionEditTable.svg",op:new y({layer:e,type:"edittable",backbuttonlabel:"plugins.editing.form.buttons.save_and_back_table",runOnce:!0,steps:[new ke]})}].filter(Boolean).map(f=>Object.assign(new zt,f))},this.state._tools.forEach(f=>{Object.assign(f,{disabledtoolsoftools:[],enabled:!!f.enabled,active:!1,message:null,messages:f.op.getMessages(),visible:f.visible instanceof Function?f.visible(f):f.visible!==void 0?f.visible:!0,state:new Proxy({},{get:(p,_)=>f[_],set:(p,_,m)=>(f[_]=m,!0)}),start:this._startTool.bind(this,f),stop:this._stopTool.bind(this,f),getId:()=>f.id,getOperator:()=>f.op,setOperator:p=>f.op=p,disableEdit:!!f.disableEdit})}),Object.assign(this.state,{tools:this.state._tools,originalState:{title:this.state.title,toolsoftool:[...this.state.toolsoftool]}}),this.originalState=this.state.originalState,this._getFeaturesEvent={event:null,fnc:null},this.messages={constraint:{scale:`${Me("editing.messages.constraints.enable_editing")}${this.state._constraints.scale}`.toUpperCase()}},this.startResolve=null,this._olStartKeysEvent=[],this.unwatches=[]}_stopSessionChildren(e){let s=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),i=s.getLayerById(e);fe({layerId:e,relations:i.getRelations()?i.getRelations().getArray():[]}).filter(a=>a.getFather()===e).forEach(a=>{let n=te({layerId:e,relation:a});s.getToolBoxById(n).inEditing()||s.state.sessions[n].stop()})}getState(){return this.state}setShow(e=!0){this.state.show=e}getLayer(){return this.state.layer}isFather(){return this.state.editing.father}getDependencies(){return this.state.editing.dependencies}hasDependencies(){return this.state.editing.dependencies.length>0}setFeaturesOptions({filter:e}={}){e?(e.nofeatures&&(e.nofeatures_field=e.nofeatures_field||this.state.layer.getEditingFields()[0].name),this.state._getFeaturesOption={filter:e,editing:!0,registerEvents:!1},e.constraint&&(this.constraintFeatureFilter=e)):this.state._getFeaturesOption=st(Se.LayerTypes.TABLE===this.state._layerType?"all":"bbox",{layerId:this.getId()})}setEditingConstraints(e={}){Object.keys(e).forEach(s=>this.constraints[s]=e[s])}_handleScaleConstraint(e=!1){let s=I.getService("map").getMap();this.state.editing.canEdit=or(s.getView().getResolution())<=this.state._constraints.scale;let i=this._start||this.startResolve,a=!e&&this.state.selected&&!this.state.editing.canEdit,n=I.getService("map").getCurrentToggledMapControl();if(n&&n.cursorClass&&(e||i)&&n.setMouseCursor(!a),s.getViewport().classList.toggle("ol-zoom-in",a),e||!this.state.selected||!i){I.setModal(!1);return}if(this.state.editing.canEdit&&this.startResolve&&this.startResolve(),this.state.editing.canEdit&&this.state.activetool?.op.getRunningStep()instanceof M){I.setModal(s.getInteractions().item(s.getInteractions().getLength()-1).get("id")!=="picklayer");return}setTimeout(()=>I.setModal(!this.state.editing.canEdit,this.messages.constraint.scale))}start(e={}){return v(new Promise(async(s,i)=>{this._current_style=this.state.layer.getCurrentStyle().name,this.state.layer.config.editing.layer_style&&this._current_style!==this.state.layer.config.editing.layer_style&&(I.getComponent("catalog").getInternalComponent().activeTab="layers",await Je.getLayerById(this.state.id).changeCurrentStyle(this.state.layer.config.editing.layer_style));let a=this.getId(),n=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.constraints.toolboxes[a],{toolboxheader:r=!0,startstopediting:l=!0,changingtools:g=!1,tools:c,filter:o}=e;this.state.changingtools=g,c&&this.setEnablesDisablesTools(c),this.state.toolboxheader=r,this.state.startstopediting=l,o=n&&n.filter||this.constraints.filter||o;let h=this.state.layer.getFeaturesStore().onceafter("featuresLockedByOtherUser",()=>{I.showUserMessage({type:"warning",subtitle:this.state.layer.getName().toUpperCase(),message:"plugins.editing.messages.featureslockbyotheruser"})});this.state._unregisterStartSettersEventsKey.push(()=>this.state.layer.getFeaturesStore().un("featuresLockedByOtherUser",h)),this.state._constraints.scale&&await new Promise(_=>{this.startResolve=_,this._handleScaleConstraint();let m=I.getService("map");this._olStartKeysEvent.push(m.getMap().on("click",b=>{this.state.selected&&!this.state.editing.canEdit&&m.goToRes(b.coordinate,lr(this.state._constraints.scale,I.getService("map").getMapUnits()))})),this.state.editing.canEdit&&_()}),this.startResolve=null,this.setFeaturesOptions({filter:o});let u=async _=>{this.emit("start-editing"),await Fe(this.getId()),await g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"start-editing",id:a});try{let m=await w(_);this.stopLoading(),this.setEditing(!0),await g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"get-features-editing",id:a,options:{features:m}}),s({features:m})}catch(m){console.warn(m),I.notify.error(m.message),await g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"error-editing",id:a,error:m}),this.stop(),this.stopLoading(),i(m)}},f=!!this.__isStarted(),p=ie.ismobile&&I.getService("map").isMapHidden()&&Se.LayerTypes.VECTOR===this.state._layerType;!f&&p&&(this.setEditing(!0),I.getService("map").onceafter("setHidden",()=>{setTimeout(async()=>{this._start=!0,this.startLoading(),this.setFeaturesOptions({filter:o});try{await u(w(this._session.start(this.state._getFeaturesOption)))}catch(_){console.warn(_),this.setEditing(!1)}},300)})),!f&&!p&&(this._start=!0,this.startLoading(),await u(w(this._session.start(this.state._getFeaturesOption)))),f&&!this._start&&(this.startLoading(),await u(w(this._session.getFeatures(this.state._getFeaturesOption))),this._start=!0),f&&this.setEditing(!0)}))}startLoading(){this.state.loading=!0}stopLoading(){this.state.loading=!1}stop(){return v(async()=>{if(this.state.layer.config.editing.layer_style&&this._current_style&&this._current_style!==this.state.layer.config.editing.layer_style&&await Je.getLayerById(this.state.id).changeCurrentStyle(this._current_style),this.disableCanEditEvent&&this.disableCanEditEvent(),this.state._unregisterStartSettersEventsKey.forEach(n=>n()),this.state._unregisterStartSettersEventsKey=[],this._olStartKeysEvent.forEach(n=>ol.Observable.unByKey(n)),this._olStartKeysEvent.splice(0),this.unwatches.forEach(n=>n()),this.unwatches.splice(0),this.startResolve=null,this.state._constraints.scale&&this._handleScaleConstraint(!0),!!!this.__isStarted())return!0;if(!ie.online)return;let s=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),i=this.state.id;if(s.getLayerById(i).getFathers().filter(n=>{let r=s.getToolBoxById(n);if(r&&r.inEditing()&&r.isDirty())return Object.keys(r.getSession().getCommitItems()||{}).find(l=>i===l)}).length>0){this.stopActiveTool(),this.enableTools(!1),this.clearToolboxMessages(),this._stopSessionChildren(this.state.id),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[this.getId()]={};return}this.state.layer.state.editing.ready=!1;try{return await w(this._session.stop()),this._start=!1,this.stopLoading(),this.setEditing(!1),this.state._getFeaturesOption={},this.stopActiveTool(),this.clearToolboxMessages(),this.emit("stop-editing"),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[this.getId()]={},!0}catch(n){return console.warn(n),Promise.reject(n)}finally{this.state.layer.state.editing.ready=!0,this._current_style=null}})}save({ids:e=null,items:s,relations:i=!0,__esPromise:a=!1}={}){return v(new Promise(async(n,r)=>{let l;if(e)return l=this.__commit(e),this.__clearHistory(e),n(l);l=s||this.__getCommitItems(this.__commit()),i||(l.relations={}),this.state.layer.getEditor().commit(l).then(g=>{if(!(g&&g.result)){r(g);return}let{relations:c={}}=g.response;for(let o in c)t.get(o).getSession().getEditor().applyCommitResponse({response:c[o],result:!0});this.__clearHistory(),this._session.saveChangesOnServer(l),a?n({commit:l,response:g}):n(l,g)}).fail(g=>{console.warn(g),r(g)})}))}getEditingConstraints(){return this.state._constraints}canEdit(){return this.state.editing.canEdit}setMessage(e){this.state.message=e}getMessage(){return this.state.message}clearMessage(){this.setMessage(null)}clearToolboxMessages(){this.state.toolmessages.help=null,this.clearMessage()}getId(){return this.state.id}getTitle(){return this.state.title}setTitle(e){this.state.customTitle=!0,this.state.title=e}getColor(){return this.state.color}setEditing(e=!0){this.setEnable(e),this.state.editing.on=e,this.enableTools(e),this.state.layer.setInEditing(e)}inEditing(){return this.state.editing.on}isEnabled(){return this.state.enabled}setEnable(e=!1){return this.state.enabled=e,this.state.enabled}isLoading(){return this.state.loading}isDirty(){return this.state.editing.history.commit}isSelected(){return this.state.selected}setSelected(e=!1){this.state.selected=e,this.state.selected===!1&&this.state.activetool&&this.stopActiveTool();let s=I.getService("map").getMap();this.state._constraints.scale&&(this._handleScaleConstraint(),this.state.selected&&!this.keyChangeResolution&&(this.keyChangeResolution=s.getView().on("change:resolution",()=>this._handleScaleConstraint())),!this.state.selected&&this.keyChangeResolution&&(ol.Observable.unByKey(this.keyChangeResolution),this.keyChangeResolution=null)),this.state.selected&&this._start&&(!this.state._constraints.scale||this.state.canEdit)&&s.dispatchEvent({type:this._getFeaturesEvent.event,target:s})}getTools(){return this.state._tools}getToolById(e){return this.state._tools.find(s=>e===s.getId())}setEnableTool(e){this.state._tools.find(s=>e===s.getId()).state.enabled=!0}setAddEnableTools({tools:e={},options:s={editing_constraints:!0}}={}){let{editing_constraints:i=!1}=s;this.setEnablesDisablesTools({enabled:this.state._tools.filter(a=>i?a.type.includes("add_feature"):["addfeature","editattributes","movefeature","movevertex"].includes(a.getId())).map(a=>({id:a.getId(),options:e[a.getId()]}))}),this.enableTools(!0)}setUpdateEnableTools({tools:e={},excludetools:s=[],options:i={editing_constraints:!0}}){let{editing_constraints:a=!1}=i,n=["editattributes","movefeature","movevertex"],r=this.state._tools.filter(l=>s.includes(l.getId())?!1:a?l.type.find(g=>g==="change_feature"||g==="change_attr_feature"):n.includes(l.getId())).map(l=>{let g=l.getId();return{id:g,options:e[g]}});this.setEnablesDisablesTools({enabled:r}),this.enableTools(!0)}setEnablesDisablesTools(e){if(e){this.state.changingtools=!0;let{enabled:s=[],disabled:i=[]}=e,a=s.length?[]:this.state._tools.map(n=>n.getId());s.forEach(({id:n,options:r={}})=>{let l=this.getToolById(n);if(l){let{active:g=!1}=r;l.messages=r.messages||l.messages,l.visible=r.visible===void 0?!0:r.visible,l.enabled=r.enabled===void 0?!1:r.enabled,l.disabledtoolsoftools=r.disabledtoolsoftools===void 0?[]:r.disabledtoolsoftools,l.visible&&a.push(n),g&&this.setActiveTool(l),this.state._enabledtools===void 0&&(this.state._enabledtools=[]),this.state._enabledtools.push(l)}}),i.forEach(({id:n,options:r})=>{this.getToolById(n)&&(this.state._disabledtools===void 0&&(this.state._disabledtools=[]),this.state._disabledtools.push(n),a.push(n))}),this.state._tools.forEach(n=>!a.includes(n.getId())&&(n.visible=!1)),this.state.changingtools=!1}}enableTools(e=!1){let s=this.state._enabledtools||this.state._tools,i=this.state._disabledtools||[];s.forEach(a=>{let n=a.enable===void 0?e:a.enable;a.enabled=e&&i.length>0?!i.includes(a.getId()):nr(n)==="Boolean"?n:n({bool:e,tool:a}),e||(a.active=e)})}setActiveTool(e){return v(async()=>{try{await w(this.stopActiveTool(e)),this.state.activetool=e;let s=e.getOperator();if(s){s.on("settoolsoftool",a=>{this.state.toolsoftool=(a||[]).filter(n=>!e.disabledtoolsoftools.includes(n.type))});let i=s.getHelpMessage()||s.getRunningStep()?this.state.activetool.messages:null;this.state.toolmessages.help=i&&i.help||null}e.start()}catch(s){console.warn(s)}})}stopActiveTool(e){return v(async()=>{let s=this.getActiveTool();if(e&&(!s||e===s)){e.removeAllListeners();return}try{s&&(s.removeAllListeners(),await w(s.stop(!0))),this.state.toolsoftool=[],this.state.toolmessages.help=null,this.state.activetool=null}catch(i){console.warn(i)}})}getActiveTool(){return this.state.activetool}getSession(){return this._session}getEditor(){return this.state.layer.getEditor()}resetDefault(){this.state.title=this.state.originalState.title,this.state.toolboxheader=!0,this.state.startstopediting=!0,this.constraints={filter:null,show:null,tools:[]},this.state._enabledtools&&(this.state._enabledtools=void 0,this.enableTools(),this.state._tools.forEach(e=>{e.visible=!0,e.enabled=!1,e.messages=e.op.getMessages(),e.disabledtoolsoftools=[]})),this.state._disabledtools=null,this.state.show=this.state.layer.config.editing.visible,this.state.selected=!1}__add(e,s){return v(new Promise(i=>{this.state.editing.session.current===null?this._states=[{id:e,items:s}]:(this._states.length>0&&this.state.editing.session.current<this._states.at(-1).id&&(this._states=this._states.filter(a=>a.id<=this.state.editing.session.current)),this._states.push({id:e,items:s})),this.state.editing.session.current=e,this.__canUndo(),this.__canCommit(),this.__canRedo(),i(e)}))}__undo(){let e;return this._states.find((s,i)=>{if(s.id===this.state.editing.session.current)return e=Rt(this._history.id,this._states[i].items,0),this.state.editing.session.current=i===0?null:this._states[i-1].id,!0}),this.__canUndo(),this.__canCommit(),this.__canRedo(),e}__redo(){let e;return this.state.editing.session.current?this._states.find((s,i)=>{if(s.id===this.state.editing.session.current)return this.state.editing.session.current=this._states[i+1].id,e=this._states[i+1].items,!0}):(e=this._states[0].items,this.state.editing.session.current=this._states[0].id),e=Rt(this._history.id,e,1),this.__canUndo(),this.__canCommit(),this.__canRedo(),e}__getState(e){return this._states.find(s=>e===s.id)}__canCommit(){let e=this.__commit(),s=!1;for(let i in e){let a=e[i];s=s||a.length>0}return this._constrains.commit=s,this._constrains.commit}__canUndo(){let e=null;this.state.editing.session.current&&this._states.length&&this._states.forEach((i,a)=>{if(this.state.editing.session.current===i.id)return e=a,!1});let s=this._states.length-1-e;return this._constrains.undo=this.state.editing.session.current!==null&&s<10,this._constrains.undo}__canRedo(){return this._constrains.redo=this._states.at(-1)&&this._states.at(-1).id!=this.state.editing.session.current||this.state.editing.session.current===null&&this._states.length>0,this._constrains.redo}__commit(){let e={};return this._states.filter(i=>i.id<=this.state.editing.session.current).forEach(i=>{i.items.forEach(a=>{let n=!0;if(Array.isArray(a)&&(a=a[1]),e[a.layerId]&&e[a.layerId].forEach((r,l)=>{if(r.getUid()===a.feature.getUid()){if(a.feature.isNew()&&!r.isDeleted()&&a.feature.isUpdated()){let g=a.feature.clone();g.add(),e[a.layerId][l]=g}else a.feature.isNew()&&a.feature.isDeleted()?e[a.layerId].splice(l,1):(a.feature.isUpdated()||a.feature.isDeleted())&&(e[a.layerId][l]=a.feature);return n=!1,!1}}),n){let r=a.feature,l=a.layerId;!r.isNew()&&r.isAdded()||(e[l]||(e[l]=[]),e[l].push(r))}})}),e}__getLastHistoryState(){return this._states.at(-1)||null}__isStarted(){return this.state.editing.session.started}__getHistory(){return this._history}__getEditor(){return this.state.layer.getEditor()}__push(e,s){this.state.editing.session.changes.push(s?[s,e]:e)}__pushDelete(e,s){return this.__push({layerId:e,feature:s.delete()}),s}__save(e={}){return v(async()=>{if(this.state.editing.session.changes.length>0){let s=e.id||Date.now();return await w(this.__add(s,this.state.editing.session.changes)),this.state.editing.session.changes=[],[s]}return null})}__pushAdd(e,s,i=!0){let a=e===this.state.layer.getId()?this.state.layer.getEditor():t.get(e).getSession().getEditor();i&&(a.getLayer().getEditingNotEditableFields()||[]).forEach(r=>s.unset([r]));let n=s.clone();return this.__push({layerId:e,feature:n.add()}),n}__pushUpdate(e,s,i){let a=s.isNew(),n=a&&this.state.editing.session.changes.findIndex(r=>e===r.layerId&&r.feature.getId()===s.getId());if(a&&n>=0){let r=s.clone();r.add(),this.state.editing.session.changes[n].feature=r;return}this.__push({layerId:e,feature:s.update()},{layerId:e,feature:i.update()})}__rollback(e){return e?this.state.layer.getEditor().rollback(e):v(async()=>{let s=this.state.layer.getId();e={own:[],dependencies:{}},this.state.editing.session.changes.forEach(i=>{let a=Array.isArray(i)?i[0]:i;s===a.layerId?e.own.push(a):(e.dependencies[a.layerId]=e.dependencies[a.layerId]||[],e.dependencies[a.layerId].unshift(a))});try{await w(this.state.layer.getEditor().rollback(e.own));for(let i in e.dependencies)t.get(i).getSession().rollback(e.dependencies[i]);return e.dependencies}catch(i){console.warn(i)}finally{this.state.editing.session.changes=[]}})}__rollbackDependecies(e=[]){e.forEach(s=>{let i=[];this.state.editing.session.changes=this.state.editing.session.changes.filter(a=>{if(s===a.layerId)return i.push(a),!1}),i.length&&t.get(s).getSession().rollback(i)})}__undoSession(e){return e=e||this.__undo(),this.state.layer.getEditor().setChanges(e.own,!0),this.__canCommit(),e.dependencies}__redoSession(e){return e=e||this.__redo(),this.state.layer.getEditor().setChanges(e.own,!0),this.__canCommit(),e.dependencies}__getCommitItems(){let e=this.__commit(),s=this.state.layer.getId(),i,a,n={add:[],update:[],delete:[],relations:{}};for(let l in e){let g=!1,c=e[l];if(l!==s){g=!0;let o=t.get(l).getSession(),h=o?o.getEditor().getLockIds():[];n.relations[l]={lockids:h,add:[],update:[],delete:[],relations:{}},a=n.relations[l]}else a=n;c.forEach(o=>{i=o.getState();let h=new ol.format.GeoJSON;if(i==="delete"){o.isNew()||a.delete.push(o.getId());return}let u=h.writeFeatureObject(o),f=o.getProperties();for(let p in u.properties)u.properties[p]&&typeof u.properties[p]=="object"&&u.properties[p].constructor===Object&&(u.properties[p]=u.properties[p].value),u.properties[p]===void 0&&f[p]&&(u.properties[p]=f[p]);a[o.isNew()?"add":o.getState()].push(u)}),g&&a.add.length===0&&a.update.length===0&&a.delete.length===0&&delete n.relations[l]}return Object.keys(n.relations||{}).filter(l=>this.state.layer.getEditor().getLayer().getRelations().getArray().find(g=>l===g.getChild())===void 0).map(l=>(n.relations[t.get(l).getSession().getEditor().getLayer().getRelations().getArray().find(g=>l===g.getChild()&&n.relations[g.getFather()]).getFather()].relations[l]=n.relations[l],l)).forEach(l=>delete n.relations[l]),n}__clearSession(){this._allfeatures=!1,this.state.editing.session.started=!1,this.state.editing.session.getfeatures=!1,this.__clearHistory()}__clearHistory(e){e?this._states.forEach((s,i)=>{e.includes(s.id)&&(this.state.editing.session.current&&s.id===this.state.editing.session.current&&this.__undo(),this._states.splice(i,1))}):(this._states=[],this.state.editing.session.current=null,this._constrains.commit=!1,this._constrains.redo=!1,this._constrains.undo=!1)}async __startSession(e={}){try{let s=await w(this.state.layer.getEditor().start(e));return this.state.editing.session.started=!0,s}catch(s){return console.warn(s),Promise.reject(s)}finally{if(!e.registerEvents)return;if(this.state._getFeaturesOption=e,Se.LayerTypes.VECTOR===this.state._layerType&&this.state._getFeaturesOption.filter.bbox){let s=()=>{ie.online&&this.state.editing.canEdit&&this.state.selected&&I.getContentLength()===0&&(this.state._getFeaturesOption.filter.bbox=I.getService("map").getMapBBOX(),this.state.loading=!0,this._session.getFeatures(this.state._getFeaturesOption).then(()=>this.state.loading=!1))};this._getFeaturesEvent.event="moveend",this._getFeaturesEvent.fnc=rr(s,300),this._olStartKeysEvent.push(I.getService("map").getMap().on("moveend",this._getFeaturesEvent.fnc)),I.getContentLength()&&I.once("closecontent",()=>{let i=I.getService("map").getMap();setTimeout(()=>i.dispatchEvent({type:this._getFeaturesEvent.event,target:i}))})}}}async __stopSession(){try{(this.state.editing.session.started||this.state.editing.session.getfeatures)&&(await w(this.state.layer.getEditor().stop()),this.__clearSession())}catch(e){return console.warn(e),Promise.reject(e)}finally{ie.online&&this._stopSessionChildren(this.state.id)}}async __getFeatures(e={}){if(!this._allfeatures){this._allfeatures=!e.filter;let s=await w(this.state.layer.getEditor().getFeatures(e));return this.state.editing.session.getfeatures=!0,s}return[]}async __saveChangesOnServer(e){let s=[Fe(this.getId())],i=[],a=(n={})=>{Object.entries(n).forEach(([r,l])=>{i.push(r),a(l.relations)})};a(e.relations),i.forEach(n=>s.push(Fe(n))),await Promise.allSettled(s)}_startTool(e){e.getOperator()&&(e.active=!0,setTimeout(async()=>await this._startOp(e,{inputs:{layer:this.getLayer(),features:[]},context:{session:this._session}},!!I.getService("map").isMapHidden())))}async _startOp(e,s,i){s.inputs.features=s.features||[],i&&I.hideSidebar();try{await w(e.op.start(s)),await w(this._session.save()),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").saveChange()}catch(a){console.warn(a),i&&I.showSidebar(),this._session.rollback()}finally{e.getOperator().runOnce&&this.stopActiveTool(),!e.getOperator().runOnce&&Se.LayerTypes.VECTOR===this.getLayer().getType()&&await this._startOp(e,s,i)}}_stopTool(e,s=!1){return v(async()=>{if(!e.getOperator()){e.emit("stop",{session:this._session});return}try{let i=e.getOperator();await w(e.getOperator().stop(s))}catch(i){console.warn(i),this._session.rollback()}finally{e.active=!1,e.emit("stop",{session:this._session})}})}};Y._sessions={};Y.get=t=>Y._sessions[t];Y.clear=()=>Object.keys(sessions).forEach(t=>delete Y._sessions[t]);G();var{ApplicationState:dr,G3WObject:cr}=g3wsdk.core,{FeaturesStore:Os}=g3wsdk.core.layer.features,{Layer:Gt}=g3wsdk.core.layer,Ht=class extends Os{constructor(e={}){super(e),this._features=e.features||new ol.Collection([])}getLength(){return this._features.getLength()}setFeatures(e=[]){this._features.clear(),this.addFeatures(e),this._features.dispatchEvent("change")}readFeatures(){return this._features.getArray()}getFeaturesCollection(){return this._features}getFeatureById(e){return this._features.getArray().find(s=>e==s.getId())}getFeatureByUid(e){return this._features.getArray().find(s=>e===s.getUid())}_addFeature(e){this._features.push(e),this._features.dispatchEvent("change")}_updateFeature(e){let s=this._features.getArray().findIndex(i=>e.getUid()===i.getUid());s>=0&&(this._features.removeAt(s),this._features.insertAt(s,e),this._features.dispatchEvent("change"))}_removeFeature(e){let s=this._features.getArray().findIndex(i=>e.getUid()===i.getUid());s>=0&&(this._features.removeAt(s),this._features.dispatchEvent("change"))}_clearFeatures(){try{for(let e=0;e<this._features.getArray().length;e++)this._features.removeAt(e)}catch(e){console.warn(e)}this._features=null,this._features=new ol.Collection([])}},Ye=class extends cr{constructor(e={}){super(),this.setters={save(){this._layer.save()},addFeature(s){this._featuresstore.addFeature(s)},updateFeature(s){this._featuresstore.updateFeature(s)},deleteFeature(s){this._featuresstore.deleteFeature(s)},setFeatures(s=[]){this._featuresstore.setFeatures(s)},getFeatures(s={}){return!dr.online||this._allfeatures?v(Promise.resolve()):v(async()=>{let i=!0,{bbox:a}=s.filter||{},n=a&&Gt.LayerTypes.VECTOR===this._layer.getType();if(n&&this._filter.bbox===null)this._filter.bbox=a,i=!0;else if(n){let r=ol.extent.containsExtent(this._filter.bbox,a);r||(this._filter.bbox=ol.extent.extend(this._filter.bbox,a)),i=!r}if(i){let r=await w(this._layer.getFeatures(s));return this._featuresstore.addFeatures((r||[]).map(l=>l.clone())),this._allfeatures=!s.filter,r}})}},this._filter={bbox:null},this._allfeatures=!1,this._layer=e.layer,this._featuresstore=Gt.LayerTypes.TABLE===this._layer.getType()?new Os:new Ht,this._started=!1}getEditingSource(){return this._featuresstore}getSource(){this._layer.getSource()}setChanges(e=[],s=!0){let i={add:{fnc:"addFeature",opposite:"delete"},delete:{fnc:"removeFeature",opposite:"add"},update:{fnc:"updateFeature",opposite:"update"}};e.forEach(a=>{s&&a.feature[i[a.feature.getState()].opposite](),this._featuresstore[i[a.feature.getState()].fnc](a.feature.clone())})}getLayer(){return this._layer}setLayer(e){return this._layer=e}rollback(e=[]){return v(()=>this.setChanges(e,!0))}applyCommitResponse(e={},s=[]){if(!(e&&e.result))return;e.response.new.forEach(({clientid:a,id:n,properties:r}={})=>{let l=this.getEditingSource().getFeatureById(a);l.setId(n),l.setProperties(r),s.forEach(g=>{Object.entries(g).forEach(([c,o={}])=>{let h=Y.get(c).getSession().getEditor().getEditingSource();(o.ids||[]).forEach(u=>{let f=h.getFeatureById(u);f&&o.fatherField.forEach((p,_)=>{f.set(o.childField[_],l.get(p))})})})})}),(e.response.update||[]).forEach(({id:a,properties:n}={})=>{let r=this.getEditingSource().getFeatureById(a);r.setProperties(n),s.forEach(l=>{Object.entries(l).forEach(([g,c={}])=>{let o=Y.get(g).getSession().getEditor().getEditingSource();(c.ids||[]).forEach(h=>{let u=o.getFeatureById(h);u&&c.fatherField.forEach((f,p)=>{u.set(c.childField[p],r.get(f))})})})})});let i=this.readEditingFeatures();i.forEach(a=>a.clearState()),this._layer.setFeatures([...i]),this.addLockIds(e.response.new_lockids)}addLockIds(e){this._layer.getSource().addLockIds(e)}getLockIds(){return this._layer.getSource().getLockIds()}commit(e){return v(async()=>{let s=[];e.add.length&&(s=Object.keys(e.relations).map(a=>{let n=this._layer.getRelations().getRelationByFatherChildren(this._layer.getId(),a);return{[a]:{ids:[...e.relations[a].add.map(r=>r.id),...e.relations[a].update.map(r=>r.id)],fatherField:n.getFatherField(),childField:n.getChildField()}}}));let i=await w(this._layer.commit(e));return this.applyCommitResponse(i,s),i})}start(e={}){return v(async()=>{let s=await w(this.getFeatures(e));return this._started=!0,s})}readFeatures(){return this._layer.readFeatures()}readEditingFeatures(){return this._featuresstore.readFeatures()}stop(){return v(async()=>{let{result:e}=await w(this._layer.unlock());return this.clear(),e})}isStarted(){return this._started}clear(){this._started=!1,this._filter.bbox=null,this._allfeatures=!1,this._featuresstore.clear(),this._layer.getFeaturesStore().clear(),Gt.LayerTypes.VECTOR===this._layer.getType()&&this._layer.resetEditingSource(this._featuresstore.getFeaturesCollection())}};he();function mt(t){return t instanceof Promise?t:!t||!t.then?(console.trace(t),Promise.reject("not a promise")):new Promise((e,s)=>{t.then(e).fail(s)})}var yt=class{constructor(){this.tasks=[]}addTask(e){this.tasks.push(e)}run(e=!1){for(;this.tasks.length;)(e?this.tasks.pop():this.tasks.shift())()}flush(){return this.tasks.splice(0)}getLength(){return this.tasks.length}clear(){this.run(),this.tasks=[]}},bt=class extends g3wsdk.core.G3WObject{constructor(){super(),console.warn("[G3W-CLIENT] g3wsdk.core.workflow.Flow is deprecated"),this.steps=[],this.counter=0,this.context=null,this.queques={end:new yt,micro:new yt},this.inputs,this.d,this._workflow}start(e){return this.d=$.Deferred(),this.counter>0&&console.log("reset workflow before restarting"),this._workflow=e,this.inputs=e.getInputs(),this.context=e.getContext(),this.steps=e.getSteps(),this.steps&&this.steps.length&&this.runStep(this.steps[0],this.inputs,this.context),this.d.promise()}runStep(e,s){this._workflow.setMessages({help:e.state.help});let i=this.queques.micro.getLength();e.run(s,this.context,this.queques).then(a=>{i&&this.queques.micro.run(),this.onDone(a)}).fail(a=>this.onError(a))}onDone(e){if(this.counter++,this.counter===this.steps.length){this.counter=0,this.d.resolve(e);return}this.runStep(this.steps[this.counter],e)}onError(e){this.counter=0,this.clearQueques(),this.d.reject(e)}stop(){let e=$.Deferred();return this.steps[counter].isRunning()&&this.steps[this.counter].stop(),this.clearQueques(),this.counter>0?(this.counter=0,e.reject()):e.resolve(),e.promise()}clearQueques(){this.queques.micro.clear(),this.queques.end.clear()}},vt={Actions:{add:{fnc:"addFeature",opposite:"delete"},delete:{fnc:"removeFeature",opposite:"add"},update:{fnc:"updateFeature",opposite:"update"}},execute(t,e,s){console.warn("[G3W-CLIENT] g3wsdk.core.workflow.ChangesManager is deprecated");let i,a;e.forEach(n=>{a=n.feature,s&&a[vt.Actions[a.getState()].opposite](),i=vt.Actions[a.getState()].fnc,t[i](a)})}},Ie=class t extends g3wsdk.core.G3WObject{constructor(e={}){console.warn("[G3W-CLIENT] g3wsdk.core.workflow.Session is deprecated"),super(e),this.setters={start(s={}){return $.Deferred(async i=>{try{let a=await mt(this._editor.start(s));this.state.started=!0,i.resolve(a)}catch(a){console.warn(a),i.reject(a)}}).promise()},stop(){return $.Deferred(async s=>{if(!(this.state.started||this.state.getfeatures))return s.resolve();try{await mt(this._editor.stop()),this.clear(),s.resolve()}catch(a){console.warn(a),s.reject(a)}}).promise()},getFeatures(s={}){return $.Deferred(async i=>{if(this._allfeatures)return i.resolve([]);this._allfeatures=!s.filter;try{let a=await mt(this._editor.getFeatures(s));this.state.getfeatures=!0,i.resolve(a)}catch(a){console.warn(a),i.reject(a)}}).promise()},saveChangesOnServer(s){}},this.state={id:e.id,started:!1,getfeatures:!1,maxSteps:10,current:null,changes:[]},this._states=[],this._constrains={commit:!1,undo:!1,redo:!1},this._editor=e.editor,this._history={id:this.state.id,state:new Proxy({},{get:(s,i)=>this._constrains[i]}),add:this.__add.bind(this),getRelationStates:this.__getRelationStates.bind(this),insertState:this.__insertState.bind(this),removeState:this.deleteState.bind(this),removeStates:this.removeChangesFromHistory.bind(this),insertStates:this.__insertStates.bind(this),undo:this.__undo.bind(this),clear:this.clearHistory.bind(this),redo:this.__redo.bind(this),setItemsFeatureIds:this.__setItemsFeatureIds.bind(this),getState:this.__getState.bind(this),getFirstState:this.__getFirstState.bind(this),getLastState:this.getLastHistoryState.bind(this),getCurrentState:this.__getCurrentState.bind(this),getCurrentStateIndex:this.__getCurrentStateIndex.bind(this),canCommit:this.__canCommit.bind(this),canUndo:this.__canUndo.bind(this),canRedo:this.__canRedo.bind(this),commit:this.__commit.bind(this)},this.register()}_checkSessionItems(e,s,i){let a={own:[],dependencies:{}};return s.forEach(n=>{Array.isArray(n)&&(n=n[i]),e===n.layerId?a.own.push(n):(a.dependencies[n.layerId]=a.dependencies[n.layerId]||{own:[],dependencies:{}},a.dependencies[n.layerId].own.push(n))}),a}getId(){return this.state.id}getLastHistoryState(){return this._states.length?this._states[this._states.length-1]:null}getLastStateId(){return this.getLastHistoryState().id}deleteState(e){let s=this._states.findIndex(i=>i.id===e);console.assert(s>=0,`invalid stateId ${e}`),this.state.current===e&&(this.state.current=this._states.length>1?this._states[s-1].id:null),this._states.splice(s,1)}register(){t.Registry.register(this)}unregister(){t.Registry.unregister(this.getId())}isStarted(){return this.state.started}getEditor(){return this._editor}setEditor(e){this._editor=e}save(e={}){let s=$.Deferred();if(this.state.changes.length){let i=e.id||Date.now();this._history.add(i,this.state.changes).then(()=>{this.state.changes=[],s.resolve(i)})}else s.resolve(null);return s.promise()}updateTemporaryChanges(e){this.state.changes.forEach(s=>s.feature.setProperties(e.getProperties()))}pushAdd(e,s,i=!0){let a=e===this.getId()?this._editor:t.Registry.getSession(e).getEditor();i&&(a.getLayer().getEditingNotEditableFields()||[]).forEach(r=>s.unset([r]));let n=s.clone();return this.push({layerId:e,feature:n.add()}),n}pushDelete(e,s){return this.push({layerId:e,feature:s.delete()}),s}pushUpdate(e,s,i){let a=s.isNew(),n=a&&this.state.changes.findIndex(r=>e===r.layerId&&r.feature.getId()===s.getId());if(a&&n>=0){let r=s.clone();r.add(),this.state.changes[n].feature=r;return}this.push({layerId:e,feature:s.update()},{layerId:e,feature:i.update()})}removeChangesFromHistory(e=[]){(e||[]).forEach(s=>this.deleteState(s))}moveRelationStatesOwnSession(){let e={},{relations:s}=this.getCommitItems();for(let i in s){let a=this._history.getRelationStates(i);t.Registry.getSession(i)._history.insertStates(a),e[i]=a.map(n=>n.id)}return e}push(e,s){this.state.changes.push(s?[s,e]:e)}revert(){let e=$.Deferred();return this._editor.revert().then(()=>{this.clearHistory(),e.resolve()}),e.promise()}rollback(e){if(e)return this._editor.rollback(e);let s=$.Deferred(),i=this.getId();return e={own:[],dependencies:{}},this.state.changes.forEach(a=>{let n=Array.isArray(a)?a[0]:a;n.layerId===i?e.own.push(n):(e.dependencies[n.layerId]||(e.dependencies[n.layerId]=[]),e.dependencies[n.layerId].unshift(n))}),this._editor.rollback(e.own).then(()=>{for(let a in e.dependencies)t.Registry.getSession(a).rollback(e.dependencies[a]);s.resolve(e.dependencies)}),this.state.changes=[],s.promise()}rollbackDependecies(e=[]){e.forEach(s=>{let i=[];this.state.changes=this.state.changes.filter(a=>{if(a.layerId===s)return i.push(a),!1}),i.length&&t.Registry.getSession(s).rollback(i)})}undo(e){return e=e||this._history.undo(),this._editor.setChanges(e.own,!0),this._history.canCommit(),e.dependencies}redo(e){return e=e||this._history.redo(),this._editor.setChanges(e.own,!0),this._history.canCommit(),e.dependencies}getCommitItems(){let e=this._history.commit(),s=this.getId(),i,a,n={add:[],update:[],delete:[],relations:{}};for(let l in e){let g=!1,c=e[l];if(l!==s){g=!0;let o=t.Registry.getSession(l),h=o?o.getEditor().getLockIds():[];n.relations[l]={lockids:h,add:[],update:[],delete:[],relations:{}},a=n.relations[l]}else a=n;c.forEach(o=>{i=o.getState();let h=new ol.format.GeoJSON;switch(i){case"delete":o.isNew()||a.delete.push(o.getId());break;default:let u=h.writeFeatureObject(o),f=o.getProperties();for(let p in u.properties)u.properties[p]&&typeof u.properties[p]=="object"&&u.properties[p].constructor===Object&&(u.properties[p]=u.properties[p].value),u.properties[p]===void 0&&f[p]&&(u.properties[p]=f[p]);a[o.isNew()?"add":o.getState()].push(u);break}}),g&&a.add.length===0&&a.update.length===0&&a.delete.length===0&&delete n.relations[l]}return Object.keys(n.relations||{}).filter(l=>this._editor.getLayer().getRelations().getArray().find(g=>l===g.getChild())===void 0).map(l=>(n.relations[t.Registry.getSession(l).getEditor().getLayer().getRelations().getArray().find(g=>l===g.getChild()&&n.relations[g.getFather()]).getFather()].relations[l]=n.relations[l],l)).forEach(l=>delete n.relations[l]),n}set3DGeometryType({layerId:e=this.getId(),commitItems:s}={}){let{relations:i}=s,a=MapLayersStoresRegistry.getLayerById(e).getEditingLayer();if(a&&g3wsdk.core.layer.Layer.LayerTypes.VECTOR===a.getType()){let n=a.getGeometryType();g3wsdk.core.geoutils.Geometry.is3DGeometry(n)&&["add","update"].forEach(r=>s[r].forEach(l=>l.geometry.type=n))}Object.keys(i).forEach(n=>this.set3DGeometryType({layerId:n,commitItems:i[n]}))}commit({ids:e=null,items:s,relations:i=!0,__esPromise:a=!1}={}){let n=$.Deferred(),r;return e?(r=this._history.commit(e),this.clearHistory(e),n.promise()):(r=s||this.getCommitItems(this._history.commit()),i||(r.relations={}),this._editor.commit(r).then(l=>{if(!(l&&l.result)){n.reject(l);return}let{relations:g={}}=l.response;for(let c in g)t.Registry.getSession(c).getEditor().applyCommitResponse({response:g[c],result:!0});this.clearHistory(),this.saveChangesOnServer(r),a?n.resolve({commit:r,response:l}):n.resolve(r,l)}).fail(l=>n.reject(l)),n.promise())}clear(){this._allfeatures=!1,this.state.started=!1,this.state.getfeatures=!1,this.clearHistory()}getHistory(){return this._history}clearHistory(e){e?this._states.forEach((s,i)=>{e.indexOf(s.id)!==-1&&(this.state.current&&this.state.current===s.id()&&this._history.undo(),this._states.splice(i,1))}):(this._states=[],this.state.current=null,this._constrains.commit=!1,this._constrains.redo=!1,this._constrains.undo=!1)}__add(e,s){let i=$.Deferred();return this.state.current===null?this._states=[{id:e,items:s}]:(this._states.length>0&&this.state.current<this.getLastStateId()&&(this._states=this._states.filter(a=>a.id<=this.state.current)),this._states.push({id:e,items:s})),this.state.current=e,this._history.canUndo(),this._history.canCommit(),this._history.canRedo(),i.resolve(e),i.promise()}__getRelationStates(e,{clear:s=!1}={}){let i=[];for(let a=0;a<this._states.length;a++){let n=this._states[a],r=n.items.filter(l=>(Array.isArray(l)?l[0].layerId:l.layerId)===e);r.length>0&&i.push({id:n.id,items:r})}return i}__insertState(e){let s=e.id,i=this._states.length;for(let a=0;a<this._states.length;a++){let n=this._states[a];if(n.id>s){i=a;break}else if(n.id===s){i=-1;break}}i>-1&&(this.state.current<s&&(this.state.current=s),this._states.splice(i,0,e))}__insertStates(e=[]){for(let s=0;s<e.length;s++)this._history.insertState(e[s]);this._history.canCommit()}__undo(){let e;return this.state.current===this._history.getFirstState().id?(this.state.current=null,e=this._states[0].items):this._states.find((s,i)=>{if(s.id===this.state.current)return e=this._states[i].items,this.state.current=this._states[i-1].id,!0}),e=this._checkSessionItems(this._history.id,e,0),this._history.canUndo(),this._history.canCommit(),this._history.canRedo(),e}__redo(){let e;return this.state.current?this._states.find((s,i)=>{if(this.state.current===s.id)return this.state.current=this._states[i+1].id,e=this._states[i+1].items,!0}):(e=this._states[0].items,this.state.current=this._states[0].id),e=this._checkSessionItems(this._history.id,e,1),this._history.canUndo(),this._history.canCommit(),this._history.canRedo(),e}__setItemsFeatureIds(e=[]){e.forEach(s=>{this._states.forEach(i=>{i.items.forEach(a=>{let n=a.feature.getId()===s.clientid&&a.feature;n&&n.setId(s.id)})})})}__getState(e){return this._states.find(s=>s.id===e)}__getFirstState(){return this._states.length?this._states[0]:null}__getCurrentState(){let e=null;return this.state.current&&this._states.length&&(e=this._states.find(s=>this.state.current===s.id)),e}__getCurrentStateIndex(){let e=null;return this.state.current&&this._states.length&&this._states.forEach((s,i)=>{if(this.state.current===s.id)return e=i,!1}),e}__canCommit(){let e=this._history.commit(),s=!1;for(let i in e){let a=e[i];s=s||a.length>0}return this._constrains.commit=s,this._constrains.commit}__canUndo(){let e=this._states.length-1-this._history.getCurrentStateIndex();return this._constrains.undo=this.state.current!==null&&this.state.maxSteps>e,this._constrains.undo}__canRedo(){return this._constrains.redo=this.getLastHistoryState()&&this.getLastStateId()!=this.state.current||this.state.current===null&&this._states.length>0,this._constrains.redo}__commit(){let e={};return this._states.filter(i=>i.id<=this.state.current).forEach(i=>{i.items.forEach(a=>{let n=!0;if(Array.isArray(a)&&(a=a[1]),e[a.layerId]&&e[a.layerId].forEach((r,l)=>{if(r.getUid()===a.feature.getUid()){if(a.feature.isNew()&&!r.isDeleted()&&a.feature.isUpdated()){let g=a.feature.clone();g.add(),e[a.layerId][l]=g}else a.feature.isNew()&&a.feature.isDeleted()?e[a.layerId].splice(l,1):(a.feature.isUpdated()||a.feature.isDeleted())&&(e[a.layerId][l]=a.feature);return n=!1,!1}}),n){let r=a.feature,l=a.layerId;!r.isNew()&&r.isAdded()||(e[l]||(e[l]=[]),e[l].push(r))}})}),e}},Ce={};Ie.Registry={_sessions:Ce,register(t){Ce[t.getId()]=t},unregister(t){delete Ce[t]},getSession(t){return Ce[t]},setSession(t,e){Ce[t]=e},getSessions(){return Ce},clear(){Object.keys(Ce).forEach(Ie.Registry.unregister)}};ee();(window.g3wsdk.core.editing||window.g3wsdk.core.workflow||window.g3wsdk.constant.DEFAULT_EDITING_CAPABILITIES||g3wsdk.version<"4")&&console.warn("Editing APIs will be removed from g3wsdk after v4.x");window.g3wsdk.core.editing={Session:Ie,SessionsRegistry:Ie.Registry,Editor:Ye,ChangesManager:vt};window.g3wsdk.constant.DEFAULT_EDITING_CAPABILITIES=["add_feature","change_feature","change_attr_feature","delete_feature"];window.g3wsdk.core.workflow={Task:E,Step:E,Flow:bt,Workflow:y,WorkflowsStack:y.Stack};var Ds={close_editing_panel:{message:"\u26A0\uFE0F Prima conferma le modifiche (\u2705) su ogni livello"},disabled_editing:{message:"\u26A0\uFE0F Disattiva strumento editing"},errors:{no_layers:"Si \xE8 verificato un errore nel caricamento dei layers in editing.",some_layers:"Si \xE8 verificato un errore nel caricamento di alcuni layers in editing",editing_multiple_relations:"Le modifica di relazioni multiple non \xE8 attualmente supportata"},search:"Cerca",editing_changes:"Modifiche Editing",editing_data:"Modifica dati",editing_attributes:"Edita attributi",relations:"Relazioni",edit_relation:"Edita relazione",back_to_relations:"Ritorna alle Relazioni",no_relations_found:"Non ci sono relazioni",relation_data:"Dati relativi alla relazione",relation_already_added:"Relazione gi\xE0 presente",list_of_relations_feature:"Elenco Relazioni della feature ",tooltip:{edit_layer:"Modifica livello",filter_by_relation:"Filtra i livelli per relazione"},toolbox:{title:"Edita"},table:{edit:"Edita feature",copy:"Crea una copia",delete:"Cancella feature"},tools:{copy:"Copia elementi",pastefeaturesfromotherlayers:"Incolla elemento da altro livello",addpart:"Aggiungi parte alla geometria",deletepart:"Cancella parte dalla geometria",merge:"Dissolvi elementi",split:"Dividi elementi",add_feature:"Aggiungi elemento",delete_feature:"Elimina elemento",move_feature:"Muovi elemento",rotate_feature:"Ruota elemento",update_vertex:"Aggiorna vertici elemento",update_feature:"Modifica attributi elemento",update_multi_features:"Modifica gli attributi degli elementi selezionati",update_multi_features_relations:"Modifica gli attributi di tutte le relazioni selezionate",update_multi_features_relations_from_parents:"Aggiungi/Edita i record relazionati di uno o pi\xF9 padri",copyfeaturefromexternallayer:"Crea elemento da un livello esterno"},toolsoftool:{measure:"Visualizza misura",snap:"Snap sul layer",snapall:"Snap su tutti i layer"},steps:{help:{select_elements:"Seleziona le geometrie",select_element:"Seleziona l'elemento",copy:"Crea una copia degli elementi selezionati",merge:"Dissolvi elementi",split:"Dvidi elemento",new:"Crea un nuovo elemento",edit_table:"Modifica gli elementi della tabella",draw_new_feature:"Disegna la nuova geometria",action_confirm:"Conferma azione",double_click_delete:"Seleziona la geometria sulla mappa da cancellare",edit_feature_vertex:"Modifica o aggiungi un vertice alla geometria selezionata",move:"Muovi la geometria selezionata",select_feature_to_relation:"Seleziona la geometria che vuoi mettere in relazione",show_edit_feature_form:"Mostra il modulo per modificare gli attributi del'elemento",pick_feature:"Seleziona la geometria da modificare dalla mappa",insert_attributes_feature:"Inserisci gli attributi dell'elemento"}},workflow:{steps:{select:"Seleziona una geometria",draw_part:"Disegna il nuovo elemento da aggiungere alla geometria",draw_geometry:"Disegna la geometria",merge:"Seleziona la geometria su cui dissolvere",selectPoint:"Clicca sulla geometria per selezionarla",selectSHIFT:"Seleziona le geometrie tenedo premuto il tasto SHIFT",selectDrawBox:"Seleziona le geometrie disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectDrawBoxAtLeast2Feature:"Seleziona almeno 2 geometrie disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectPointSHIFT:"Seleziona le geometrie <br><sub><code>MAIUSC+DRAG</code> seleziona pi\xF9 elementi in un area</sub>",selectMultiPointSHIFT:"Seleziona le geometrie <br><sub><code>SHIFT+DRAG</code> seleziona pi\xF9 elementi in un area</sub>",selectMultiPointSHIFTAtLeast2Feature:"Seleziona almeno 2 geometrie <br><sub><code>SHIFT+DRAG</code> seleziona pi\xF9 elementi in un area</sub>",copyCTRL:"Copia le geometrie selezionate con CTRL+C",selectStartVertex:"Seleziona il vertice di partenza",selectToPaste:"Seleziona il punto dove verranno incollate le geometrie",draw_split_line:"Disegna una linea per dividere la geometria selezionata"},title:{steps:"Passi"},next:"Avanti"},messages:{featureslockbyotheruser:"Ci sono alcune geometrie/records non editabili perch\xE8 in modifica da altri utenti",featurelockbyotheruser:"La geometria/record non editabile perch\xE8 in modifica da altri utenti",splitted:"Feature(s) splittata(e)",nosplittedfeature:"La(e) feature(s) non \xE8 stata splittata",press_esc:"Premi ESC per tornare indietro",online:"Ora sei di nuovo ONLINE. Puoi slavare le modifiche in modo permanente",offline:"Sei OFFLINE. Tutte le modifiche saranno salvate temporaneamente in locale",delete_feature:"Vuoi eliminare l'elemento selezionato?",delete_feature_relations:"Cancellando una feature con relazioni associate, tale relazioni rimarranno orfane. Si consiglia di gestire tali relazioni prima di cancellare la feature",unlink_relation:"Vuoi staccare la relazione?",commit_feature:"Riepilogo modifiche",toolbox_has_no_geometry:"questo livello non ha geometria",toolbox_has_relation:"questo livello fa parte di una relazione",saved:"I dati sono stati salvati correttamente",saved_local:"I dati sono stati salvati correttamente in locale",loading_data:"Caricamento dati",saving:"Salvataggio dati in corso. Attendere ...",constraints:{enable_editing:`Ingrandisci per modificare 
Scala di attivazione 1:`},pdf:"Anteprima del documento non disponibile. Clicca qui ",commit:{header:"La lista sotto riporta tutte le modifiche che verranno salvate.",header_relation:"Relazione",header_add:"<b>Aggiunte</b> riporta il numero delle features aggiunte",header_update_delete:"<b>Modificate</b> e <b>Cancellate</b> riporta la lista degli id",add:"Aggiunte",delete:"Cancellate",update:"Aggiornate"},loading_table_data:"Costruzione tabella dati in corso. Attendere ...",copy_and_paste_from_other_layer_mandatory_fields:"Necessario compilare eventuali campi obbligatori sulle features incollate prima del salvataggio",no_feature_selected:"Nessuna feature selezionata",select_min_2_features:"Seleziona come minimo due features"},relation:{table:{info:"<div>Seleziona le relazioni per associarle alla feature in editing.</div>"},draw_new_feature:"Disegna nuova geometria",draw_or_copy:"oppure",copy_feature_from_other_layer:"Copia geometria da altro layer"},form:{relations:{tooltips:{back_to_father:"Torna ad editare il padre",add_relation:"Crea ed aggiungi nuova relazione",link_relation:"Associa una relazione esistente a questa feature",open_relation_tools:"Apri strumenti relatione",unlink_relation:"Annulla relazione"}},buttons:{save:"Inserisci/Modifica",save_table:"Modifica",save_and_back:"Salva e torna al padre",save_and_back_table:"Salva e torna indietro",cancel:"Ignora Modifiche"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Seleziona layer",edit_attributes:"Edita attributi delle features in multiple mode"},copyfeaturefromprojectlayer:{title:"Seleziona una feature"}}}};var js={close_editing_panel:{message:"\u26A0\uFE0F Confirm changes (\u2705) on each level to close"},disabled_editing:{message:"\u26A0\uFE0F Stop active editing tool"},errors:{no_layers:"An error occurs. It's no possible to edit layers",some_layers:"An error occurs: It's no possible to edit some layers",editing_multiple_relations:"Editing multiple relationships is not currently supported"},search:"Search",editing_changes:"Editing Changes",editing_data:"Editing Layers",editing_attributes:"Editing attributes",relations:"Relations",edit_relation:"Edit relation",back_to_relations:"Back to Relations",no_relations_found:"No relations found",relation_data:"Relation data",relation_already_added:"Relation already added",list_of_relations_feature:"List of relations feature ",tooltip:{edit_layer:"Edit Layer",filter_by_relation:"Filter layers by relation"},toolbox:{title:"Edit"},table:{edit:"Edit feature",copy:"Create a copy",delete:"Delete feature"},tools:{copy:"Copy features",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Add part to multipart",deletepart:"Delete part from multipart",merge:"Dissolve features",split:"Split Feature",add_feature:"Add feature",delete_feature:"Delete feature",move_feature:"Move feature",rotate_feature:"Rotate feature",update_vertex:"Update feature vertex",update_feature:"Update feature attribute",update_multi_features:"Update attributes of selected features",update_multi_features_relations:"Update attributes of all selected relations",update_multi_features_relations_from_parents:"Add/Edit relations records from one or mode parent features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Select features",select_element:"Select feature",copy:"Create new copy of selected features",merge:"Dissolve features",split:"Split Feature",new:"Create new feature",edit_table:"Edit table features",draw_new_feature:"Draw feature on map",action_confirm:"Confirm action",double_click_delete:"Select feature on map to delete",edit_feature_vertex:"Modify or add a vertex on selected feature",move:"Move selected feature",select_feature_to_relation:"Select feature that you bind relation",show_edit_feature_form:"Show feature form to edit attributes",pick_feature:"Select feature on map to modify",insert_attributes_feature:"Insert attributes of the feature"}},workflow:{steps:{select:"Click on feature to select",draw_part:"Draw new part",draw_geometry:"Draw geometry",merge:"Select featurewhere dissolve",selectSHIFT:"Select features drawing a rectangle pressing SHIFT",selectDrawBox:"Select features drawing a rectangle by two point of opposite corners",selectDrawBoxAtLeast2Feature:"Select at least features drawing a rectangle by two point of opposite corners",selectPoint:"Click on feature to select",selectPointSHIFT:"Select features drawing a rectangle pressing SHIFT (multifeatures) or click on one feature",selectMultiPointSHIFT:"Select features drawing a rectangle pressing SHIFT or click on feature",selectMultiPointSHIFTAtLeast2Feature:"Select at least 2 features drawing a rectangle pressing SHIFT or click on feature",copyCTRL:"Copy selected features using CTRL+C",selectStartVertex:"Select starting vertex of selected features",selectToPaste:"Select the point where paste the features selected",draw_split_line:"Draw a line to split selected feature"},title:{steps:"Steps"},next:"Next"},messages:{featureslockbyotheruser:"Some geometries/records are not editable because in editing by other user",featurelockbyotheruser:"The geometry/record is not editable because in editing by other user",splitted:"Splitted",nosplittedfeature:"Feature not spitted",press_esc:"Press ESC to back",online:"Back ONLINE. Now you can save your changes on database",offline:"You are OFFLINE. All changes are saved locally",delete_feature:"Do you want delete selected feature ?",delete_feature_relations:"If feature has bindings relations, these relations become orphans. We suggest to handle these relations before detele this feature",unlink_relation:"Do you want unlink relation?",commit_feature:"Summary of changes",toolbox_has_no_geometry:"this layer has no geometry",toolbox_has_relation:"this layer is part of a relation",saved:"Data saved successfully",saved_local:"Data saved locally successfully",loading_data:"Loading data",saving:"Saving data. Please wait ...",constraints:{enable_editing:`Please Zoom In to enable editing tools 
Activation scale at 1:`},pdf:"Document preview not available. Please click here ",commit:{header:"The following list show all changes to commit.",header_relation:"Relation",header_add:"<b>Added</b> show the number of features added",header_update_delete:"<b>Modified</b> and <b>Deleted</b> show the list of features id",add:"Added",delete:"Deleted",update:"Updated"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Select relations to link it to current editing feature.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Create and link new relation",link_relation:"Join a relation to this feature",open_relation_tools:"Show relation tools",unlink_relation:"Unlink relation"}},buttons:{save:"Insert/Edit",save_and_back:"Save and Back",save_and_back_table:"Save and Back",cancel:"Ignore Changes"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select layer",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}};var Us={close_editing_panel:{message:"\u26A0\uFE0F To close editing form need to exit from editing layer"},errors:{no_layers:"Tapahtui virhe. Tasoja ei ole mahdollista muokata.",some_layers:"Tapahtui virhe. Jotkin tasot eiv\xE4t ole muokattavissa."},search:"Haku",editing_changes:"Editing Changes",editing_data:"Muokataan tasoja",editing_attributes:"Muokataan attribuutteja",relations:"Relaatiot",edit_relation:"Muokkaa relaatiota",back_to_relations:"Takaisin relaatioihin",no_relations_found:"Relaatioita ei l\xF6ytynyt",relation_data:"Relaation tiedot",relation_already_added:"Relaatio on jo lis\xE4tty",list_of_relations_feature:"Lista relaation ominaisuuksista",tooltip:{edit_layer:"Muokkaa tasoa"},toolbox:{title:"Muokkaa"},table:{edit:"Muokkaa ominaisuutta",copy:"Luo kopio",delete:"Poista ominaisuus"},tools:{copy:"Kopio ominaisuuksia",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Lis\xE4\xE4 osa",deletepart:"Poista osa",merge:"Yhdist\xE4 ominaisuudet",split:"Leikkaa ominaisuus",add_feature:"Lis\xE4\xE4 ominaisuus",delete_feature:"Poista ominaisuus",move_feature:"Siirr\xE4 ominaisuutta",rotate_feature:"Kierr\xE4 ominaisuus",update_vertex:"P\xE4ivit\xE4 pisteen ominaisuutta",update_feature:"P\xE4ivit\xE4 ominaisuus",update_multi_features:"Muokkaa valittujen ominaisuuksien attribuutteja",update_multi_features_relations:"Update attributes of all selected relations",update_multi_features_relations_from_parents:"Add/Edit relations records from one or mode parent features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Valitse ominaisuudet",select_element:"Valitse ominaisuus",copy:"Luo kopio valituista ominaisuuksista",merge:"Yhdist\xE4 ominaisuudet",split:"Leikkaa ominaisuus",new:"Luo uusi ominaisuus",edit_table:"Muuta taulun ominaisuuksia",draw_new_feature:"Piirr\xE4 ominaisuus kartalle",action_confirm:"Hyv\xE4ksy toiminto",double_click_delete:"Valitse poistettava ominaisuus kartalta",edit_feature_vertex:"Muuta pistett\xE4 tai lis\xE4\xE4 piste valittuun ominaisuuteen",move:"Siirr\xE4 valittu ominaisuus",select_feature_to_relation:"Valitse relaatio",show_edit_feature_form:"N\xE4yt\xE4 ominaisuuslomake muokataksesi attribuutteja",pick_feature:"Valitse muokattava ominaisuus kartalta",insert_attributes_feature:"Lis\xE4\xE4 ominaisuuden attribuutit"}},workflow:{steps:{select:"Valitse ominaisuus",draw_part:"Piirr\xE4 uusi osa",merge:"Valitse ominaisuus yhdist\xE4\xE4ksesi",draw_geometry:"Piirr\xE4 geometria",selectSHIFT:"Paina SHIFT, jos haluat valita kohteita suorakulmiovalinnalla.",selectDrawBox:"Piirr\xE4 suorakulmio, jonka si\xE4lt\xE4 kohteet valitaan ",selectDrawBoxAtLeast2Feature:"Piirr\xE4 suorakulmio, jonka si\xE4lt\xE4 kohteet v\xE4hint\xE4\xE4n 2 valitaan ",selectPoint:"Valitse ominaisuus",selectPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksitt\xE4inen ominaisuus.",selectMultiPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksitt\xE4inen ominaisuus.",selectMultiPointSHIFTAtLeast2Feature:"Paina SHIFT, jos haluat valita v\xE4hint\xE4\xE4n 2 ominaisuuksia suorakulmiovalinnalla, tai valitse yksitt\xE4inen ominaisuus.",copyCTRL:"CTRL+C, voit kopioida valitut ominaisuudet.",selectStartVertex:"Osoita valittujen ominaisuuksien alkupiste.",selectToPaste:"Valitse kohta, johon liit\xE4t valitut ominaisuudet.",draw_split_line:"Piirr\xE4 viiva, jonka mukaan valittu ominaisuus jaetaan."},title:{steps:"Vaiheet"},next:"Seuraava"},messages:{featureslockbyotheruser:"Some geometries/records are not editable because in editing by other user",featurelockbyotheruser:"The geometry/record is not editable because in editing by other user",splitted:"Jaettu",nosplittedfeature:"Ominaisuutta ei jaettu",press_esc:"Paina ESC palataksesi",online:"Yhteys muodostettu. Muutokset voidaan tallentaa tietokantaan.",offline:"Olet offline-tilassa. Muutokset tallennetaan paikallisesti",delete_feature:"Haluatko poistaa valitun ominaisuuden?",delete_feature_relations:"Mik\xE4li ominaisuudella on sitovia relaatioita, n\xE4ist\xE4 relaatiosta tulee orpoja. Suosittelemme k\xE4sittelem\xE4\xE4n n\xE4m\xE4 relaatiot ennen poistamista",unlink_relation:"Haluatko poistaa relaation?",commit_feature:"Yhteenveto muutoksista",toolbox_has_relation:"t\xE4m\xE4 kerros on osa relaatiota",saved:"Tiedot tallennettu onnistuneesti",saved_local:"Tiedot on tallennettu onnistuneesti paikallisesti.",loading_data:"Ladataan tietoja",saving:"Tallentaan tietoja. Odota...",constraints:{enable_editing:`L\xE4henn\xE4 ottaaksesi muokkausty\xF6kalut k\xE4ytt\xF6\xF6n 
Aktivointi mittakaava 1:`},pdf:"Dokumentin esikatselu ei ole saatavilla. Paina t\xE4st\xE4 ",commit:{header:"Seuraava luettelo n\xE4ytt\xE4\xE4 kaikki muutokset.",header_relation:"Relation",header_add:"<b>Lis\xE4tty</b> n\xE4yt\xE4 lis\xE4ttyjen ominaisuuksien lukum\xE4\xE4r\xE4",header_update_delete:"<b>Muokattu</b> ja <b>Poistettu</b> N\xE4yt\xE4 list\xE4 ominaisuuksien id:st\xE4",add:"Lis\xE4tty",delete:"Poistettu",update:"Muokattu"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Valitse relaatiota linkitt\xE4\xE4ksesi ne muokattavaan ominaisuuteen.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Luo ja linkit\xE4 uusi relaatio",link_relation:"Liit\xE4 relaatio t\xE4h\xE4n ominaisuuteen",open_relation_tools:"N\xE4yt\xE4 relaatioty\xF6kalut",unlink_relation:"Poista relaatio"}},buttons:{save:"Lis\xE4\xE4/muokkaa",save_and_back:"Tallenna ja palaa",save_and_back_table:"Tallenna ja palaa",cancel:"Peruuta"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select layer",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}};var Ns={close_editing_panel:{message:"\u26A0\uFE0F To close editing form need to exit from editing layer"},errors:{no_layers:"Ett fel uppstod. Niv\xE5erna kan inte redigeras.",some_layers:"Ett fel uppstod. Vissa niv\xE5er kan inte redigeras."},search:"S\xF6kning",editing_changes:"Editing Changes",editing_data:"Niv\xE5erna redigeras",editing_attributes:"Attributen redigeras",relations:"Relationer",edit_relation:"Redigera relationen",back_to_relations:"Tillbaka till relationerna",no_relations_found:"Inga relationer hittades",relation_data:"Relationsuppgifter",relation_already_added:"Relationen har redan lagts till",list_of_relations_feature:"Lista p\xE5 relationens egenskaper",tooltip:{edit_layer:"Redigera niv\xE5n"},toolbox:{title:"Redigera"},table:{edit:"Redigera egenskap",copy:"Skapa en kopia",delete:"Ta bort egenskap"},tools:{copy:"Kopiera egenskaper",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"L\xE4gg till del",deletepart:"Ta bort del",merge:"Sl\xE5 samman egenskaper",split:"Dela upp egenskap",add_feature:"L\xE4gg till egenskap",delete_feature:"Ta bort egenskap",move_feature:"Flytta egenskap",rotate_feature:"Rotate feature",update_vertex:"Uppdatera punktens egenskap",update_feature:"Uppdatera egenskap",update_multi_features:"\xC4ndra attributen f\xF6r de valda funktionerna",update_multi_features_relations:"Update attributes of all selected relations",update_multi_features_relations_from_parents:"Add/Edit relations records from one or mode parent features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"V\xE4lj egenskaper",select_element:"V\xE4lj egenskapalitse ominaisuus",copy:"Skapa kopia av valda egenskaper",merge:"Sl\xE5 samman egenskaper",split:"Dela upp egenskap",new:"Skapa ny egenskap",edit_table:"\xC4ndra egenskaper i tabellen",draw_new_feature:"Piirr\xE4 ominaisuus kartalle",action_confirm:"Godk\xE4nn funktionen",double_click_delete:"V\xE4lj funktionen som du vill ta bort p\xE5 kartan",edit_feature_vertex:"\xC4ndra punkten eller l\xE4gg till punkten till den valda egenskapen",move:"Flytta den valda egenskapen",select_feature_to_relation:"V\xE4lj relation",show_edit_feature_form:"Visa egenskapsformul\xE4ret f\xF6r redigering av attribut",pick_feature:"V\xE4lj funktion p\xE5 kartan f\xF6r att \xE4ndras",insert_attributes_feature:"L\xE4gg till egenskapens attribut"}},workflow:{steps:{select:"V\xE4lj egenskap",draw_part:"Rita ny del",draw_geometry:"Rita geometri",merge:"V\xE4lj egenskap att sl\xE5 samman",selectSHIFT:"Tryck SHIFT, om du vill v\xE4lja objekt med hj\xE4lp av rektangel.",selectDrawBox:"Rita upp den rektangel inom vilken objekten v\xE4ljs ",selectDrawBoxAtLeast2Feature:"Rita rektangeln inom vilken minst tv\xE5 objekt \xE4r markerade ",selectPoint:"V\xE4lj egenskap",selectPointSHIFT:"Tryck SHIFT, om du vill v\xE4lja objekt med hj\xE4lp av rektangel, eller v\xE4lj en enskild egenskap.",selectMultiPointSHIFT:"Tryck SHIFT, om du vill v\xE4lja objekt med hj\xE4lp av rektangel, eller v\xE4lj en enskild egenskap.",selectMultiPointSHIFTAtLeast2Feature:"Tryck p\xE5 SKIFT f\xF6r att v\xE4lja minst tv\xE5 objekt med en rektangel eller v\xE4lj en enda egenskap. ",copyCTRL:"CTRL+C, du kan kopiera valda egenskaper.",selectStartVertex:"Visa startpunkten f\xF6r valda egenskaper.",selectToPaste:"V\xE4lj punkt till vilken de valda egenskaperna ska fogas.",draw_split_line:"Rita en linje enligt vilken den valda egenskapen ska uppdelas."},title:{steps:"Skeden"},next:"N\xE4sta"},messages:{featureslockbyotheruser:"Jotkut geometriat/tietueet eiv\xE4t ole muokattavissa, koska muut k\xE4ytt\xE4j\xE4t muokkaavat niit\xE4",featurelockbyotheruser:"Geometriaa/tietuetta ei voi muokata, koska muut k\xE4ytt\xE4j\xE4t muokkaavat sit\xE4 parhaillaan",splitted:"Uppdelad",nosplittedfeature:"Egenskapen har inte delats upp",press_esc:"Tryck ESC f\xF6r att g\xE5 tillbaka",online:"F\xF6rbindelsen har uppr\xE4ttats. \xC4ndringar kan sparas i databasen.",offline:"Du \xE4r i offline-l\xE4ge. \xC4ndringarna sparas lokalt",delete_feature:"Vill du ta bort den valda egenskapen?",delete_feature_relations:"Om egenskapen saknar bindande relationer blir dessa relationer f\xF6r\xE4ldral\xF6sa. Vi rekommenderar att du behandlar dessa relationer innan du l\xE4mnar programmet",unlink_relation:"Vill du ta bort relationen?",commit_feature:"Sammanfattning av \xE4ndringar",toolbox_has_relation:"detta lager \xE4r en del av en relation",saved:"Uppgifterna sparades",saved_local:"Uppgifterna sparades lokalt.",loading_data:"Uppgifterna laddas",saving:"Uppgifterna sparas. V\xE4nta...",constraints:{enable_editing:`Zooma in f\xF6r att b\xF6rja anv\xE4nda redigeringsverktyg 
Aktivering skala 1:`},pdf:"F\xF6rhandsgranskning av dokument \xE4r inte tillg\xE4nglig. Tryck h\xE4r",commit:{header:"F\xF6ljande lista visar alla \xE4ndringar.",header_relation:"Relation",header_add:"<b>Tillagda</b> visar antalet egenskaper som lagts till",header_update_delete:"<b>Redigerad</b> och <b>Borttagen</b> Visa en lista p\xE5 egenskapernas id",add:"har lagts till",delete:"Borttagen",update:"Redigerad"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>V\xE4lj relation f\xF6r l\xE4nkning till egenskap som ska redigeras.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Skapa och l\xE4nka ny relation",link_relation:"Foga relationen till denna egenskap",open_relation_tools:"Visa relationsverktyg",unlink_relation:"Ta bort relation"}},buttons:{save:"Infoga/Redigera",save_and_back:"Spara och g\xE5 tillbaka",save_and_back_table:"Spara och g\xE5 tillbaka",cancel:"Ignorera \xE4ndringar"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select layer",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}};var Vs={close_editing_panel:{message:"\u26A0\uFE0F To close editing form need to exit from editing layer"},errors:{no_layers:"Une erreur s'est produite lors du chargement des layers dans l'\xE9dition.",some_layers:"Une erreur s'est produite lors du chargement de certaines layers dans l'\xE9dition."},search:"Recherche",editing_changes:"Editing Changes",editing_data:"Modifier les donnes",editing_attributes:"Modifier les attributs",relations:"Relations",edit_relation:"Modifier la relation",back_to_relations:"Retour aux relations",no_relations_found:"Il n'y a pas de relations",relation_data:"Donn\xE9es sur les relations",relation_already_added:"Relation d\xE9j\xE0 pr\xE9sente",list_of_relations_feature:"Lister les relations de la fonctionnalit\xE9",tooltip:{edit_layer:"Modifier le layer"},toolbox:{title:"Modifier"},table:{edit:"Modifier fonctionnalit\xE9s",copy:"Cr\xE9er une copie",delete:"Supprimer la fonctionnalit\xE9"},tools:{copy:"Copier les fonctionnalit\xE9s",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Ajouter une pi\xE8ce \xE0 la g\xE9om\xE9trie",deletepart:"Supprimer la partie de la g\xE9om\xE9trie",merge:"Dissoudre les fonctionnalit\xE9s",split:"Couper la fonctionnalit\xE9",add_feature:"Ajouter une fonctionnalit\xE9",delete_feature:"Supprimer la fonctionnalit\xE9",move_feature:"D\xE9placez la fonctionnalit\xE9",rotate_feature:"Fonction de rotation",update_vertex:"Mettre \xE0 jour les sommets des fonctionnalit\xE9s",update_feature:"Modifier les attributs des fonctionnalit\xE9s",update_multi_features:"Modifier les attributs des fonctionnalit\xE9s s\xE9lectionn\xE9es",update_multi_features_relations:"Update attributes of all selected relations",update_multi_features_relations_from_parents:"Ajouter/Modifier les enregistrements de relation \xE0 partir d'une ou plusieurs entit\xE9s parents",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"S\xE9lectionner les fonctionnalit\xE9s",select_element:"S\xE9lectionner une fonctionnalit\xE9",copy:"Cr\xE9er une copie des fonctionnalit\xE9s s\xE9lectionn\xE9es",merge:"Dissoudre les fonctionnalit\xE9s",split:"Couper la fonctionnalit\xE9",new:"Cr\xE9er une nouvelle fonctionnalit\xE9",edit_table:"Modifier les fonctionnalit\xE9s de la table",draw_new_feature:"Dessiner une fonctionnalit\xE9 sur la carte",action_confirm:"Confirmer l'action",double_click_delete:"S\xE9lectionner la fonctionnalit\xE9 sur la carte \xE0 supprimer",edit_feature_vertex:"Modifier ou ajouter un sommet \xE0 la fonctionnalit\xE9 s\xE9lectionn\xE9e",move:"D\xE9placer la fonctionnalit\xE9 s\xE9lectionn\xE9e",select_feature_to_relation:"S\xE9lectionner la fonctionnalit\xE9 que vous souhaitez mettre en relation",show_edit_feature_form:"Afficher le formulaire de la fonctionnalit\xE9 permettant de modifier les attributs",pick_feature:"S\xE9lectionner l'\xE9l\xE9ment de la carte \xE0 modifier",insert_attributes_feature:"Ins\xE9rer les attributs de la fonctionnalit\xE9"}},workflow:{steps:{select:"Cliquer sur la fonctionnalit\xE9 \xE0 s\xE9lectionner",draw_part:"Dessiner la nouvelle partie",draw_geometry:"Dessiner la g\xE9om\xE9trie",merge:"S\xE9lectionner la fonction \xE0 introduire en fondu",selectPoint:"Cliquer sur la fonctionnalit\xE9 pour la s\xE9lectionner",selectSHIFT:"S\xE9lectionner des fonctionnalit\xE9s en maintenant la touche SHIFT enfonc\xE9e",selectDrawBox:"S\xE9lectionner les fonctionnalit\xE9s en dessinant un rectangle par la cr\xE9ation des deux points de la diagonale",selectDrawBoxAtLeast2Feature:"S\xE9lectionner au moins 2 fonctionnalit\xE9s en dessinant un rectangle par la cr\xE9ation des deux points de la diagonale",selectPointSHIFT:"S\xE9lectionner des caract\xE9ristiques en maintenant la touche SHIFT enfonc\xE9e (multi-s\xE9lection) ou en cliquant sur une seule caract\xE9ristique",selectMultiPointSHIFT:"S\xE9lectionner des fonctionnalit\xE9s en maintenant la touche SHIFT appuy\xE9e ou en cliquant sur la fonctionnalit\xE9 individuelle",selectMultiPointSHIFTAtLeast2Feature:"S\xE9lectionner au moins 2 fonctionnalit\xE9s en maintenant la touche SHIFT appuy\xE9e ou en cliquant sur la fonctionnalit\xE9 individuelle",copyCTRL:"Copier les fonctionnalit\xE9s s\xE9lectionn\xE9es avec CTRL+C",selectStartVertex:"S\xE9lectionner le sommet de d\xE9part des fonctionnalit\xE9s choisies",selectToPaste:"S\xE9lectionner le point o\xF9 les fonctionnalit\xE9s s\xE9lectionn\xE9es seront coll\xE9es",draw_split_line:"Tracez une ligne pour couper la fonctionnalit\xE9 s\xE9lectionn\xE9e"},title:{steps:"\xC9tapes"},next:"Suivant"},messages:{featureslockbyotheruser:"Certaines g\xE9om\xE9tries/enregistrements ne sont pas modifiables car ils ont \xE9t\xE9 modifi\xE9s par un autre utilisateur",featurelockbyotheruser:"La g\xE9om\xE9trie/l'enregistrement n'est pas modifiable car il a \xE9t\xE9 modifi\xE9 par un autre utilisateur",splitted:"Fonctionnalit\xE9(s) divis\xE9(es)",nosplittedfeature:"La (les) fonctionnalit\xE9(s) n\u2019a (n'ont) pas \xE9t\xE9 divis\xE9(es)",press_esc:"Appuyez sur ESC pour revenir",online:"Vous \xEAtes \xE0 nouveau EN LIGNE. Vous pouvez enregistrer les modifications de fa\xE7on permanente",offline:"Vous \xEAtes HORS LIGNE. Toutes les modifications seront enregistr\xE9es temporairement en local",delete_feature:"Voulez-vous supprimer la fonctionnalit\xE9 s\xE9lectionn\xE9e ?",delete_feature_relations:"La suppression d'une fonctionnalit\xE9 avec des relations associ\xE9es laissera ces relations orphelines. Il est recommand\xE9 de g\xE9rer ces relations avant de supprimer la fonctionnalit\xE9",unlink_relation:"Voulez-vous d\xE9tacher la relation ?",commit_feature:"Sommaire des changements",toolbox_has_relation:"cette couche fait partie d'une relation",saved:"Les donn\xE9es ont \xE9t\xE9 enregistr\xE9es correctement",saved_local:"Les donn\xE9es ont \xE9t\xE9 correctement sauvegard\xE9es localement",loading_data:"Chargement des donn\xE9es",saving:"Sauvegarde des donn\xE9es. Veuillez patienter ...",constraints:{enable_editing:`Augmenter le niveau de zoom pour permettre l'\xE9dition 
Echelle de d\xE9clenchement 1 :`},pdf:"Aper\xE7u du document non disponible. Cliquez ici ",commit:{header:"La liste ci-dessous montre toutes les modifications qui seront enregistr\xE9es.",header_relation:"Relation",header_add:"<b>Ajouts</b> indique le nombre de fonctionnalit\xE9s ajout\xE9es",header_update_delete:"<b>Modifi\xE9</b> e <b>Supprim\xE9</b> liste les ids",add:"Ajout\xE9",delete:"Supprim\xE9",update:"Modifi\xE9"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"Avant d'enregistrer, il est n\xE9cessaire de remplir tous les champs obligatoires du features saisi",no_feature_selected:"Aucune feature s\xE9lectionn\xE9e",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>S\xE9lectionner les relations pour les associer \xE0 l'\xE9l\xE9ment en cours d'\xE9dition.</div>"},draw_new_feature:"Dessiner une nouvelle feature",draw_or_copy:"ou",copy_feature_from_other_layer:"Copier feature d'une autre layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Cr\xE9er et ajouter une nouvelle relation",link_relation:"Associer une relation existante \xE0 cette fonctionnalit\xE9",open_relation_tools:"Outils de relation ouverte",unlink_relation:"Annuler la relation"}},buttons:{save:"Ins\xE9rer/Modifier",save_and_back:"Sauvegarder et retourner au parent",save_and_back_table:"Sauvegarder et et revenir en arri\xE8re",cancel:"Ignorer modifications"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select layer",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}};var $s={close_editing_panel:{message:"\u26A0\uFE0F To close editing form need to exit from editing layer"},errors:{no_layers:"Es tritt ein Fehler auf. Es ist nicht m\xF6glich, Layer zu bearbeiten",some_layers:"Es tritt ein Fehler auf: Es ist nicht m\xF6glich, einige Layer zu bearbeiten"},search:"Suche",editing_changes:"\xC4nderungen bearbeiten",editing_data:"Layer bearbeiten",editing_attributes:"Attribute bearbeiten",relations:"Relationen",edit_relation:"Relation bearbeiten",back_to_relations:"Zur\xFCck zu Relationen",no_relations_found:"Keine Relationen gefunden",relation_data:"Relationsdaten",relation_already_added:"Relation bereits hinzugef\xFCgt",list_of_relations_feature:"Liste der Relations-Features ",tooltip:{edit_layer:"Layer bearbeiten"},toolbox:{title:"bearbeiten"},table:{edit:"Feature bearbeiten",copy:"Kopie erstellen",delete:"Feature l\xF6schen"},tools:{copy:"Features kopieren",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Teil zu Multipart hinzuf\xFCgen",deletepart:"Teil aus Multipart l\xF6schen",merge:"Feature aufl\xF6sen",split:"Feature trennen",add_feature:"Feature hinzuf\xFCgen",delete_feature:"Feature l\xF6schen",move_feature:"Feature verschieben",rotate_feature:"Feature verschieben",update_vertex:"Feature vertex aktualisieren",update_feature:"Feature-Attribut aktualisieren",update_multi_features:"Attribute ausgew\xE4hlter Features aktualisieren",update_multi_features_relations:"Update attributes of all selected relations",update_multi_features_relations_from_parents:"Hinzuf\xFCgen/Bearbeiten Sie Beziehungsdatens\xE4tze von einem oder mehreren \xFCbergeordneten features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Messung anzeigen",snap:"Snap Layer",snapall:"Snap auf alle Layer"},steps:{help:{select_elements:"Features ausw\xE4hlen",select_element:"Feature ausw\xE4hlen",copy:"Neue Kopie der ausgew\xE4hlten Features erstellen",merge:"Features aufl\xF6sen",split:"Feature trennen",new:"Neues Feature erstellen",edit_table:"Features der Tabelle bearbeiten",draw_new_feature:"Feature auf Karte zeichnen",action_confirm:"Aktion best\xE4tigen",double_click_delete:"Zu l\xF6schendes Feature auf der Karte ausw\xE4hlen",edit_feature_vertex:"\xC4ndern oder Hinzuf\xFCgen eines Eckpunktes auf dem ausgew\xE4hlten Feature",move:"Ausgew\xE4hltes Feature verschieben",select_feature_to_relation:"Feature ausw\xE4hlen, welches die Relation verkn\xFCpft",show_edit_feature_form:"Feature-Formular zum Bearbeiten von Attributen anzeigen",pick_feature:"Zu \xE4nderndes Feature auf der Karte ausw\xE4hlen",insert_attributes_feature:"Attribute des Features einf\xFCgen"}},workflow:{steps:{select:"Zum Ausw\xE4hlen auf ein Feature klicken",draw_part:"Neues Teil zeichnen",draw_geometry:"Geometrie zeichnen",merge:"Feature zum Aufl\xF6sen ausw\xE4hlen",selectSHIFT:"Features ausw\xE4hlen indem ein Rechteck mit SHIFT gezeichnet wird",selectDrawBox:"Features ausw\xE4hlen, indem man ein Rechteck mit zwei gegen\xFCberliegenden Eckpunkten zeichnet",selectDrawBoxAtLeast2Feature:"Mindestens Features ausw\xE4hlen, indem man ein Rechteck mit zwei gegen\xFCberliegenden Eckpunkten zeichnet",selectPoint:"Zum Ausw\xE4hlen auf ein Feature klicken",selectPointSHIFT:"Features ausw\xE4hlen, indem ein Rechteck mit SHIFT gezeichnet wird (Multifeatures) oder auf ein Feature klicken",selectMultiPointSHIFT:"Features ausw\xE4hlen, indem man ein Rechteck zeichnet und SHIFT dr\xFCckt oder auf ein Feature klickt",selectMultiPointSHIFTAtLeast2Feature:"Mindestens 2 Features ausw\xE4hlen und mit SHIFT ein Rechteck zeichnen oder auf ein Feature klicken",copyCTRL:"Kopieren ausgew\xE4hlter Features mit CTRL+C",selectStartVertex:"Start-Eckpunkt der ausgew\xE4hlten Features ausw\xE4hlen",selectToPaste:"Den Punkt ausw\xE4hlen, an dem die ausgew\xE4hlten Features eingef\xFCgt werden sollen",draw_split_line:"Eine Linie zeichnen, um das ausgew\xE4hlte Feature zu teilen"},title:{steps:"Schritte"},next:"Weiter"},messages:{featureslockbyotheruser:"Einige Geometrien/Datens\xE4tze k\xF6nnen nicht bearbeitet werden, da sie von anderen Benutzern bearbeitet werden",featurelockbyotheruser:"Die Geometrie/der Datensatz kann nicht bearbeitet werden, da er von anderen Benutzern bearbeitet wird",splitted:"Getrennt",nosplittedfeature:"Feature nicht getrennt",press_esc:"Mit ESC zur\xFCck",online:"Wieder ONLINE. Jetzt kann man die \xC4nderungen in der Datenbank speichern",offline:"OFFLINE. Alle \xC4nderungen werden lokal gespeichert",delete_feature:"Soll das ausgew\xE4hlte Feature gel\xF6scht werden?",delete_feature_relations:"Wenn ein Feature Verkn\xFCpfungen beinhaltet, werden diese Relationen verwaist. Wir schlagen vor, diese Relationen zu behandeln, bevor das Feature gel\xF6scht wird",unlink_relation:"Soll die Verkn\xFCpfung aufgehoben werden?",commit_feature:"Zusammenfassung der \xC4nderungen",toolbox_has_relation:"Diese Ebene ist Teil einer Beziehung",saved:"Daten erfolgreich gespeichert",saved_local:"Daten erfolgreich lokal gespeichert",loading_data:"Daten laden",saving:"Daten werden gespeichert. Bitte warten ...",constraints:{enable_editing:`Bitte zoomen Sie hinein, um die Editier-Tools zu aktivieren 
Aktivierungsskala bei 1:`},pdf:"Dokumentenvorschau nicht verf\xFCgbar. Bitte hier klicken ",commit:{header:"Die folgende Liste zeigt alle zu \xFCbernehmenden \xC4nderungen.",header_relation:"Relation",header_add:"<b>Hinzufgef\xFCgt</b> Die Anzahl der hinzugef\xFCgten Features anzeigen",header_update_delete:"<b>Bearbeitet</b> und <b>Gel\xF6scht</b> Die Liste der Feature-ID anzeigen",add:"Hinzugef\xFCgt",delete:"Gel\xF6scht",update:"Bearbeitet"},loading_table_data:"Datentabelle wird erstellt. Bitte warten ...",copy_and_paste_from_other_layer_mandatory_fields:"Vor dem Speichern m\xFCssen alle Pflichtfelder des eingegebenen features ausgef\xFCllt werden",no_feature_selected:"Keine feature ausgew\xE4hlt",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>W\xE4hlen Sie Relationen aus, um sie mit dem aktuellen Feature zu verkn\xFCpfen.</div>"},draw_new_feature:"Zeichnen Sie eine neue feature",draw_or_copy:"oder",copy_feature_from_other_layer:"Kopieren Sie feature aus einer anderen layer"},form:{relations:{tooltips:{back_to_father:"Zur\xFCck zur Bearbeitung des Vaters",add_relation:"Neue Relation erstellen und verkn\xFCpfen",link_relation:"Eine Relation zu diesem Feature herstellen",open_relation_tools:"Relationstools anzeigen",unlink_relation:"Relation trennen"}},buttons:{save:"Einf\xFCgung/Bearbeiten",save_and_back:"Speichern und zur\xFCck",save_and_back_table:"Speichern und zur\xFCck",cancel:"\xC4nderungen ignorieren"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select layer",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select one feature"}}}};var zs={close_editing_panel:{message:"\u26A0\uFE0F To close editing form need to exit from editing layer"},errors:{no_layers:"Avem o eroare. Straturile nu sunt editabile",some_layers:"Avem o eroare: Anumite straturi nu se pot edita"},search:"Caut\u0103",editing_changes:"Modificare schimb\u0103ri",editing_data:"Modificare straturi",editing_attributes:"Modificare atribute",relations:"Rela\u021Bii",edit_relation:"Modific\u0103 rela\u021Bia",back_to_relations:"\xCEnapoi la Rela\u021Bii",no_relations_found:"Nu am g\u0103sit rela\u021Bii",relation_data:"Date rela\u021Bii",relation_already_added:"Rela\u021Bie ad\u0103ugat\u0103 deja",list_of_relations_feature:"Lista rela\u021Bii entitatea ",tooltip:{edit_layer:"Modific\u0103 strat"},toolbox:{title:"Modific\u0103"},table:{edit:"Modific\u0103 entitate",copy:"Creeaz\u0103 o copie",delete:"Elimin\u0103 entitatea"},tools:{copy:"Copiaz\u0103 entit\u0103\u021Bile",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Adaug\u0103 o parte la multiparte",deletepart:"Elimin\u0103 partea din multiparte",merge:"Dizolvare entit\u0103\u021Bi",split:"Divizare Entitate",add_feature:"Adaug\u0103 entitate",delete_feature:"Eliminare entitate",move_feature:"Mut\u0103 entitate",rotate_feature:"Rotire entitate",update_vertex:"Actualizeaz\u0103 vertec\u0219ii entit\u0103\u021Bii",update_feature:"Actualizeaz\u0103 atributul entit\u0103\u021Bii",update_multi_features:"Actualizeaz\u0103 atributele entit\u0103\u021Bilor selectate",update_multi_features_relations:"Update attributes of all selected relations",update_multi_features_relations_from_parents:"Adaug\u0103/Edita\u021Bi \xEEnregistr\u0103rile rela\u021Biilor de la una sau mai multe caracteristici p\u0103rinte",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Arat\u0103 m\u0103sur\u0103torile",snap:"Acro\u0219are strat",snapall:"Acro\u0219are pe toate straturile"},steps:{help:{select_elements:"Selecteaz\u0103 entit\u0103\u021Bi",select_element:"Selecteaz\u0103 entitate",copy:"Creeaz\u0103 o nou\u0103 copie a entit\u0103\u021Bilor selectate",merge:"Dizolv\u0103 entit\u0103\u021Bile",split:"Divizare Entitate",new:"Creeaz\u0103 o entitate",edit_table:"Modific\u0103 entit\u0103\u021Bile tabelare",draw_new_feature:"Deseneaz\u0103 entitate pe hart\u0103",action_confirm:"Confirm\u0103 ac\u021Biunea",double_click_delete:"Selecteaz\u0103 entitatea de eliminat din hart\u0103",edit_feature_vertex:"Modific\u0103 sau adaug\u0103 un vertex la entitatea selectat\u0103",move:"Mut\u0103 entitatea selectat\u0103",select_feature_to_relation:"Selecteaz\u0103 entitate pentru rela\u021Bionare",show_edit_feature_form:"Arat\u0103 formularul entit\u0103\u021Bii pentru modific\u0103ri",pick_feature:"Selecteaz\u0103 entit\u0103\u021Bile de modificat din hart\u0103",insert_attributes_feature:"Insereaz\u0103 atributele entit\u0103\u021Bii"}},workflow:{steps:{select:"Click pe entitate pentru a o selecta",draw_part:"Deseneaz\u0103 o parte nou\u0103",draw_geometry:"Desena\u021Bi geometria",merge:"Selecteaz\u0103 partea de dizolvat",selectSHIFT:"Selecteaz\u0103 entit\u0103\u021Bi prin desen triunghi ap\u0103s\xE2nd SHIFT",selectDrawBox:"Selecteaz\u0103 entit\u0103\u021Bi desen\xE2nd un dreptunghi prin dou\u0103 puncte opuse",selectDrawBoxAtLeast2Feature:"Selecteaz\u0103 cel pu\u021Bin 2 entit\u0103\u021Bi prin desenul unui dreptunghi",selectPoint:"Click pe entitate pentru selectare",selectPointSHIFT:"Selecteaz\u0103 entit\u0103\u021Bi prin desen dreptunghi ap\u0103s\xE2nd SHIFT (multientit\u0103\u021Bi) sau prin click pe entitate",selectMultiPointSHIFT:"Selecteaz\u0103 entit\u0103\u021Bi prin desen dreptunghi ap\u0103s\xE2nd SHIFT sau prin click pe entitate",selectMultiPointSHIFTAtLeast2Feature:"Selecteaz\u0103 cel pu\u021Bin 2 entit\u0103\u021Bi prin desen dreptunghi ap\u0103s\xE2nd SHIFT sau prin click pe entitate",copyCTRL:"Copiaz\u0103 entit\u0103\u021Bile selectate folosint CTRL+C",selectStartVertex:"Selecteaz\u0103 vertexul de start a entit\u0103\u021Bilor selectate",selectToPaste:"Selecteaz\u0103 punctul unde s\u0103 lipim entit\u0103\u021Bile selectate",draw_split_line:"Deseneaz\u0103 o linie pentru a diviza entitatea selectat\u0103"},title:{steps:"Pa\u0219i"},next:"Urm\u0103torul"},messages:{featureslockbyotheruser:"Unele geometrii/\xEEnregistr\u0103ri nu sunt editabile deoarece sunt editate de c\u0103tre alt utilizator",featurelockbyotheruser:"Geometria/\xEEnregistrarea nu este editabil\u0103 deoarece este editat\u0103 de un alt utilizator",splitted:"Divizat",nosplittedfeature:"Entitate nedivizat\u0103",press_esc:"ESC pentru \xEEnapoi",online:"\xCEnapoi ONLINE. Acum se pot salva schimb\u0103rile",offline:"OFFLINE. Schimb\u0103rile sunt salvate local",delete_feature:"\u0218terg entitatea selectat\u0103?",delete_feature_relations:"Dac\u0103 entitatea are rela\u021Bii care trimit la ea, acele rela\u021Bii devin orfane. Suger\u0103m s\u0103 v\u0103 ocupa\u021Bi de acele elemente \xEEnainte s\u0103 elimina\u021Bi aceast\u0103 entitate.",unlink_relation:"Dore\u0219ti s\u0103 elimina\u021Bi leg\u0103tura cu rela\u021Bia?",commit_feature:"Rezumatul modific\u0103rilor",toolbox_has_relation:"acest strat face parte dintr-o rela\u021Bie",saved:"Datele sunt salvate",saved_local:"Datele s-au salvat local",loading_data:"Datele se \xEEncarc\u0103.",saving:"Salv\u0103m datele. A\u0219tepta\u021Bi ...",constraints:{enable_editing:`Pentru a activa Modificare face\u021Bi zoom la 
Scara de activare 1:`},pdf:"Previzualizarea documentului nu este disponibil\u0103. Click aici ",commit:{header:"Lista cu toate modific\u0103rile.",header_relation:"Relation",header_add:"<b>Ad\u0103ugate</b> arat\u0103 nr. de entit\u0103\u021Bi ad\u0103ugate",header_update_delete:"<b>Modificate</b> \u0219i <b>\u0218terse</b> arat\u0103 lista de id-uri de entit\u0103\u021Bi",add:"Ad\u0103ugate",delete:"Eliminate",update:"Modificate"},loading_table_data:"\xCEnc\u0103rc\u0103m tabelul de date ...",copy_and_paste_from_other_layer_mandatory_fields:"\xCEnainte de a salva, este necesar s\u0103 completa\u021Bi toate c\xE2mpurile obligatorii ale entit\u0103\u021Bi introduse",no_feature_selected:"Nicio feature selectat\u0103",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Selecteaz\u0103 rela\u021Biile pentru a face leg\u0103tura cu entitatea curent\u0103.</div>"},draw_new_feature:"Desena\u021Bi o nou\u0103 feature",draw_or_copy:"sau",copy_feature_from_other_layer:"Copia\u021Bi feature dintr-un alt layer"},form:{relations:{tooltips:{back_to_father:"\xCEnapoi la modific\u0103rile entit\u0103\u021Bii p\u0103rinte",add_relation:"Creeaz\u0103 \u0219i f\u0103 leg\u0103tura unei rela\u021Bii noi",link_relation:"Leag\u0103 o rela\u021Bie de entitate",open_relation_tools:"Arat\u0103 instrumentele pentru rela\u021Bii",unlink_relation:"Elimin\u0103 leg\u0103tura la rela\u021Bie"}},buttons:{save:"Insera\u021Bi/Edita\u021Bi",save_and_back:"Salveaz\u0103 \u0219i d\u0103 \xEEnapoi",save_and_back_table:"Salveaz\u0103 \u0219i d\u0103 \xEEnapoi",cancel:"Ignora\u021Bi modific\u0103rile"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select layer",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}};var Gs={errors:{no_layers:"An error occurs. It's no possible to edit layers",some_layers:"An error occurs: It's no possible to edit some layers"},search:"Search",editing_changes:"Editing Changes",editing_data:"Editing Layers",editing_attributes:"Editing attributes",relations:"Relations",edit_relation:"Edit relation",back_to_relations:"Back to Relations",no_relations_found:"No relations found",relation_data:"Relation data",relation_already_added:"Relation already added",list_of_relations_feature:"List of relations feature ",tooltip:{edit_layer:"Edit Layer"},toolbox:{title:"Edit"},table:{edit:"Edit feature",copy:"Create a copy",delete:"Delete feature"},tools:{copy:"Copy features",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Add part to multipart",deletepart:"Delete part from multipart",merge:"Dissolve features",split:"Split Feature",add_feature:"Add feature",delete_feature:"Delete feature",move_feature:"Move feature",rotate_feature:"Rotate feature",update_vertex:"Update feature vertex",update_feature:"Update feature attribute",update_multi_features:"Update attributes of selected features",update_multi_features_relations:"Update attributes of all selected relations",update_multi_features_relations_from_parents:"Add/Edit relations records from one or mode parent features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Select features",select_element:"Select feature",copy:"Create new copy of selected features",merge:"Dissolve features",split:"Split Feature",new:"Create new feature",edit_table:"Edit table features",draw_new_feature:"Draw feature on map",action_confirm:"Confirm action",double_click_delete:"Select feature on map to delete",edit_feature_vertex:"Modify or add a vertex on selected feature",move:"Move selected feature",select_feature_to_relation:"Select feature that you bind relation",show_edit_feature_form:"Show feature form to edit attributes",pick_feature:"Select feature on map to modify",insert_attributes_feature:"Insert attributes of the feature"}},workflow:{steps:{select:"Click on feature to select",draw_part:"Draw new part",merge:"Select featurewhere dissolve",selectSHIFT:"Select features drawing a rectangle pressing SHIFT",selectDrawBox:"Select features drawing a rectangle by two point of opposite corners",selectDrawBoxAtLeast2Feature:"Select at least features drawing a rectangle by two point of opposite corners",selectPoint:"Click on feature to select",selectPointSHIFT:"Select features drawing a rectangle pressing SHIFT (multifeatures) or click on one feature",selectMultiPointSHIFT:"Select features drawing a rectangle pressing SHIFT or click on feature",selectMultiPointSHIFTAtLeast2Feature:"Select at least 2 features drawing a rectangle pressing SHIFT or click on feature",copyCTRL:"Copy selected features using CTRL+C",selectStartVertex:"Select starting vertex of selected features",selectToPaste:"Select the point where paste the features selected",draw_split_line:"Draw a line to split selected feature"},title:{steps:"Steps"},next:"Next"},messages:{featureslockbyotheruser:"Some geometries/records are not editable because in editing by other user",featurelockbyotheruser:"The geometry/record is not editable because in editing by other user",splitted:"Splitted",nosplittedfeature:"Feature not spitted",press_esc:"Press ESC to back",online:"Back ONLINE. Now you can save your changes on database",offline:"You are OFFLINE. All changes are saved locally",delete_feature:"Do you want delete selected feature ?",delete_feature_relations:"If feature has bindings relations, these relations become orphans. We suggest to handle these relations before detele this feature",unlink_relation:"Do you want unlink relation?",commit_feature:"Do you want to save the changes",toolbox_has_relation:"this layer is part of a relation",saved:"Data saved successfully",saved_local:"Data saved locally successfully",loading_data:"Loading data",saving:"Saving data. Please wait ...",constraints:{enable_editing:`Please Zoom In to enable editing tools 
Activation scale at 1:`},pdf:"Document preview not available. Please click here ",commit:{header:"The following list show all changes to commit.",header_add:"<b>Added</b> show the number of features added",header_update_delete:"<b>Modified</b> and <b>Deleted</b> show the list of features id",add:"Added(n. features)",delete:"Deleted(id)",update:"Modified(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Select relations to link it to current editing feature.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Create and link new relation",link_relation:"Join a relation to this feature",open_relation_tools:"Show relation tools",unlink_relation:"Unlink relation"}},buttons:{save:"Insert/Edit",save_and_back:"Save and Back",save_and_back_table:"Save and Back",cancel:"Ignore Changes"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select layer",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}};var Hs={close_editing_panel:{message:"\u0417\u0430\u043A\u0456\u043D\u0447\u0456\u0442\u044C \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0448\u0430\u0440\u0443 \u0449\u043E\u0431 \u0437\u0430\u043A\u0440\u0438\u0442\u0438 \u0432\u0456\u043A\u043D\u043E \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F"},errors:{no_layers:"\u041F\u043E\u043C\u0438\u043B\u043A\u0430. \u041D\u0435\u043C\u043E\u0436\u043B\u0438\u0432\u043E \u043F\u043E\u0447\u0430\u0442\u0438 \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0448\u0430\u0440\u0456\u0432",some_layers:"\u041F\u043E\u043C\u0438\u043B\u043A\u0430: \u041D\u0435\u043C\u043E\u0436\u043B\u0438\u0432\u043E \u043F\u043E\u0447\u0430\u0442\u0438 \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0448\u0430\u0440\u0456\u0432",editing_multiple_relations:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0434\u0435\u043A\u0456\u043B\u044C\u043A\u043E\u0445 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u044C \u043E\u0434\u043D\u043E\u0447\u0430\u0441\u043D\u043E \u043D\u0430\u0440\u0430\u0437\u0456 \u043D\u0435 \u043F\u0456\u0434\u0442\u0440\u0438\u043C\u0443\u0454\u0442\u044C\u0441\u044F"},search:"\u041F\u043E\u0448\u0443\u043A",editing_changes:"Editing Changes",editing_data:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0448\u0430\u0440\u0456\u0432",editing_attributes:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0456\u0432",relations:"\u0412\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",edit_relation:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",back_to_relations:"\u041F\u043E\u0432\u0435\u0440\u043D\u0443\u0442\u0438\u0441\u044F \u0434\u043E \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u044C",no_relations_found:"\u0412\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F \u0432\u0456\u0434\u0441\u0443\u0442\u043D\u0456",relation_data:"\u0414\u0430\u043D\u0456 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",relation_already_added:"\u0412\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F \u0432\u0436\u0435 \u0434\u043E\u0434\u0430\u043D\u0435",list_of_relations_feature:"\u041E\u0431'\u0454\u043A\u0442\u0438 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",tooltip:{edit_layer:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0448\u0430\u0440",filter_by_relation:"\u0424\u0456\u043B\u044C\u0442\u0440\u0443\u0432\u0430\u0442\u0438 \u0448\u0430\u0440\u0438 \u0437\u0430 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F\u043C"},toolbox:{title:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F"},table:{edit:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442",copy:"\u041A\u043E\u043F\u0456\u044E\u0432\u0430\u0442\u0438",delete:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438"},tools:{copy:"\u041A\u043E\u043F\u0456\u044E\u0432\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0438",pastefeaturesfromotherlayers:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0438 \u0437 \u0456\u043D\u0448\u043E\u0433\u043E \u0448\u0430\u0440\u0443",addpart:"\u0414\u043E\u0434\u0430\u0442\u0438 \u0447\u0430\u0441\u0442\u0438\u043D\u0443",deletepart:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u0447\u0430\u0441\u0442\u0438\u043D\u0443",merge:"\u0417\u043B\u0438\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0438",split:"\u0420\u043E\u0437\u0434\u0456\u043B\u0438\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442",add_feature:"\u0414\u043E\u0434\u0430\u0442\u0438",delete_feature:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438",move_feature:"\u041F\u0435\u0440\u0435\u043C\u0456\u0441\u0442\u0438\u0442\u0438",rotate_feature:"\u0424\u0443\u043D\u043A\u0446\u0456\u044F \u043F\u043E\u0432\u043E\u0440\u043E\u0442\u0443",update_vertex:"\u0417\u043C\u0456\u043D\u0438\u0442\u0438 \u0432\u0435\u0440\u0448\u0438\u043D\u0443",update_feature:"\u0417\u043C\u0456\u043D\u0438\u0442\u0438 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0438",update_multi_features:"\u0417\u043C\u0456\u043D\u0438\u0442\u0438 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0438 \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u043E\u0431'\u0454\u043A\u0442\u0456\u0432",update_multi_features_relations:"\u0417\u043C\u0456\u043D\u0438\u0442\u0438 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0438 \u0443 \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F\u0445",update_multi_features_relations_from_parents:"\u0414\u043E\u0434\u0430\u0442\u0438/\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0437\u0432'\u044F\u0437\u0430\u043D\u0456 \u0437\u0430\u043F\u0438\u0441\u0438 \u0431\u0430\u0442\u044C\u043A\u0456\u0432\u0441\u044C\u043A\u0438\u0445 \u043E\u0431'\u0454\u043A\u0442\u0456\u0432",copyfeaturefromexternallayer:"\u0421\u0442\u0432\u043E\u0440\u0438\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442 \u0437 \u0434\u043E\u0434\u0430\u043D\u043E\u0433\u043E \u0448\u0430\u0440\u0443"},toolsoftool:{measure:"\u0412\u0438\u043C\u0456\u0440\u044E\u0432\u0430\u043D\u043D\u044F",snap:"\u041F\u0440\u0438\u0432'\u044F\u0437\u043A\u0430 \u0434\u043E \u0448\u0430\u0440\u0443",snapall:"\u041F\u0440\u0438\u0432'\u044F\u0437\u043A\u0430 \u0434\u043E \u0432\u0441\u0456\u0445 \u0448\u0430\u0440\u0456\u0432"},steps:{help:{select_elements:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0438",select_element:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442",copy:"\u0421\u0442\u0432\u043E\u0440\u0438\u0442\u0438 \u043A\u043E\u043F\u0456\u044E \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u043E\u0431'\u0454\u043A\u0442\u0456\u0432",merge:"\u0417\u043B\u0438\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0438",split:"\u0420\u043E\u0437\u0434\u0456\u043B\u0438\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442",new:"\u041D\u043E\u0432\u0438\u0439 \u043E\u0431'\u0454\u043A\u0442",edit_table:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0442\u0430\u0431\u043B\u0438\u0446\u044E \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0456\u0432",draw_new_feature:"\u041E\u0446\u0438\u0444\u0440\u0443\u0432\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442",action_confirm:"\u041F\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438 \u0434\u0456\u044E",double_click_delete:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u0431'\u0454\u043A\u0442, \u044F\u043A\u0438\u0439 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E \u0432\u0438\u0434\u0430\u043B\u0438\u0442\u0438",edit_feature_vertex:"\u0417\u043C\u0456\u043D\u0438\u0442\u0438 \u0430\u0431\u043E \u0434\u043E\u0434\u0430\u0442\u0438 \u0432\u0435\u0440\u0448\u0438\u043D\u0443 \u0434\u043E \u0432\u0438\u0431\u0440\u0430\u043D\u043E\u0433\u043E \u043E\u0431'\u0454\u043A\u0442\u0430",move:"\u041F\u0435\u0440\u0435\u043C\u0456\u0441\u0442\u0438\u0442\u0438 \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0439 \u043E\u0431'\u0454\u043A\u0442",select_feature_to_relation:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u0431'\u0454\u043A\u0442, \u044F\u043A\u0438\u0439 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E \u0437\u0432'\u044F\u0437\u0430\u0442\u0438",show_edit_feature_form:"\u0412\u0456\u0434\u043A\u0440\u0438\u0442\u0438 \u0444\u043E\u0440\u043C\u0443 \u043E\u0431'\u0454\u043A\u0442\u0443",pick_feature:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u0431'\u0454\u043A\u0442, \u044F\u043A\u0438\u0439 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E \u0437\u043C\u0456\u043D\u0438\u0442\u0438",insert_attributes_feature:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u0438 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0430"}},workflow:{steps:{select:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u0431'\u0454\u043A\u0442",draw_part:"\u041E\u0446\u0438\u0444\u0440\u0443\u0432\u0430\u0442\u0438 \u043D\u043E\u0432\u0443 \u0447\u0430\u0441\u0442\u0438\u043D\u0443",draw_geometry:"\u041E\u0446\u0438\u0444\u0440\u0443\u0432\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442",merge:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u0431'\u0454\u043A\u0442, \u044F\u043A\u0438\u0439 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E \u0437\u043B\u0438\u0442\u0438",selectSHIFT:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0438 \u0443 \u043F\u0440\u044F\u043C\u043E\u043A\u0443\u0442\u043D\u0456\u0439 \u043E\u0431\u043B\u0430\u0441\u0442\u0456 \u0437 \u0437\u0430\u0442\u0438\u0441\u043D\u0443\u0442\u0438\u043C SHIFT",selectDrawBox:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442\u0438 \u0443 \u043F\u0440\u044F\u043C\u043E\u043A\u0443\u0442\u043D\u0456\u0439 \u043E\u0431\u043B\u0430\u0441\u0442\u0456, \u0449\u043E \u0437\u0430\u0434\u0430\u043D\u0430 \u043F\u0440\u043E\u0442\u0438\u043B\u0435\u0436\u043D\u0438\u043C\u0438 \u0432\u0435\u0440\u0448\u0438\u043D\u0430\u043C\u0438",selectDrawBoxAtLeast2Feature:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0449\u043E\u043D\u0430\u0439\u043C\u0435\u043D\u0448\u0435 2 \u043E\u0431'\u0454\u043A\u0442\u0438 \u0443 \u043F\u0440\u044F\u043C\u043E\u043A\u0443\u0442\u043D\u0456\u0439 \u043E\u0431\u043B\u0430\u0441\u0442\u0456, \u0449\u043E \u0437\u0430\u0434\u0430\u043D\u0430 \u043F\u0440\u043E\u0442\u0438\u043B\u0435\u0436\u043D\u0438\u043C\u0438 \u0432\u0435\u0440\u0448\u0438\u043D\u0430\u043C\u0438",selectPoint:"\u041A\u043B\u0430\u0446\u043D\u0456\u0442\u044C \u043F\u043E \u043E\u0431'\u0454\u043A\u0442\u0443 \u0449\u043E\u0431 \u0432\u0438\u0431\u0440\u0430\u0442\u0438 \u0439\u043E\u0433\u043E",selectPointSHIFT:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u0431'\u0454\u043A\u0442\u0438 \u0443 \u043F\u0440\u044F\u043C\u043E\u043A\u0443\u0442\u043D\u0456\u0439 \u043E\u0431\u043B\u0430\u0441\u0442\u0456 \u0437 \u0437\u0430\u0442\u0438\u0441\u043D\u0443\u0442\u0438\u043C SHIFT \u0430\u0431\u043E \u043A\u043B\u0430\u0446\u043D\u0456\u0442\u044C \u043F\u043E \u043E\u0431'\u0454\u043A\u0442\u0443",selectMultiPointSHIFT:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u0431'\u0454\u043A\u0442\u0438 \u0443 \u043F\u0440\u044F\u043C\u043E\u043A\u0443\u0442\u043D\u0456\u0439 \u043E\u0431\u043B\u0430\u0441\u0442\u0456 \u0437 \u0437\u0430\u0442\u0438\u0441\u043D\u0443\u0442\u0438\u043C SHIFT \u0430\u0431\u043E \u043A\u043B\u0430\u0446\u043D\u0456\u0442\u044C \u043F\u043E \u043E\u0431'\u0454\u043A\u0442\u0443",selectMultiPointSHIFTAtLeast2Feature:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0449\u043E\u043D\u0430\u0439\u043C\u0435\u043D\u0448\u0435 2 \u043E\u0431'\u0454\u043A\u0442\u0438 \u0443 \u043F\u0440\u044F\u043C\u043E\u043A\u0443\u0442\u043D\u0456\u0439 \u043E\u0431\u043B\u0430\u0441\u0442\u0456 \u0437 \u0437\u0430\u0442\u0438\u0441\u043D\u0443\u0442\u0438\u043C SHIFT \u0430\u0431\u043E \u043A\u043B\u0430\u0446\u043D\u0456\u0442\u044C \u043F\u043E \u043E\u0431'\u0454\u043A\u0442\u0443",copyCTRL:"\u041A\u043E\u043F\u0456\u044E\u0432\u0430\u0442\u0438 \u0432\u0438\u0431\u0440\u0430\u043D\u0456 \u043E\u0431'\u0454\u043A\u0442\u0438 \u0437\u0430 \u0434\u043E\u043F\u043E\u043C\u043E\u0433\u043E\u044E CTRL+C",selectStartVertex:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u043F\u043E\u0447\u0430\u0442\u043A\u043E\u0432\u0443 \u0432\u0435\u0440\u0448\u0438\u043D\u0443",selectToPaste:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0442\u043E\u0447\u043A\u0443, \u0434\u0435 \u0431\u0443\u0434\u0435 \u0432\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u043E \u043E\u0431'\u0454\u043A\u0442\u0438",draw_split_line:"\u0417\u0430\u0434\u0430\u0439\u0442\u0435 \u043B\u0456\u043D\u0456\u044E \u043F\u043E\u0434\u0456\u043B\u0443 \u0432\u0438\u0431\u0440\u0430\u043D\u043E\u0433\u043E \u043E\u0431'\u0454\u043A\u0442\u0430"},title:{steps:"\u041A\u0440\u043E\u043A\u0438"},next:"\u0414\u0430\u043B\u0456"},messages:{featureslockbyotheruser:"\u0427\u0430\u0441\u0442\u0438\u043D\u0430 \u043E\u0431'\u0454\u043A\u0442\u0456\u0432/\u0437\u0430\u043F\u0438\u0441\u0456\u0432 \u0440\u0435\u0434\u0430\u0433\u0443\u0454\u0442\u044C\u0441\u044F \u0456\u043D\u0448\u0438\u043C \u043A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0435\u043C \u0456 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0430 \u0434\u043B\u044F \u0437\u043C\u0456\u043D",featurelockbyotheruser:"\u041E\u0431'\u0454\u043A\u0442/\u0437\u0430\u043F\u0438\u0441 \u0440\u0435\u0434\u0430\u0433\u0443\u0454\u0442\u044C\u0441\u044F \u0456\u043D\u0448\u0438\u043C \u043A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0435\u043C \u0456 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0438\u0439 \u0434\u043B\u044F \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F",splitted:"\u0420\u043E\u0437\u0434\u0456\u043B\u0435\u043D\u043E",nosplittedfeature:"\u041D\u0435 \u0440\u043E\u0437\u0434\u0456\u043B\u0435\u043D\u043E",press_esc:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0441\u0442\u044C ESC \u0449\u043E\u0431 \u043F\u043E\u0432\u0435\u0440\u043D\u0443\u0442\u0438\u0441\u044F",online:"\u0412\u0438 \u0437\u043D\u043E\u0432\u0443 \u043E\u043D\u043B\u0430\u0439\u043D. \u0422\u0435\u043F\u0435\u0440 \u0432\u0438 \u043C\u043E\u0436\u0435\u0442\u0435 \u0437\u0431\u0435\u0440\u0435\u0433\u0442\u0438 \u0437\u043C\u0456\u043D\u0438 \u0434\u043E \u0431\u0430\u0437\u0438 \u0434\u0430\u043D\u0438\u0445",offline:"\u0412\u0438 \u043E\u0444\u043B\u0430\u0439\u043D. \u0417\u043C\u0456\u043D\u0438 \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043D\u043E \u043D\u0430 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E\u043C\u0443 \u0440\u0456\u0432\u043D\u0456",delete_feature:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u0432\u0438\u0431\u0440\u0430\u043D\u0456 \u043E\u0431'\u0454\u043A\u0442\u0438?",delete_feature_relations:"\u0412\u0438\u0434\u0430\u043B\u0435\u043D\u043D\u044F \u043E\u0431'\u0454\u043A\u0442\u0430 \u0437 \u043F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u043C\u0438 \u043D\u0430 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F, \u043F\u0440\u0438\u0437\u0432\u0435\u0434\u0435 \u0434\u043E \u0443\u0442\u0432\u043E\u0440\u0435\u043D\u043D\u044F '\u0441\u0438\u0440\u0456\u0442'. \u041F\u0435\u0440\u0448 \u043D\u0456\u0436 \u0432\u0438\u0434\u0430\u043B\u044F\u0442\u0438 \u0446\u0435\u0439 \u043E\u0431'\u0454\u043A\u0442, \u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0443\u0454\u043C\u043E \u0440\u043E\u0437\u0456\u0431\u0440\u0430\u0442\u0438\u0441\u044F \u0437 \u043F\u043E\u0441\u0438\u043B\u0430\u043D\u043D\u044F\u043C\u0438",unlink_relation:"\u0420\u043E\u0437\u0456\u0440\u0432\u0430\u0442\u0438 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F?",commit_feature:"\u041E\u043F\u0438\u0441 \u0437\u043C\u0456\u043D",toolbox_has_no_geometry:"\u0448\u0430\u0440 \u0431\u0435\u0437 \u0433\u0435\u043E\u043C\u0435\u0442\u0440\u0456\u0457",toolbox_has_relation:"\u0448\u0430\u0440 \u0454 \u0447\u0430\u0441\u0442\u0438\u043D\u043E\u044E \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",saved:"\u0414\u0430\u043D\u0456 \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043D\u043E",saved_local:"\u0414\u0430\u043D\u0456 \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043D\u043E \u043D\u0430 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E\u043C\u0443 \u0440\u0456\u0432\u043D\u0456",loading_data:"\u0417\u0430\u0432\u0430\u043D\u0442\u0430\u0436\u0435\u043D\u043D\u044F",saving:"\u0417\u0431\u0435\u0440\u0435\u0436\u0435\u043D\u043D\u044F. \u0411\u0443\u0434\u044C \u043B\u0430\u0441\u043A\u0430, \u0437\u0430\u0447\u0435\u043A\u0430\u0439\u0442\u0435\u2026",constraints:{enable_editing:`\u0414\u043B\u044F \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0441\u043B\u0456\u0434 \u0437\u0431\u0456\u043B\u044C\u0448\u0438\u0442\u0438 \u043C\u0430\u0441\u0448\u0442\u0430\u0431 
\u0406\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0438 \u0430\u043A\u0442\u0438\u0432\u0443\u044E\u0442\u044C\u0441\u044F \u043D\u0430 \u043C\u0430\u0441\u0448\u0442\u0430\u0431\u0456 1:`},pdf:"\u041F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u0456\u0439 \u043F\u0435\u0440\u0435\u0433\u043B\u044F\u0434 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0438\u0439. \u041A\u043B\u0430\u043D\u0446\u0456\u0442\u044C \u0442\u0443\u0442 ",commit:{header:"\u0421\u043F\u0438\u0441\u043E\u043A \u0437\u043C\u0456\u043D, \u044F\u043A\u0456 \u0431\u0443\u0434\u0435 \u0437\u0431\u0435\u0440\u0435\u0436\u0435\u043D\u043E.",header_relation:"\u0412\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",header_add:"<b>\u0414\u043E\u0434\u0430\u043D\u043E</b> \u043F\u043E\u043A\u0430\u0437\u0443\u0454 \u043A\u0456\u043B\u044C\u043A\u0456\u0441\u0442\u044C \u0434\u043E\u0434\u0430\u043D\u0438\u0445 \u043E\u0431'\u0454\u043A\u0442\u0456\u0432",header_update_delete:"<b>\u0417\u043C\u0456\u043D\u0435\u043D\u043E</b> \u0442\u0430 <b>\u0412\u0438\u0434\u0430\u043B\u0435\u043D\u043E</b> \u043F\u043E\u043A\u0430\u0437\u0443\u044E\u0442\u044C ID \u043E\u0431'\u0454\u043A\u0442\u0456\u0432",add:"\u0414\u043E\u0434\u0430\u043D\u043E",delete:"\u0412\u0438\u0434\u0430\u043B\u0435\u043D\u043E",update:"\u0417\u043C\u0456\u043D\u0435\u043D\u043E"},loading_table_data:"\u0417\u0430\u0432\u0430\u043D\u0442\u0430\u0436\u0435\u043D\u043D\u044F \u0434\u0430\u043D\u0438\u0445. \u0417\u0430\u0447\u0435\u043A\u0430\u0439\u0442\u0435\u2026",copy_and_paste_from_other_layer_mandatory_fields:"\u041F\u0435\u0440\u0448 \u043D\u0456\u0436 \u0437\u0431\u0435\u0440\u0435\u0433\u0442\u0438 \u0437\u043C\u0456\u043D\u0438, \u043D\u0435\u043E\u0431\u0445\u0456\u0434\u043D\u043E \u0437\u0430\u043F\u043E\u0432\u043D\u0438\u0442\u0438 \u043E\u0431\u043E\u0432'\u044F\u0437\u043A\u043E\u0432\u0456 \u043F\u043E\u043B\u044F \u0443 \u0432\u0441\u0456\u0445 \u0432\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0438\u0445 \u043E\u0431'\u0454\u043A\u0442\u0430\u0445",no_feature_selected:"\u041E\u0431'\u0454\u043A\u0442\u0438 \u043D\u0435 \u0432\u0438\u0431\u0440\u0430\u043D\u043E",select_min_2_features:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0449\u043E\u043D\u0430\u0439\u043C\u0435\u043D\u0448\u0435 2 \u043E\u0431'\u0454\u043A\u0442\u0438"},relation:{table:{info:"<div>\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F, \u044F\u043A\u0435 \u043D\u0435\u043E\u0431\u0445\u0456\u0434\u043D\u043E \u0437\u0432'\u044F\u0437\u0430\u0442\u0438 \u0437 \u043E\u0431'\u0454\u043A\u0442\u043E\u043C.</div>"},draw_new_feature:"\u041E\u0446\u0438\u0444\u0440\u0443\u0432\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442",draw_or_copy:"\u0430\u0431\u043E",copy_feature_from_other_layer:"\u041A\u043E\u043F\u0456\u044E\u0432\u0430\u0442\u0438 \u0437 \u0456\u043D\u0448\u043E\u0433\u043E \u0448\u0430\u0440\u0443"},form:{relations:{tooltips:{back_to_father:"\u041F\u043E\u0432\u0435\u0440\u043D\u0443\u0442\u0438\u0441\u044F \u0434\u043E \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0431\u0430\u0442\u044C\u043A\u0456\u0441\u044C\u043A\u043E\u0433\u043E \u043E\u0431'\u0454\u043A\u0442\u0430",add_relation:"\u0421\u0442\u0432\u043E\u0440\u0438\u0442\u0438 \u0442\u0430 \u0434\u043E\u0434\u0430\u0442\u0438 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",link_relation:"\u041F\u0440\u0438\u0432'\u044F\u0437\u0430\u0442\u0438 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",open_relation_tools:"\u0406\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0438 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F",unlink_relation:"\u0420\u043E\u0437\u0456\u0440\u0432\u0430\u0442\u0438 \u0432\u0456\u0434\u043D\u043E\u0448\u0435\u043D\u043D\u044F"}},buttons:{save:"\u0412\u0441\u0442\u0430\u0432\u043A\u0430/\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043D\u043D\u044F",save_and_back:"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438 \u0442\u0430 \u043F\u043E\u0432\u0435\u0440\u043D\u0443\u0442\u0438\u0441\u044F",save_and_back_table:"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438 \u0442\u0430 \u043F\u043E\u0432\u0435\u0440\u043D\u0443\u0442\u0438\u0441\u044F",cancel:"\u0406\u0433\u043D\u043E\u0440\u0443\u0432\u0430\u0442\u0438 \u0437\u043C\u0456\u043D\u0438"}},modal:{tools:{copyfeaturefromotherlayer:{title:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u0448\u0430\u0440",edit_attributes:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0438 \u0432\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0438\u0445 \u043E\u0431'\u0454\u043A\u0442\u0456\u0432 \u0443 \u0433\u0440\u0443\u043F\u043E\u0432\u043E\u043C\u0443 \u0440\u0435\u0436\u0438\u043C\u0456"},copyfeaturefromprojectlayer:{title:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438 \u043E\u0431'\u0454\u043A\u0442"}}}};var qs={it:Ds,en:js,fi:Us,se:Ns,fr:Vs,de:$s,ro:zs,pl:Gs,uk:Hs};ee();he();G();var{Feature:ur}=g3wsdk.core.layer.features;function Ks(t,e={}){let s=new ur;e.geometry&&s.setGeometry(new ol.geom[e.geometry.type](e.geometry.coordinates)),s.setProperties(e.properties),s.setTemporaryId();let i=this.getToolBoxById(t),a=i.getLayer().getEditingLayer(),n=i.getSession();return a.getSource().addFeature(s),n.pushAdd(t,s,!1),s}Re();je();We();var{G3W_FID:Gr}=g3wsdk.constant,{ApplicationState:ai,ApplicationService:Jt}=g3wsdk.core,{CatalogLayersStoresRegistry:Be}=g3wsdk.core.catalog,{t:Yt,tPlugin:ri}=g3wsdk.core.i18n,{Layer:ni,LayersStore:Hr}=g3wsdk.core.layer,{Feature:di}=g3wsdk.core.layer.features,{MapLayersStoreRegistry:wt}=g3wsdk.core.map,{Plugin:qr,PluginService:Kr}=g3wsdk.core.plugin,{XHR:Qt,noop:oi}=g3wsdk.core.utils,{GUI:B}=g3wsdk.gui,{Panel:Wr}=g3wsdk.gui.vue,{Server:Xr}=g3wsdk.core.errors.parsers,{Geometry:li}=g3wsdk.core.geoutils,{getScaleFromResolution:Zr,getResolutionFromScale:Jr}=g3wsdk.ol.utils;Object.entries({Workflow:y,OpenFormStep:M,AddFeatureStep:Q,ToolBox:Y}).forEach(([t,e])=>console.assert(e!==void 0,`${t} is undefined`));new class extends qr{constructor(){super({name:"editing",i18n:qs,fontClasses:[{name:"measure",className:"fas fa-ruler-combined"},{name:"magnete",className:"fas fa-magnet"},{name:"clipboard",className:"fas fa-clipboard"}]}),this.state={open:!1,toolboxes:[],_toolboxes:[],toolboxselected:null,showselectlayers:!0,message:null,relations:[],sessions:{},layers_in_error:!1,formComponents:{},subscribers:{},constraints:{toolboxes:{},showToolboxesExcluded:!0},featuresOnClose:{},uniqueFieldsValues:{},saveConfig:{mode:"default",modal:!1,messages:void 0,cb:{done:()=>{},error:()=>{}}},editableLayers:{},events:{"start-editing":{},"show-relation-editing":{},layer:{start_editing:{before:{},after:{}}}},show_errors:!1,editFeatureKey:void 0,panel:null,currentLayout:Jt.getCurrentLayoutName(),unwatchLayout:new Vue().$watch(()=>ai.gui.layout.__current,t=>this.state.currentLayout=t!==this.getName()?t:this.state.currentLayout),onMapControlToggled:({target:t})=>{t.isToggled()&&t.isClickMap()&&this.state.toolboxselected&&this.state.toolboxselected.getActiveTool()&&this.state.toolboxselected.stopActiveTool()}},this.setService(Object.assign(new Kr,{state:this.state,config:this.config,getSession:this.getSession.bind(this),getFeature:this.getFeature.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this),fireEvent:this.fireEvent.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this),getEditingLayer:this.getEditingLayer.bind(this),addToolBox:this.addToolBox.bind(this),runEventHandler:this.runEventHandler.bind(this),resetDefault:this.resetDefault.bind(this),resetAPIDefault:this.resetAPIDefault.bind(this),getLayers:this.getLayers.bind(this),getLayerById:this.getLayerById.bind(this),getToolBoxById:this.getToolBoxById.bind(this),getSessionById:this.getSessionById.bind(this),setApplicationEditingConstraints:this.setApplicationEditingConstraints.bind(this),getToolBoxes:this.getToolBoxes.bind(this),getEditableLayers:this.getEditableLayers.bind(this),stop:this.stop.bind(this),saveChange:this.saveChange.bind(this),commit:this.commit.bind(this),undoRedoLayerUniqueFieldValues:this.undoRedoLayerUniqueFieldValues.bind(this),undoRedoRelationUniqueFieldValues:this.undoRedoRelationUniqueFieldValues.bind(this),stopEditing:this.stopEditing.bind(this),startEditing:this.startEditing.bind(this),addLayerFeature:this.addLayerFeature.bind(this)})),B.getService("map").on("mapcontrol:toggled",this.state.onMapControlToggled),this._init()}async _init(){if(!Be.getLayers({EDITABLE:!0}).length)return;this.setHookLoading({loading:!0}),this.service.setApi({api:{getSession:this.getSession.bind(this),getFeature:this.getFeature.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this),getToolBoxById:this.getToolBoxById.bind(this),addNewFeature:Ks,commitChanges:this.commit.bind(this),setApplicationEditingConstraints:this.setApplicationEditingConstraints.bind(this),getMapService:()=>B.getService("map"),updateLayerFeature:oi,deleteLayerFeature:oi,addLayerFeature:this.addLayerFeature.bind(this),hidePanel:this.hideEditingPanel.bind(this),resetDefault:this.resetAPIDefault.bind(this),startEditing:this.startEditing.bind(this),stopEditing:this.stopEditing.bind(this),showPanel:this.showPanel.bind(this),setSaveConfig:this.setSaveConfig.bind(this),addFormComponents:this.addFormComponents.bind(this)}}),wt.addLayersStore(new Hr({id:"editing",queryable:!1})),this.state.editableLayers={},this.state._toolboxes=[],this.state.toolboxes=[];for(let{status:e,value:s}of await Promise.allSettled(Be.getLayers({EDITABLE:!0},{TOC_ORDER:!0}).map(i=>i.getLayerForEditing({vectorurl:this.config.vectorurl,project_type:this.config.project_type})))){if(e!=="fulfilled"){this.state.layers_in_error=!0;return}if(this.state.editableLayers[s.getId()]=s,this.state.uniqueFieldsValues[s.getId()]={},s.config.editing.layer_style)try{let i=await Qt.get({url:s.getUrl("config"),params:{style:s.config.editing.layer_style}});s.config.editing.fields=i?.vector?.fields||[]}catch(i){console.warn(i)}s.getEditingFields().filter(i=>i.input&&i.input.type==="select_autocomplete"&&!i.input.options.filter_expression&&!i.input.options.usecompleter).forEach(i=>["start-editing"].forEach(a=>{let n=s.getId();this.state.events[a][n]=this.state.events[a][n]||[],this.state.events[a][n].push(async()=>{let r=i.input.options;r.loading.state="loading",r.values=[];let l=r.layer_id&&Be.getLayerById(r.layer_id),g=[void 0,null].includes(r.filter_fields||[])||(r.filter_fields||[]).length===0;try{if(r.relation_reference&&g){let o=await s.getFilterData({fformatter:i.name});if(o&&o.data)return r.values.push(...o.data.map(([h,u])=>({key:u,value:h}))),r.loading.state="ready",this.fireEvent("autocomplete",{field:i,data:[o.data]}),r.values}if(l){let o=await w(l.getDataTable({ordering:r.orderbyvalue?r.value:r.key}));if(o&&o.features)return r.values.push(...(o.features||[]).map(h=>({key:h.properties[r.value],value:h.properties[r.key]}))),r.loading.state="ready",this.fireEvent("autocomplete",{field:i,features:o.features}),r.values}let c=[];return r.loading.state="ready",this.fireEvent("autocomplete",{field:i,features:c}),c}catch(c){return console.warn(c),r.loading.state="error",Promise.reject(c)}})})),this.state.sessions[s.getId()]=null}let t=0;this.getLayers().forEach(e=>{let s=e.getId();Be.getLayerById(s).getRelations().getArray().filter(i=>i.getType()==="ONE"&&s===i.getFather()).forEach(i=>{let a=this.getLayerById(i.getChild())!==void 0;this.getLayerById(i.getFather()).getEditingFields().filter(n=>n.vectorjoin_id&&n.vectorjoin_id===i.getId()).forEach(n=>{n.editable=n.editable&&a})}),e.getColor()||e.setColor(e.isGeoLayer()?["#C43C39","#d95f02","#91522D","#7F9801","#0B2637","#8D5A99","#85B66F","#8D2307","#2B83BA","#7D8B8F","#E8718D","#1E434C","#9B4F07","#1b9e77","#FF9E17","#7570b3","#204B24","#9795A3","#C94F44","#7B9F35","#373276","#882D61","#AA9039","#F38F3A","#712333","#3B3A73","#9E5165","#A51E22","#261326","#e4572e","#29335c","#f3a712","#669bbc","#eb6841","#4f372d","#cc2a36","#00a0b0","#00b159","#f37735","#ffc425"][t++%40]:"#fff")}),wt.getLayersStore("editing").addLayers(this.getLayers()),this.getLayers().forEach(e=>this.addToolBox(new Y(e,[...e.getChildren(),...e.getFathers()].filter(s=>this.getLayerById(s))))),await B.isReady(),this._setupGUI(),this.setHookLoading({loading:!1}),this.setReady(!0)}async _setupGUI(){!this.registerPlugin(this.config.gid)||this.config.visible===!1||this.getLayers().filter(t=>t.config.editing.visible).length===0||(this.state.editFeatureKey=B.getService("queryresults").onafter("editFeature",async({layer:t,feature:e}={})=>{let s=e.attributes[Gr]||e.id;if(s===void 0)return;this.getToolBoxes().forEach(l=>l.setShow(t.id===l.getId())),this.showEditingPanel(),this.state.showselectlayers=!1,this.subscribe("closeeditingpanel",()=>(this.state.showselectlayers=!0,{once:!0}));let i=this.getToolBoxById(t.id);i.setSelected(!0);let a=i.getSession(),{scale:n}=i.getEditingConstraints(),r;try{if(n){let p=B.getService("map").getMapUnits(),_=B.getService("map").getMap();parseInt(Zr(_.getView().getResolution(),B.getService("map").getMapUnits()))>n&&_.getView().setResolution(Jr(n,p))}await w(i.start({filter:{fids:s}}));let l=i.getLayer(),g=l.getEditingLayer().getSource(),c=ni.LayerTypes.VECTOR===l.getType(),h=(c?g.getFeatures():g.readFeatures()).find(p=>s==p.getId());if(!h){this.stop(),this.hideEditingPanel(),B.showUserMessage({type:"warning",message:"plugins.editing.messages.featurelockbyotheruser"});return}let u=h.getGeometry();u&&B.getService("map").zoomToGeometry(u),i.setSelected(!0),this.state.toolboxselected=i;let f=c&&!u&&i.getTools().find(p=>p.getId()==="addPart");if(f&&!li.isMultiGeometry(l.getGeometryType())&&(f.visible=!0),f){let p=f.getOperator(),_=new y({type:"drawgeometry",helpMessage:"editing.workflow.steps.draw_geometry",runOnce:!0,steps:[new Q({add:!1,steps:{addfeature:{description:"editing.workflow.steps.draw_geometry"}},onRun:({inputs:m,context:b})=>{_.emit("settoolsoftool",[{type:"snap",options:{layerId:m.layer.getId(),source:m.layer.getEditingLayer().getSource(),active:!0}},{type:"measure",options:{active:!1}}]),_.emit("active",["snap"])},onStop:()=>_.emit("deactive",["snap","measure"])}),new E({run:dt})],registerEscKeyEvent:!0});f.setOperator(_),this.subscribe("closeeditingpanel",()=>{f.setOperator(p),f.visible=li.isMultiGeometry(l.getGeometryType())})}r=new y({type:"editnopickmapfeatureattributes",runOnce:!0,helpMessage:"editing.tools.update_feature",steps:[new M]}),await w(r.start({inputs:{layer:l,features:[h]},context:{session:a}})),await w(a.save()),this.saveChange()}catch(l){console.warn(l),a.rollback()}finally{r&&r.stop()}}),this.config.name=this.config.name||"plugins.editing.editing_data",this.addToolGroup({position:0,title:"EDITING"}),this.addTools({action:this.showEditingPanel,offline:!1,icon:"pencil"},{position:0,title:"EDITING"}))}getSession({layerId:t}={}){return this.getToolBoxById(t).getSession()}getFeature({layerId:t}={}){return this.getToolBoxById(t).getActiveTool().getLayer().features[0]}subscribe(t,e){return this.state.subscribers[t]||(this.state.subscribers[t]=[]),this.state.subscribers[t].find(s=>e===s)||this.state.subscribers[t].push(e),e}unsubscribe(t,e){this.state.subscribers[t]=this.state.subscribers[t].filter(s=>e!==s)}async fireEvent(t,e={}){this.state.subscribers[t]&&this.state.subscribers[t].forEach(s=>{let i=s(e);i&&i.once&&this.unsubscribe(t,s)})}undo(){let t=this.state.toolboxselected.getSession(),e=t.getId(),s=t.getLastHistoryState().items;this.undoRedoLayerUniqueFieldValues({layerId:e,sessionItems:s,action:"undo"});let i=t.undo();this.undoRedoRelationUniqueFieldValues({relationSessionItems:i,action:"undo"}),Object.entries(i).forEach(([a,n])=>{this.getToolBoxById(a).getSession().undo(n)})}redo(){let t=this.state.toolboxselected.getSession(),e=t.getId(),s=t.getLastHistoryState().items;this.undoRedoLayerUniqueFieldValues({layerId:e,sessionItems:s,action:"redo"});let i=t.redo();this.undoRedoRelationUniqueFieldValues({relationSessionItems:i,action:"redo"}),Object.entries(i).forEach(([a,n])=>{this.getToolBoxById(a).getSession().redo(n)})}getEditingLayer(t){return this.state.editableLayers[t].getEditingLayer()}addToolBox(t){this.state._toolboxes.push(t),this.state.sessions[t.getId()]=t.getSession(),this.state.toolboxes.push(t.state)}async runEventHandler({type:t,id:e}={}){this.state.events[t]&&this.state.events[t][e]&&await Promise.allSettled(this.state.events[t][e].map(s=>s()))}resetDefault(){this.state.saveConfig={mode:"default",modal:!1,messages:void 0,cb:{done:()=>{},error:()=>{}}},B.getService("map").disableClickMapControls(!1)}resetAPIDefault({plugin:t=!0,toolboxes:e=!0}={}){e&&this.getToolBoxes().forEach(s=>s.resetDefault()),t&&this.resetDefault()}getLayers(){return Object.values(this.state.editableLayers)}getLayerById(t){return this.state.editableLayers[t]}getToolBoxById(t){return this.state._toolboxes.find(e=>t===e.getId())}getSessionById(t){return this.state.sessions[t]}setApplicationEditingConstraints(t={showToolboxesExcluded:!0,toolboxes:{}}){this.state.constraints={...this.state.constraints,...t};let{toolboxes:e,showToolboxesExcluded:s}=t,i=Object.keys(e);s===!1&&this.state.toolboxes.forEach(a=>a.show=i.includes(a.id)),i.forEach(a=>this.getToolBoxById(a).setEditingConstraints(e[a]))}getToolBoxes(){return this.state._toolboxes}getEditableLayers(){return this.state.editableLayers}async stop(){let t=this.state._toolboxes.filter(e=>e.getSession().getHistory().state.commit).map(e=>this.commit({toolbox:e,modal:!0}));try{await w($.when.apply(this,t))}catch(e){console.warn(e)}this.state._toolboxes.forEach(e=>e.stop()),this.state.toolboxselected=null,this.state.message=null,Object.keys(this.state.uniqueFieldsValues).forEach(e=>this.state.uniqueFieldsValues[e]={}),B.getService("map").refreshMap()}async saveChange(){if(this.state.saveConfig.mode==="autosave")return this.commit({modal:!1})}commit({toolbox:t,commitItems:e,modal:s=!0,close:i=!1}={}){let a=Object.assign({success:{message:"plugins.editing.messages.saved",autoclose:!0},error:{}},this.state.saveConfig.messages||{});t=t||this.state.toolboxselected;let n=t.getLayer(),r=e;e=e||t.getSession().getCommitItems();let l=ai.online,g=[...e.add||[],...e.delete||[],...e.update||[],...Object.keys(e.relations||{})].length,c,o,h;return v(async()=>{if(!g)return B.showUserMessage({type:"info",message:"Nothing to save",autoclose:!0,closable:!1}),t;try{if(s){c=new y({type:"commitfeatures",steps:[new E({run(p){return v(new Promise((_,m)=>{let b=B.dialog.dialog({message:p.message,title:`${ri("editing.messages.commit_feature")}: "${p.layer.getName()}"`,buttons:{SAVE:{className:"btn-success",callback(){_(p)},label:Yt("save")},CANCEL:{className:"btn-danger",callback(){m({cancel:!0})},label:Yt(p.close?"exitnosave":"annul")},...p.close?{CLOSEMODAL:{className:"btn-primary",callback(){b.modal("hide")},label:Yt("annul")}}:{}}});p.features&&H({promise:promise(),inputs:p,style:this.selectStyle})}))}})]});try{await w(c.start({inputs:{close:i,layer:n,message:new(Vue.extend((Js(),Ee(Zs)).default))({propsData:{commits:e,layer:n}}).$mount().$el}})),await w(c.stop())}catch(p){if(console.warn(p),p&&p.cancel)return Promise.reject(p);h=!0}l&&(o=B.dialog.dialog({message:`<h4 class="text-center">
                          <i style="margin-right: 5px;" class=${B.getFontClass("spinner")}></i>${ri("editing.messages.saving")}
                        </h4>`,closeButton:!1}))}let u=!l&&{[t.getSession().getId()]:e},f=!l&&JSON.parse(window.localStorage.getItem("EDITING_CHANGES")||null);Object.keys(f||{}).forEach(p=>{let _=Object.keys(u)[0],m=null;u[p]?m=u:u[_].relations[p]&&(m=u[_].relations);let b=!m&&Object.keys(f[p].relations||{}),k=!m&&b.length>0,x=!m&&k&&b.includes(_);if(m||x){let S=m?p:_,R=m||u,U=m?f:f[p].relations;R[S].add=[...R[S].add,...R[S].add],R[S].delete=[...R[S].delete,...R[S].delete],(U[S].update||[]).filter(F=>!R[S].update.find(O=>O.id===F.id)).forEach(F=>R[S].update.unshift(F)),(U[S].lockids||[]).filter(F=>!R[S].lockids.find(O=>O.featureid===F.featureid)).forEach(F=>R[S].update.unshift(F))}x&&(f[p].relations[_]=u[_],u=f),!m&&!k&&(u[p]=f[p])}),l||(B.showUserMessage({type:"success",message:"plugins.editing.messages.saved_local",autoclose:!0}),t.getSession().clearHistory());try{let{commit:p,response:_}=l?await w(t.getSession().commit({items:r||e,__esPromise:!0})):{},m=l&&p,b=m&&_.result;b&&a&&a.success&&(o&&o.modal("hide"),B.showUserMessage({type:"success",message:a.success.message||"plugins.editing.messages.saved",duration:2e3,autoclose:a.success.autoclose===void 0?!0:a.success.autoclose})),b&&ni.LayerTypes.VECTOR===n.getType()&&B.getService("map").refreshMap({force:!0}),l&&this.state.saveConfig.cb.done(t);let k=b&&t.getId();if(k&&(this.state.featuresOnClose[k]=this.state.featuresOnClose[k]||new Set,[..._.response.new.map(x=>x.id),...p.update.map(x=>x.id)].forEach(x=>this.state.featuresOnClose[k].add(x))),b&&this.emit("commit",_.response),m&&!b)throw h=!0,_}catch(p){if(console.warn(p),l)throw h=!0,p}}catch(u){if(console.warn(u),o&&o.modal("hide"),s)try{await ci(e.relations)}catch(f){console.warn(f)}if(h||s){let f=l?a.error.message||new Xr({error:u.errors||u||{}}).parse({type:"String"}):u;B.showUserMessage({type:"alert",message:f,textMessage:l?!a.error.message:!0,autoclose:l&&a.error.autoclose!==void 0?a.error.autoclose:!1}),this.state.saveConfig.cb.error(t,f)}return Promise.reject(t)}return t})}undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:e=[],action:s}){this.state.uniqueFieldsValues[t]!==void 0&&e.forEach(i=>{Object.keys(this.state.uniqueFieldsValues[t]).forEach(a=>{let n=Array.isArray(i),r,l;if(n){let g=i[1].feature.get(a)!=i[0].feature.get(a);r=g?s==="undo"?i[1].feature.get(a):i[0].feature.get(a):void 0,l=g?s==="undo"?i[0].feature.get(a):i[1].feature.get(a):void 0}else r=i.feature.getState()==="add"?i.feature.get(a):void 0,l=i.feature.getState()==="delete"?i.feature.get(a):void 0;r!==void 0&&this.state.uniqueFieldsValues[t][a].delete(r),l!==void 0&&this.state.uniqueFieldsValues[t][a].add(l)})})}undoRedoRelationUniqueFieldValues({relationSessionItems:t={},action:e}){Object.entries(t).forEach(([s,{own:i,dependencies:a}])=>{this.undoRedoLayerUniqueFieldValues({layerId:s,sessionItems:i,action:e}),this.undoRedoRelationUniqueFieldValues({relationSessionItems:a,action:e})})}async stopEditing(t,e={}){return w(this.getToolBoxById(t).stop(e))}async startEditing(t,e={},s=!1){e.selected=e.selected===void 0?!0:e.selected,e.showselectlayers=e.showselectlayers===void 0?!0:e.showselectlayers,e.disablemapcontrols=e.disablemapcontrols===void 0?!1:e.showselectlayers;let i=this.getToolBoxById(t);return this.state.showselectlayers=e.showselectlayers,i?(i.setSelected(e.selected),e.selected&&(this.state.toolboxselected=i),e.title&&i.setTitle(e.title),s=await w(i.start(e)),e.disablemapcontrols&&B.getService("map").disableClickMapControls(!0),s?{toolbox:i,data:s}:i):Promise.reject()}addLayerFeature({layerId:t,feature:e}={}){return[e,t].includes(void 0)?Promise.reject():new Promise(async(s,i)=>{let a=this.getLayerById(t),n=this.getSessionById(t),r=a.getEditingFields().filter(c=>!(c.pk&&!c.editable));n.start({filter:{nofeatures:!0,nofeatures_field:r[0].name},editing:!0});let l=new y({type:"addfeature",steps:[new M({push:!0,showgoback:!1,saveAll:!1})]}),g=c=>(l.stop(),n.stop(),c());try{r.forEach(c=>{e.get(c.name)===void 0&&e.set(c.name,null)});try{e=new di({feature:e,properties:r.map(c=>c.name)}),e.setTemporaryId(),n.pushAdd(t,e,!1),a.getEditingLayer().getSource().addFeature(e),await w(l.start({inputs:{layer:a,features:[e]},context:{session:n}})),n.save();try{await w(this.commit({modal:!1,toolbox:this.getToolBoxById(t)})),g(s)}catch(c){console.warn(c),g(i)}}catch(c){console.warn(c),g(i)}}catch(c){console.warn(c),i()}})}setSaveConfig({mode:t="default",cb:e={},modal:s=!1,messages:i}={}){Object.assign(this.state.saveConfig,{mode:t,modal:s,messages:i,cb:{...this.state.saveConfig.cb,...e}})}addFormComponents({layerId:t,components:e=[]}={}){this.state.formComponents[t]=(this.state.formComponents[t]||[]).concat(e)}showPanel(t={}){t.toolboxes&&Array.isArray(t.toolboxes)&&this.getToolBoxes().forEach(e=>e.setShow(t.toolboxes.includes(e.getId()))),this.showEditingPanel(t)}showEditingPanel(t={}){return this.getLayers().filter(e=>e.config.editing.visible).length>0?(this.state.panel=new Wr({...t,id:"editing-panel",title:t.title||"plugins.editing.editing_data",internalPanel:new(Vue.extend((ii(),Ee(si)).default))({service:this,resourcesurl:t.resourcesUrl||B.getResourcesUrl(),showcommitbar:t.showcommitbar===void 0||t.showcommitbar})}),B.showPanel(this.state.panel),!this.state.show_errors&&this.state.layers_in_error&&(B.showUserMessage({type:"warning",message:"plugins.editing.errors.some_layers",closable:!0}),this.state.show_errors=!0)):B.showUserMessage({type:"alert",message:"plugins.editing.errors.no_layers"}),this.state.panel}hideEditingPanel(){this.state.panel!==null&&(B.closePanel(),this.state.panel=null)}unload(){this.hideEditingPanel(),this.config.visible&&this.removeTools(),this.state.unwatchLayout(),wt.removeLayersStore(wt.getLayersStore("editing")),Y.clear(),B.getService("map").off("mapcontrol:toggled",this.state.onMapControlToggled),B.getService("queryresults").un("editFeature",this.state.editFeatureKey)}setCurrentLayout(){Jt.setCurrentLayout(this.getName())}resetCurrentLayout(){Jt.setCurrentLayout(this.state.currentLayout)}getActiveTool(){return this.getToolBoxes().filter(t=>t.getActiveTool())[0]}};async function ci(t={}){return Promise.allSettled(Object.entries(t).flatMap(([e,{add:s,delete:i,update:a,relations:n={}}])=>{let r=J(e).getEditingSource(),l=r.readFeatures().length>0;return[...(l&&s||[]).map(async({id:g})=>{r.removeFeature(r.getFeatureById(g))}),...(l&&a||[]).map(async({id:g})=>{try{let c=await Qt.get({url:Be.getLayerById(e).getUrl("data"),params:{fids:g}}),o=(c.result&&c.vector.data.features||[]).at(0),h=r.getFeatureById(g);h.setProperties(o.properties),h.setGeometry(o.geometry)}catch(c){console.warn(c)}}),...i.map(async g=>{try{let c=await Qt.get({url:Be.getLayerById(e).getUrl("data"),params:{fids:g}}),o=(c.result&&c.vector.data.features||[]).at(0),h=new ol.Feature({geometry:o.geometry});h.setProperties(o.properties),h.setId(g),r.addFeature(new di({feature:h}))}catch(c){console.warn(c)}}),ci(n)]}))}})();
//# sourceMappingURL=plugin.js.map
